<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>MasterPass Documentation</title>

	<!-- Bootstrap Core CSS -->
	<link href="css/bootstrap.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="css/simple-sidebar.css" rel="stylesheet">
	<link href="css/custom.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>

<body>
<a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Menu</a>
	<div id="wrapper">

<!-- Sidebar -->
<div id="sidebar-wrapper">
	<div id="accordion" class="sidebar-nav panel-group">
		<div class="sidebar-brand">
				<a data-toggle="tab" data-target="#intro"><img class="MPLogo" src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/mp_by_mc_mark_pos_089px.png"></a>
		</div>
		<div class="panel">
			<a data-parent="#accordion" id="TierOne" class="TierOneLinks" data-toggle="tab" data-target="#intro">What is MasterPass?</a>
		</div>
		<div class="panel">
			<a data-parent="#accordion" id="TierOne" href="#SignUp" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">Sign Up Process</a>
				<div class="collapse menuLinks" id="SignUp" aria-expanded="false">
						<a data-toggle="tab" data-target="#overview">Overview</a>
						<a href="#bymerchant" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">By Merchant</a>
							<div class="collapse menuLinks TierFour" id="bymerchant" aria-expanded="false">
								<a data-toggle="tab" data-target="#bmMerchant">Merchant</a>
								<a data-toggle="tab" data-target="#bmDeveloper">Developer</a>
							</div>
						<a href="#ServiceProvider" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">By Service Provider</a>
							<div class="collapse menuLinks TierThree" id="ServiceProvider" aria-expanded="false">
								<a href="#merchantbymerchant" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">Merchant By Merchant Model</a>
									<div class="collapse menuLinks TierFour" id="merchantbymerchant" aria-expanded="false">
										<a data-toggle="tab" data-target="#mbmService">Service Provider</a>
										<a data-toggle="tab" data-target="#mbmMerchant">Merchant</a>
										<a data-toggle="tab" data-target="#mbmDeveloper">Developer</a>
									</div>
								<a href="#FileAPI" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">File / API</a>
									<div class="collapse menuLinks TierFour" id="FileAPI" aria-expanded="false">
										<a data-toggle="tab" data-target="#fileapiprovider">Service Provider</a>
										<a data-toggle="tab" data-target="#fileapideveloper">Developer</a>
									</div>
							</div>
				</div>
		</div>
		<div class="panel">
			<a data-parent="#accordion" id="TierOne" href="#Implementation" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">Integration</a>
				<div class="collapse menuLinks" id="Implementation" aria-expanded="false">
						<a data-toggle="tab" data-target="#integrationOverview">Overview</a>
						<a data-toggle="tab" data-target="#configs">SDK Configuration</a>
						<a data-toggle="tab" data-target="#ssStandard">Standard</a>
						<a data-toggle="tab" data-target="#ssConnect">Connected</a>
						<a data-toggle="tab" data-target="#ssExpress">Express</a>
						<a data-toggle="tab" data-target="#mobileapp">Mobile</a>
						<a href="#sTestingTools" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">Testing & Tools</a>
									<div class="collapse menuLinks TierThree" id="sTestingTools" aria-expanded="false">
										<a data-toggle="tab" data-target="#placeholder">Merchant Store Testfront</a>
										<a data-toggle="tab" data-target="#placeholder">Mobile Sample App</a>
										<a data-toggle="tab" data-target="#testingqa">List of Scenarios to Verify Integration</a>
									</div>
								<a href="#sTroubleshooting" class="list-group-item list-group-item-success collapsed" data-toggle="collapse" aria-expanded="false">Troubleshooting</a>
									<div class="collapse menuLinks TierThree" id="sTroubleshooting" aria-expanded="false">
										<a data-toggle="tab" data-target="#troubleshooting">Error States</a>
									</div>
				</div>
		</div>
		<div class="panel">
			<a id="TierOne" class="TierOneLinks" data-toggle="tab" data-target="#branding">Branding Guidelines</a>
		</div>
		<div class="panel">
			<a id="TierOne" class="TierOneLinks" data-toggle="tab" data-target="#keyrenewal">Key Renewal</a>
		</div>
	</div>
</div>
<!-- /#sidebar-wrapper -->

		<!-- Page Content -->
		<div id="page-content-wrapper">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<div class="tab-content">
							<div class="tab-pane active" id="intro">
								<!-- MASTERPASS INTRODUCTION -->
								<h1>What is MasterPass?</h1>
								<p>MasterPass is a service that enables consumers to checkout on your site or app using any MasterPass-connected wallet. With a single integration with MasterPass, you can let consumers store and manage their payment and shipment information on any supported wallet (including our own MasterPass by MasterCard wallet). When they're ready to purchase, their information will be securely shared with your website or mobile app, speeding up the checkout process. MasterPass supports checkout on full and mobile websites, as well as Android™ and iOS™ apps.</p>

								<img width="100%" src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/CheckoutFlow.jpg">

								<h2>Features</h2>
								<ul>
									<li>Single integration to support all the MasterPass-connected wallets, including our own MasterPass by MasterCard wallet.
									</li>
									<li>Multi-channel support across e-commerce, mobile web, and iOS/Android apps.</li>
									<li>Streamlined checkout designed to reduce cart abandonment.</li>
									<li>Minimize fraud through proprietary features such as mobile verification.</li>
									<li>MasterPass by MasterCard is a secure, fast, and open service that supports all major credit cards.</li>
								</ul>

								<p>The following are useful terms that you will encounter during the integration process.</p>
								
								<h2>Checkout Identifier</h2> 
								<p>The Checkout Identifier is the ID that is used in lightbox initialization that identifies which Store Branding should be used.
								<h2>Consumer Key</h2>  
								<p>The Consumer Key identifies the client connecting to the MasterPass API. A developer will have a consumer key for each MasterPass environment (sandbox, production).</p>
								<h2>Checkout Resource</h2>  
								<p>The Checkout Resource is used to retrieve the payload delivered by the MasterPass API that contains the customer’s billing, shipping, and payment information.</p>
								<h2>Request Token</h2> 
								<p>The Request Token is an OAuth token that is used to authenticate requests to the MasterPass API.</p>
								<h2>Access Token</h2> 
								<p>The Access Token is an OAuth token used to authenticate access to the Checkout Resource through the MasterPass API. The Access Token is obtained using the Request Token and the Request Verifier.</p>
								<h2>Pairing Token</h2>  
								<p>The Pairing Token is an OAuth token that is used to obtain a Long Access Token.</p>
								<h2>Long Access Token</h2>  
								<p>The Long Access Token is an OAuth token that is used to access the customer’s wallet information, the Pre-Checkout Data.  The Long Access Token is typically stored with the customer’s account on the merchant site.</p>
								<h2>Pre-Checkout Data</h2>  
								<p>The paired consumer’s masked checkout data that can be requested prior to the MasterPass checkout. This is used to allow the consumer to pre-select their checkout options on the merchant site instead of in lightbox.</p> 
								<h2>3-D Secure</h2> 
								<p>A protocol for providing an additional security layer for online credit and debit card transactions.</p> 
								<h2>PK12 (PKCS 12)</h2> 
								<p>An encrypted container for public and private keys.</p>
							</div>
							<!-- END MASTERPASS INTRODUCTION -->

							<!-- BEGIN INTEGRATION  OVERVIEW -->
							<div class="tab-pane" id="integrationOverview">
								<h1>Architecture</h1>
								<img style="display: block" src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/MasterPass_Architecture.png" />
								<h2>Merchant Server - SDK vs API</h2>
								<p>
									MasterCard offers several options for developers to perform a web integration of MasterPass. We recommend using one of our SDKs, available in <a href="todo.com">Java</a>, <a href="todo.com">Ruby</a>, <a href="todo.com">C#</a>, and <a href="todo.com">PHP</a>. If your project doesn't use one of these languages, you can instead implement our <a href="todo.com">API</a>. 
								</p>
								<h2>Web Application</h2>
								<p>
									You will need to add the MasterPass Integration Script to your store's checkout page in order to invoke the user interface (Lightbox) that displays consumers' wallet information. MasterPass provides both a sandbox script (<a href="https://sandbox.masterpass.com/lightbox/Switch/integration/MasterPass.client.js">https://sandbox.masterpass.com/lightbox/Switch/integration/
MasterPass.client.js</a>) and a production script (<a href="https://www.masterpass.com/lightbox/Switch/integration/MasterPass.client.js">https://www.masterpass.com/lightbox/Switch/integration/
MasterPass.client.js</a>). It is important that you link to these scripts rather than download them.
								</p>
								<h2>Mobile Native App</h2>
								<p>
									MasterPass also supports in-app purchases on Android apps, currently only available for merchants based in the US. To learn more about how to implement MasterPass on your Android app, go <a href="https://developer.mastercard.com/portal/display/api/MasterPass+-+Merchant+Android+SDK">here</a>.
								</p>
								<h2>User Interface</h2>
								<p>
									MasterPass displays the consumer's wallet options using a Lightbox, a modal window that floats on top of the merchant's web page. The Lightbox utilizes a responsive design, allowing it to resize to fit various screen sizes, including mobile devices. Only a portrait view is supported for mobile; content that does not fit the screen can be accessed by scrolling. Under certain conditions -- for instance, if the consumer is using an older browser or blocking third party cookies -- MasterPass will render a full screen display instead of the Lightbox. 
								</p>
								<h1>Checkout Types</h1>
								<p>
									Merchants may select one of three different checkout types to integrate with their store. Standard Checkout provides the typical digital wallet experience, where a consumer logs into MasterPass and selects their wallet information. Additionally, MasterPass allows consumers to pair their MasterPass wallets with their merchant accounts, providing even faster checkout experiences. Connected Checkout uses pairing to display the consumer's MasterPass wallet information directly within the merchant site or app. Express Checkout also pairs the consumer's MasterPass wallet with their merchant account, with the additional advantage of allowing the consumer to bypass authentication with MasterPass, providing the fastest checkout experience.
								</p>
								<h2>Standard Checkout</h2>
								<p>
									Standard Checkout is the default and most basic MasterPass checkout flow.  During checkout, the consumer clicks on the “Buy with MasterPass” button.  The MasterPass Lightbox is presented to the consumer where they select the payment, shipping, and rewards details to be used for the purchase. No information is shared with the merchant prior to this point.  After the consumer completes their selections in Lightbox, the merchant receives the checkout information from MasterPass and uses it to create the order confirmation page.  The consumer confirms the transaction and the order is placed.
								</p>
								<h2>Connected Checkout</h2>
								<p>
									Connected Checkout, currently only available outside the US, is a faster checkout option that allows the merchant to display the consumer’s wallet details directly within the merchant’s site. It requires the consumer to log into the merchant site and pair their MasterPass account, sharing their wallet data with the merchant. 
								</p>
								<p>
									During the checkout flow, if the consumer is logged in and has previously paired their account, the merchant will request a masked copy of the wallet data from MasterPass to display on the merchant site.  The consumer selects from their wallet data and clicks the “Buy With MasterPass” button to confirm the order.  The Lightbox interface launches to authenticate the user.  After the consumer confirms the order in Lightbox, the merchant then receives the full, unmasked payment details of the consumer’s selections and uses that information to immediately place the order.
								</p>
								<h2>Express Checkout</h2>
								<p>
									Express Checkout is the fastest checkout experience, available to non-US based merchants that have previously passed a MasterPass vetting process. From the consumer’s perspective, it works like Connected Checkout, with the added convenience of not needing to sign into MasterPass -- their merchant site login is all that is required for their full MasterPass details to be released to the merchant.
								</p>
								
								<p>
									During the checkout flow, if the consumer is logged in and has previously paired their account, the merchant will request a masked copy of the wallet data from MasterPass and display it on the merchant site.  The consumer selects from their wallet data and clicks the Place Order button to confirm the order.  The merchant then receives the consumer’s full, unmasked payment details and uses that information to place the order.
								</p>
								<h2>Mobile Checkout</h2>
								<p>
									Merchants based in the US can integrate MasterPass on their Android applications. During checkout, when the consumer taps the "Buy with MasterPass" button, the SDK provides an interface to collect payment and shipping information. The SDK also calculates shipping and tax costs for the transaction. After the consumer completes their selections, SDK completes the transaction and returns payment and shipping information for the merchant to display on their "Order Placed" screen.
								</p>
								<h1>Prerequisites</h1>
								<p>Before you can implement Standard Checkout, make sure that you've already completed the following:</p>
								<ul>
									<li>Completed the <a href="https://www.unboundcommerce.com/MasterPass/documentation/signup_overview.html">MasterPass Sign Up Process.</a></li>
									<li>Completed the registration process for the <a href="https://developer.mastercard.com">MasterCard Developer Zone</a>.</li>
									<li>Decided whether you will complete the integration using one of our SDKs, or the API.</li>
								</ul>
							</div>
							<!-- END INTEGRATION OVERVIEW -->
							<!-- BEING SDK CONFIGURATION -->
							<div class="tab-pane" id="configs">
								<ul class="nav nav-pills">
									<li class="dropdown active">
										<a class="dropdown-toggle" data-toggle="dropdown" href="#">Change SDK Language
										<span class="caret"></span></a> 
										<ul class="dropdown-menu">
											<li><a data-toggle="tab" href="#javaconfig">Java</a></li>
											<li><a data-toggle="tab" href="#csharpconfig">C#</a></li>
											<li><a data-toggle="tab" href="#rubyconfig">Ruby</a></li>
											<li><a data-toggle="tab" href="#phpconfig">PHP</a></li> 
										</ul>
									</li>
								</ul>
								<div class="tab-content">
									<!-- JAVA CONFIG -->
									<div id="javaconfig" class="tab-pane fade in active">
										<div class="">
											<h1 id="toc_0">Java SDK Configurations</h1>

											<h2>Prerequisites</h2>
											<p>The MasterPass Java SDK requires Java 1.7 or higher. If you are integrating the SDK via Maven, then Maven 3.x is required.</p>

											<h2>Integrate the MasterPass SDK</h2>
											<p>You may integrate the MasterPass SDK with your project either by using Maven, or by manually downloading and adding the required jars.</p>

											<h3>Maven Integration</h3>
											<h4>1. Add MasterPass dependency to your pom.xml</h4>

<textarea style="display: block;
    padding: 9.5px;
    margin: 30px 0;
    font-size: 14px;
    line-height: 1.6;
    color: #333;
    word-break: break-all;
    word-wrap: break-word;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 100%;
    height: 150px">
<dependency>
    <groupId>com.mastercard.masterpass.merchant</groupId>
    <artifactId>mastercard-masterpass-merchant</artifactId>
    <version>1.0.0</version>
</dependency>
</textarea>

<h4>2. Update your project.</h4> 
<p>If you're using Eclipse, right-click the project and select Maven > Update Project.</p>

<h3>Manually Integrate Jars</h3>
<h4>1. Download MasterPass jars</h4>
<p>Download <b>mastercard.masterpass.merchant.jar</b> and <b>mastercard.sdk.core.jar</b> from the MasterPass Maven repository.</p>
<h4>2. Add mastercard.sdk.core.jar as a dependency of mastercard.masterpass.merchant.jar.</h4>
<h4>3. Add required third party jars</h4>
<p>Resolve the following third party jar dependencies:</p>
<table>
	<thead>
		<tr>
			<th>Jars</th>
			<th>Version</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>core</td>
			<td>1.47.1</td>
		</tr>
		<tr>
			<td>commons-lang3</td>
			<td>3.4</td>
		</tr>
		<tr>
			<td>swagger-annotations</td>
			<td>1.5.0</td>
		</tr>
		<tr>
			<td>commons-codec</td>
			<td>1.10</td>
		</tr>
		<tr>
			<td>slf4j-api</td>
			<td>1.6.1</td>
		</tr>
		<tr>
			<td>slf4j-simple</td>
			<td>1.7.14</td>
		</tr>
		<tr>
			<td>jackson-dataformat-xml</td>
			<td>2.6.3</td>
		</tr>
		<tr>
			<td>woodstox-core-asl</td>
			<td>4.4.1</td>
		</tr>
		<tr>
			<td>truth</td>
			<td>0.28</td>
		</tr>
		<tr>
			<td>simple-xml</td>
			<td>2.7.1</td>
		</tr>
		<tr>
			<td>gson</td>
			<td>2.3.1</td>
		</tr>
		<tr>
			<td>okio</td>
			<td>1.8.0</td>
		</tr>
		<tr>
			<td>okhttp</td>
			<td>3.2.0</td>
		</tr>
	</tbody>
</table>




											<h2>Configuration</h2>
											<h3>1. Get private key</h3>
											<p>Prior to completing this step, the developer must have uploaded or generated a PEM encoded Certificate Request File, and generated a consumer key in the Merchant Portal as part of the onboarding process.</p>
											<div><pre><code language="java">private static PrivateKey getPrivateKey() {
	String fileName = "example-file.p12"; // path to your p12 file
	String password = "password";         // your keystore password
	PrivateKey privateKey = null;
	try {
		KeyStore ks = KeyStore.getInstance("PKCS12");
		ks.load(new FileInputStream(fileName), password.toCharArray());
		Enumeration&lt;String&gt; enumeration = ks.aliases();
		String keyAlias = enumeration.nextElement();
		privateKey = (PrivateKey) ks.getKey(keyAlias, password.toCharArray());
	} catch (Exception e) {
		throw new RuntimeException(e);
	}

	return privateKey;
}
</code></pre></div>
<h3>2. Configure environment</h3>
<h4>2a. Configure sandbox or production environment</h4>
<p>Use the MasterCardApiConfig.setSandBox() method to set the environment as either sandbox or production, as shown below.</p>
<p>Set the hostname URL according to the MasterPass environment you want to connect to. Use "https://api.mastercard.com" for production, and "https://sandbox.api.mastercard.com" for sandbox.</p>
											<div><pre><code class="language-java">MasterCardApiConfig.setSandBox(false); // to use production environment else 
MasterCardApiConfig.setSandBox(true); // to use sandbox environment 
MasterCardApiConfig.setConsumerKey("insert_consumer_key_here"); 
MasterCardApiConfig.setPrivateKey("insert_private_key_here");
</code></pre></div>

<h4>2b. Optional - Configure Custom Environment</h4>
<p>Use the ApiConfigBuilder instead of the MasterCardApiConfig to set the environment to a value other than sandbox or production.</p>
	<div><pre><code class="language-java">// If developer wants to use environment configuration other than SANDBOX or PRODUCTION
ApiConfig config = new ApiConfigBuilder()
	.name("insert_environment_name_here") //for example, STAGE
	.consumerKey("insert_consumer_key_here")
	.privateKey("insert_private_key_here")
	.hostUrl("insert_environment_URL_here")
	.build();
</code></pre></div>

<p>If you choose to use the ApiConfigBuilder instead of the MasterCardApiConfig to set your environment, you will need to pass your config object as a parameter when making service calls. See the RequestTokenApi service call example below.</p>
<h4>RequestTokenApi service call using MasterCardApiConfig</h4>
<div><pre><code class="language-java">RequestTokenResponse response = RequestTokenApi.create("http://localhost:8090");</code></pre></div>
<h4>RequestTokenApi service call using ApiConfigBuilder</h4>
<div><pre><code class="language-java">RequestTokenResponse response = RequestTokenApi.create ("http://localhost:8090", config);</code></pre></div>


											<h2>Exception Handling</h2>
											<p>The Core SDK contains all of the exception classes that will be used across the Core and Merchant SDKs. The MasterPass SDK throws two types of exceptions:</p>
											<ul>
												<li><strong>SDKValidationException:</strong> Covers all local validation exceptions, such as a null required parameter.</li>
												<li><strong>SDKErrorResponseException:</strong> This exception type is used to throw all remote exceptions. It always returns a response code and an object of type com.mastercard.sdk.core.models.Errors, which needs to be caught and cast. The following sample code demonstrates how to cast this exception.</li>
											</ul>
											<div><pre><code class="language-java">
try {
	//Merchant checkout SDK call.
} catch (Exception exception) {
	if (exception instanceof SDKErrorResponseException) {
		String errorMessage;
		SDKErrorResponseException sdkException = (SDKErrorResponseException) exception;
		com.mastercard.sdk.core.models.Errors errors = (com.mastercard.sdk.core.models.Errors) sdkException.getErrorResponse();
		List &lt;com.mastercard.sdk.core.models.Error&gt; errorList = errors.getError();
		for (com.mastercard.sdk.core.models.Error error : errorList) { 
			//developer logic to get the error details from Error object.
			errorMessage = "Source:" + error.getSource() + "\n" 
			+ "ReasonCode:"+error.getReasonCode() + "\n" + "Description:" 
			+ error.getDescription() + "\n" + "Recoverable:" + error.getRecoverable();
		} 
	}
}</code></pre></div>

											<h2>Logging</h2>
											<p>SLF4J is used for logging all messages in MasterPass. The INFO log level is handled by default. The developer must explicitly set the DEBUG and ERROR log levels to fetch those logs.</p>
										</div>
									</div>

									<!-- END JAVA CONFIG -->
									<!-- C# CONFIG -->
									<div id="csharpconfig" class="tab-pane fade">
										<div class="">
											<h1 id="toc_0">C# SDK Configurations</h1>

											<h2>Prerequisites</h2>
											<ol>
												<li>Visual Studio Professional Edition 2013 or higher</li>
												<li>.NET Framework 4.5.2</li>
											</ol>

											<h2>Integrate the MasterPass SDK</h2>
											<p>1. Open your project. In Solution Explorer, open "Web Project".</p>
											<p>2. Right-click "reference" and select "ManageNugetPackages".</p>
											<p>3. Search for the package with ID name "Com.MasterCard.Masterpass.Merchant". Download and install this package.</p>
											<p>4. Download and install the Com.MasterCard.Sdk.Core package.</p>
											<img width="100%" src="http://www.unboundcommerce.com/wp-content/uploads/2016/07/nuget.png">

											<h2>Configurations</h2>
											<p>Prior to completing this step, the developer must have uploaded or generated a PEM encoded Certificate Request File, and generated a consumer key in the Merchant Portal as part of the onboarding process.</p>
											<p>Use the MasterCardApiConfiguration to set your environment as either sandbox or production. Set the hostname URL according to the MasterPass environment you want to connect to. Use "https://api.mastercard.com" for production, and "https://sandbox.api.mastercard.com" for sandbox.</p>
											<div><pre><code class="c#">private void SetConfigurations() 
{
	string hostUrl = ConfigurationManager.AppSettings["ApiHostUrl"];
	string consumerKey = ConfigurationManager.AppSettings["ConsumerKey"];
	string KeystorePath = Server.MapPath(ConfigurationManager.AppSettings["KeystorePath"]);
	string KeystorePassword = ConfigurationManager.AppSettings["KeystorePassword"];
	string IsSandbox = ConfigurationManager.AppSettings["IsSandbox"];
	var privateKey = new X509Certificate2(KeystorePath, KeystorePassword).PrivateKey;
	MasterCardApiConfiguration.Sandbox = Convert.ToBoolean(IsSandbox); //set as false for production
	MasterCardApiConfiguration.ConsumerKey = consumerKey;
	MasterCardApiConfiguration.PrivateKey = privateKey;
}</code></pre></div>
<p>Optionally, use the ApiConfigBuilder instead of the MasterCardApiConfiguration to set the environment to a value other than sandbox or production. See the following sample code to set the environment and use in an API service call.</p>
<div><pre><code class="c#">public const string ConfigName = "Stage";
private void SetConfigurations() 
{
	string hostUrl = ConfigurationManager.AppSettings["ApiHostUrl"];
	string consumerKey = ConfigurationManager.AppSettings["ConsumerKey"];
	string keystorePath = Server.MapPath(ConfigurationManager.AppSettings["KeystorePath"]); string keystorePassword = ConfigurationManager.AppSettings["KeystorePassword"];
	string IsSandbox = ConfigurationManager.AppSettings["IsSandbox"];
	var privateKey = new X509Certificate2(keystorePath, keystorePassword).PrivateKey;

	// Register the Environment Configuration with Name "Stage". 
	var stageApiConfig = new ApiConfigBuilder().Name(ConfigName).HostUrl(hostUrl).ConsumerKey(consumerKey).PrivateKey(privateKey).Build();
}</code></pre></div>
<p>If you choose to use the ApiConfigBuilder instead of the MasterCardApiConfig to set your environment, you will need to pass your config as a parameter when making service calls. See the RequestTokenApi service call example below.</p>
<h3>RequestTokenApi service call using MasterCardApiConfig</h3>
<div><pre><code class="c#">string callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string request_token = requestTokenResponse.OauthToken;</code></pre></div>
<h3>RequestTokenApi service call using ApiConfigBuilder</h3>
<div><pre><code class="c#">// Call the service with the registered configuration.
string callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url, MasterCardApiConfiguration.GetConfig(ConfigName));
string request_token = requestTokenResponse.OauthToken;</code></pre></div>
											<h2>Exception Handling</h2>
											<p>The Base SDK contains all of the exception classes that will be used across the Base and Client SDKs. All exceptions thrown are Runtime Exceptions. The table below details the different exception classes.</p>
											<table>
												<thead>
													<tr>
														<th>Location</th>
														<th>Class Name</th>
														<th>Class Responsibility</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>Base SDK</td>
														<td>SdkBaseException</td>
														<td>Base class to handle all SDK exceptions</td>
													</tr>
													<tr>
														<td>Base SDK</td>
														<td>SdkValidationException</td>
														<td>Used for all local validation, such as a required parameter being found null</td>
													</tr>
													<tr>
														<td>Base SDK</td>
														<td>SdkSerializationException</td>
														<td>Used for errors in serializing or de-serializing</td>
													</tr>
													<tr>
														<td>Base SDK</td>
														<td>SdkOauthException</td>
														<td>Used for errors in Oauth string creation</td>
													</tr>
													<tr>
														<td>Base SDK</td>
														<td>SdkErrorResponseException</td>
														<td>Used to throw all remote exceptions. It returns response code and Object of type Errors.</td>
													</tr>
												</tbody>
											</table>
											<h2>Logging</h2>
											<p>Set the reference configuration shown below in the App.config or Web.config of your application.</p>

											<table>
												<thead>
													<tr>
														<th>Logging Frameworks</th>
														<th>Simple Logging</th>
														<th>NLog</th>
														<th>Log4Net</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td><b>NuGet Packages Reference</b></td>
														<td>Id: slf4net.Simple Version: 0.1.32.1</td>
														<td>Id: slf4net.NLog <br /> Version: 0.1.32.1 <br /> Id: NLog <br /> Version: 4.2.3</td>
														<td>Id: slf4net.log4net <br /> Version: 0.1.32.1 <br /> Id: log4net <br /> Version: 2.0.0</td>
													</tr>
												</tbody>
											</table>



											<h3>slf4net Configuration App.config / Web.config</h3>
											<h4>Simple Logging</h4>
											<div><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt; 
&lt;configuration&gt;  
  &lt;configSections&gt;     
    &lt;section name="slf4net" type="slf4net.Configuration.SlfConfigurationSection, slf4net" /&gt;
  &lt;/configSections&gt;   
  &lt;slf4net&gt;     
    &lt;factory type="slf4net.Factories.SimpleLoggerFactory, slf4net.Simple"&gt;       
      &lt;factory-data&gt;
        &lt;logger name="TraceLogger" type="slf4net.TraceLogger, slf4net.Simple" /&gt;
      &lt;/factory-data&gt;
    &lt;/factory&gt;
  &lt;/slf4net> 
&lt;/configuration&gt;</code></pre></div>

<h4>NLog</h4>
<div><pre><code>&lt;?xml version="1.0" encoding="utf-8"?> 
&lt;configuration&gt;
  &lt;configSections&gt;
    &lt;section name="slf4net" type="slf4net.Configuration.SlfConfigurationSection, slf4net" /&gt;
  &lt;/configSections&gt;
  &lt;slf4net&gt;
    &lt;factory type="slf4net.NLog.NLogLoggerFactory, slf4net.NLog" /&gt;
  &lt;/slf4net&gt;
  &lt;runtime&gt;
    &lt;assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1"&gt;
      &lt;dependentAssembly&gt;
        &lt;assemblyIdentity name="NLog" publicKeyToken="5120e14c03d0593c" culture="neutral" /&gt;
        &lt;bindingRedirect oldVersion="0.0.0.0-4.0.0.0" newVersion="4.0.0.0" /&gt;
      &lt;/dependentAssembly&gt;
    &lt;/assemblyBinding&gt;
  &lt;/runtime> 
&lt;/configuration&gt;</code></pre></div>

<h4>Log4Net</h4>														
<div><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;configuration&gt;
  &lt;configSections&gt;
    &lt;section name="slf4net" type="slf4net.Configuration.SlfConfigurationSection, slf4net" /&gt;
  &lt;/configSections&gt;
  &lt;slf4net&gt;
    &lt;factory type="slf4net.log4net.Log4netLoggerFactory, slf4net.log4net"&gt; 
      &lt;factory-data&gt;
        &lt;configFile value="log4net.config" /&gt; 
        &lt;watch value="true" /&gt;
      &lt;/factory-data&gt;
    &lt;/factory&gt;
  &lt;/slf4net&gt;
&lt;/configuration&gt;</code></pre></div>
													
<h3>Logging Framework Configuration File</h3>	
<h4>NLog</h4>													
<p>NLog.config required in application to set the NLog framework specific configuration.</p>
<div><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
  &lt;targets&gt;
    &lt;target name="FileLogger" xsi:type="File" fileName="MasterPass-SDK.log" layout="${longdate} ${level:upperCase=true} ${message} (${callsite:includSourcePath=true})" /&gt; 
    &lt;target xsi:type="Trace" name="TraceLogger" /&gt;
  &lt;/targets&gt; 
  &lt;rules&gt;
    &lt;logger name="*" writeTo="FileLogger,TraceLogger" minlevel="Trace" /&gt;
  &lt;/rules&gt;
&lt;/nlog&gt;</code></pre></div>

<h4>Log4Net</h4>
<p>log4net.config required in application to set the log4net framework specific configuration.</p>
<div><pre><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;configuration&gt;
  &lt;log4net&gt;
    &lt;appender name="DebugConsole" type="log4net.Appender.DebugAppender"&gt;
      &lt;layout type="log4net.Layout.PatternLayout"&gt;
        &lt;conversionPattern value="%date %-5level: %message%newline" /&gt;
      &lt;/layout&gt;
    &lt;/appender&gt;
    &lt;appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender"&gt;
      &lt;file value="MasterPass-SDK.log" /&gt;
      &lt;appendToFile value="false" /&gt;
      &lt;rollingStyle value="Size" /&gt;
      &lt;maxSizeRollBackups value="10" /&gt;
      &lt;maximumFileSize value="50MB" /&gt;
      &lt;staticLogFileName value="true" /&gt;
      &lt;layout type="log4net.Layout.PatternLayout"&gt;
        &lt;conversionPattern value="%date %-5level[%logger]: %message%newline" /&gt;
      &lt;/layout&gt;
    &lt;/appender&gt;
    &lt;root&gt;
      &lt;level value="ALL" /&gt;
      &lt;appender-ref ref="DebugConsole" /&gt;
      &lt;appender-ref ref="RollingFileAppender" /&gt;
    &lt;/root&gt;
  &lt;/log4net&gt;
&lt;/configuration&gt;
</code></pre></div>

<h3>Web.Config Sample Code</h3>

											<p>An example of a Web.Config file with the required configurations is shown below.</p>
											<div><pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt; 
&lt;!--   For more information on how to configure your ASP.NET application, please visit   http://go.microsoft.com/fwlink/?LinkId=152368   --&gt; 
&lt;configuration&gt; 
  &lt;configSections&gt; 
    &lt;section name="slf4net" type="slf4net.Configuration.SlfConfigurationSection, slf4net" /&gt; 
  &lt;/configSections&gt; 
  &lt;slf4net&gt; 
    &lt;factory type="slf4net.log4net.Log4netLoggerFactory, slf4net.log4net"&gt; 
      &lt;factory-data&gt; 
        &lt;configFile value="log4net.config" /&gt; 
        &lt;watch value="true" /&gt; 
      &lt;/factory-data&gt; 
    &lt;/factory&gt; 
  &lt;/slf4net&gt; 
  &lt;appSettings&gt; 
    ..... 	
    &lt;!--        
    Following are the settings used by the Wallet Sample Application 
    which are used to connect/interact with the Wallet API. 
    --&gt; 
    &lt;add key="ApiHostUrl" value="https://sandbox.api.mastercard.com" /&gt; 
    &lt;add key="CallbackDomain" value="http://localhost:9090" /&gt; 
    &lt;add key="CallbackPath" value="/O3_Callback" /&gt; 
    &lt;add key="ConnectedCallbackPath" value="/O3_Callback?connect=true" /&gt; 
    &lt;add key="ConsumerKey" value="cLb0tKkEJhGTITp_6ltDIibO5Wgbx4rIldeXM_jRd4b0476c!414f4859446c4a366c726a327474695545332b353049303d" /&gt; 
    &lt;add key="CheckoutIdentifier" value="a4a6x1ywxlkxzhensyvad1hepuouaesuv" /&gt; 
    &lt;add key="KeystorePath" value="~/Certs/Sandbox/414f4859446c4a366c726a327474695545332b353049303d.p12" /&gt; 
    &lt;add key="KeystorePassword" value="changeit" /&gt; 
    &lt;add key="IsSandbox" value="true" /&gt;
  &lt;/appSettings&gt;    
  .....  
&lt;/configuration&gt;</code></pre></div>

										</div>
									</div>
									<!-- END C# CONFIG -->
									<!-- RUBY CONFIG -->
									<div id="rubyconfig" class="tab-pane fade">
										<div class="">
											<h1 id="toc_0">Ruby SDK Configurations</h1>

											<h2>Prerequisites</h2>
											<p>Ruby 2.2 or higher is required.</p>
											<h3>Windows</h3>
											<p>To install DevKit along with Ruby, download DevKit from <a href="http://rubyinstaller.org/downloads/">http://rubyinstaller.org/downloads/ </a> and run it to extract it to a location. Then, execute <b>rubydk.rb init</b> and <b>rubydk.rb install</b> from that location to bind DevKit to the Ruby installations in your path.</p>
											<div><pre><code>cd &lt;DEVKIT_INSTALL_DIR&gt;
C:\DevKit>rubydk.rbinit
C:\DevKit>rubydk.rbinstall
C:\DevKit> gem source -a http://rubygems.org/</code></pre></div>
											

											<h3>Linux</h3>
											<p>Ruby Version Manager (RVM) is the recommended way to manage Ruby versions and gems because it is popular, well-supported, and full-featured.</p>
											<div><b>Install curl:</b></div> 
											<div><pre><code>$sudo apt-get install curl</code></pre></div>
											<div><b>Install RVM (development version):</b></div> 
											<div><pre><code>$ \curl -sSL https://get.rvm.io | bash </code></pre></div>
											<div><b>Install Ruby:</b></div> 
											<div><pre><code>$rvm install &lt;ruby version&gt;</code></pre></div>
											<div><b>To toggle between Ruby versions:</b></div> 
											<div><pre><code>rvmuse&lt;ruby version&gt;</code></pre></div>

											<h3>Mac OS</h3>
											<p>While Ruby comes pre-installed on a Mac, it is recommended to install Ruby using Ruby Version Manager (RVM) instead.</p>
											<div><b>Install RVM:</b></div> 
											<div><pre><code>$ \curl -L https://get.rvm.io | bash</code></pre></div>
											<div><b>Load RVM into the shell:</b></div> 
											<div><pre><code>cd ~/
sudo vim .bash_profile</code></pre></div>
											<div><b>Restart terminal and install Ruby:</b></div> 
											<div><pre><code>rvm install &lt;Ruby Version&gt;</code></pre></div>

											<h2>Integrate the MasterPass SDK</h2>
											<p>Developers may either install the MasterPass SDK gem locally, or from <a href="rubygems.org">RubyGems.org</a>.</p>
											<h3>Installing gems locally</h3>
											<div><pre><code>gem install mastercard_code_sdk-1.0.0.gem
gem install mastercard_masterpass_merchant-1.0.0.gem</code></pre></div>

											<h3>Installing gems from <a href="rubygems.org">RubyGems.org</a></h3>
											<div><pre><code>gem install mastercard_masterpass_merchant [options]</code></pre></div>
											<p>Installing mastercard_masterpass_merchant gem automatically installs the following dependencies:</p>
											<ol>
												<li>mastercard_core_sdk</li>
												<li><a href="https://rubygems.org/gems/roxml">roxml</a></li>
												<li><a href="https://rubygems.org/gems/logging">logging</a></li>
												<li><a href="https://rubygems.org/gems/mime-types">mime-types</a></li>
											</ol>
											<h4>Options</h4>
											<div><b>Specify platform of gem to install</b></div>
											<div><pre><code>--platform PLATFORM</code></pre></div>
											<div><b>Specify version of gem to install</b></div>
											<div><pre><code>-v, --version VERSION</code></pre></div>
											<div><b>Allow prerelease versions of a gem to be installed (only for listed gems)</b></div>
											<div><pre><code>--[no-]prerelease</code></pre></div>
											<h2>Configurations</h2>
											<p>Prior to completing this step, the developer must have uploaded or generated a PEM encoded Certificate Request File, and generated a consumer key in the Merchant Portal as part of the onboarding process.</p>
											<p>Use the MasterCardApiConfiguration to set the environment as either sandbox or production, as shown in the code below:</p>
											<div><pre><code>MasterCardApiConfiguration.consumer_key = &lt;Consumer Key&gt;
MasterCardApiConfiguration.private_key = &lt;Private Key&gt;
MasterCardApiConfiguration.sandbox = false  #By default SANDBOX environment is set, Set sandbox to false to use Production environment.
</code></pre></div>
<p>Optionally, use the ApiConfigBuilder instead of the MasterCardApiConfig to set the environment to a value other than sandbox or production.</p>
<div><pre><code>config = ApiConfigBuilder.new.name(&lt;Environment Name&gt;).consumer_key(&lt;Consumer Key&gt;).private_key(&lt;Private Key&gt;).host_url(&lt;Host URL&gt;).build
</code></pre></div>

<p>If you choose to use the ApiConfigBuilder to set your environment, you will need to pass your config object as a parameter when making service calls. See the RequestTokenApi service call sample code below.</p>
<h3>RequestTokenApi service call using MasterCardApiConfig</h3>
<div><pre><code>request_token_response = RequestTokenApi.create("http://localhost/techbuzz/#/callback/checkout") 
</code></pre></div>
<h3>RequestTokenApi service call using ApiConfigBuilder</h3>
<div><pre><code>request_token_response = RequestTokenApi.create("http://localhost/techbuzz/#/callback/checkout", config)
</code></pre></div>

											<h2>Exception Handling</h2>
											<p>All error handling is implemented in the base SDK (masterpass_core_sdk). Error models are present in both the base SDK and the checkout SDK (mastercard_masterpass_merchant). The table below lists the various error classes used across the MasterPass SDK and their responsibilities.</p>
											<table>
												<thead>
													<tr>
														<th>Gem</th>
														<th>Class name</th>
														<th>Class responsibility</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>mastercard_core_sdk</td>
														<td>SDKBaseError</td>
														<td>Base class to handle all SDK exceptions</td>
													</tr>
													<tr>
														<td>mastercard_core_sdk</td>
														<td>SDKValidationError</td>
														<td>Used for all local validation, such as a required parameter being found null</td>
													</tr>
													<tr>
														<td>mastercard_core_sdk</td>
														<td>SDKConversionError</td>
														<td>The exception raised when there is an error in conversion</td>
													</tr>
													<tr>
														<td>mastercard_core_sdk</td>
														<td>SDKOauthError</td>
														<td>Used for errors in Oauth string creation</td>
													</tr>
													<tr>
														<td>mastercard_core_sdk</td>
														<td>SDKResponseError</td>
														<td>Used to throw all remote exceptions. It returns response code and Object of type Errors.</td>
													</tr>
													<tr>
														<td>mastercard_core_sdk</td>
														<td>ErrorHandler</td>
														<td>Wraps error response to error object</td>
													</tr>
												</tbody>
											</table>
											<p>The custom error object wraps error details such as source, description, recoverable, and reasons_code. The error object raised can be rescued as followed:</p>
											<div><pre><code class="language-ruby">begin 
  #TODO: Merchant checkout SDK call. 
  rescue SDKResponseError => e  
    errors = e.errors_object  
    errors.error.each do |error| 
     	 #Retrieve the error details(source, description, recoverable and reason_code) from Error object. 
     	 	 error_message = "Source:"+ error.source +"\n" +
     	 	 "ReasonCode:"+error.reason_code +"\n" +
     	 	 "Description:"+error.description +"\n" +
     	 	 "Recoverable:"+error.recoverable 
     	  puts error_message 
    end 
  end</code></pre></div>
											<h2>Logging</h2>
											<p>Logging is implemented using gem <a href="https://rubygems.org/gems/logging">logging</a>, which features a hierarchical logging system, custom level names, multiple output destinations per log event, custom formatting, and other features. The developer must set the log level and the log destination output file:</p>
											<div><pre><code>require 'logging'
Logging.logger.root.level = :debug
Logging.logger.root.appenders = Logging.appenders.file(&lt;Filename&gt;)</code></pre></div>
										</div>
									</div>
									<!-- END RUBY CONFIG -->
									<!-- PHP CONFIG -->
									<div id="phpconfig" class="tab-pane fade">
										<div class="">
											<h1 id="toc_0">PHP SDK Configurations</h1>
											<h2>Prerequisites</h2>
											<h3>Windows 7 Environment</h3>
											<ol>
												<li>XAMPP Version 1.8.3 (This setup will install PHP and Apache)</li>
												<li><a href="http://www.microsoft.com/en-us/download/details.aspx?id=5582">Microsoft Visual C++ 2008 Redistributable package</a></li>
												<li>Ensure openssl and curl extensions are enabled in php.ini.</li>
												<li>Apache rewrite module should be enabled via httpd.conf.</li>
												<li>Download required http client file guzzle.phar from https://github.com/guzzle/guzzle/releases/tag/6.0.0 and include in your file/project: 
													<div><pre><code>include_once 'guzzle.phar';</code></pre></div>
												</li>
												<li>For logging implementation, download <a href="https://logging.apache.org/log4php/install.html">Log4PHP library</a>. Download and extract folder, take source code which is located in /src/main/php. Rename php folder to “logger” and keep it in project folder.</li>
												<li>Recommend using PHPStorm or similar IDE in order to access .phar contents.</li>
											</ol>
											<h3>OS X Environment</h3>
											<p style="color: red">Coming soon</p>
											<h2>Integrate the MasterPass SDK</h2>
											<p>Include MasterCardCoreSDK.phar and MasterCardMasterPassMerchant.phar in your file/project:</p>
													<div><pre><code>include_once 'MasterCardCoreSDK.phar';
include_once 'MasterCardClientSDK.phar';</code></pre></div>

											<h2>Configuration</h2>
											<h3>1. Get private key</h3>
											<p>Prior to completing this step, the developer must have uploaded or generated a PEM encoded Certificate Request File, and generated a consumer key in the Merchant Portal as part of the onboarding process.</p>
											<div><pre><code class="language-php">public function getPrivateKey($keyId){
	$fileName = "example-file.p12";	// path to your p12 file
	$password = "password"		// your keystore password
	if (!$certStore = file_get_contents($fileName)) {
		return 'Error: Unable to read the cert file.';
	}
	if (openssl_pkcs12_read($certStore, $certInfo, "password")) {
		return $certInfo['pkey'];
	} 
	else {
		return 'Error: Unable to read the cert store.';
	}
}</code></pre></div>
<h3>2. Configure Environment</h3>
<div><pre><code>$hostUrl = "https://sandbox.api.mastercard.com";	// for sandbox
$hostUrl = "https://api.mastercard.com";		// for production

$apiConfigBuilder = new ApiConfigBuilder();
$apiConfigBuilder->setHostUrl($hostUrl);
$apiConfigBuilder->setConsumerKey("insert_consumerKey_here");
$apiConfigBuilder->setPrivateKey("insert_private_key_here");
$apiConfigBuilder->build();</code></pre></div>
											<h2>Exception Handling</h2>
											<p>The following sample code demonstrates how to get the error details from an Error object.</p>
											<div><pre><code class="language-php">try {
//Merchant checkout SDK call.
} catch (Exception $exception) {
	if ($exception instanceof SDKErrorResponseException) {
		$errors = $exception->getErrorResponse();
		$errorList = $errors->getError();
		foreach ($errorList as $error) { 
			$errorMessage = "Source:" . $error->getSource() . "\n" 
			. "ReasonCode:" . $error->getReasonCode() . "\n" . "Description:" 
			. $error->getDescription() . "\n" . "Recoverable:" . $error->getRecoverable();
		} 
	}
}</code></pre></div>
											<h2>Logging</h2>
											<h3>Implementation</h3>
											<div><pre><code>include_once "logger/Logger.php";
Logger::configure("config.xml"); 		// Skip this step to load default configuration
$logger = Logger::getLogger('main');
$logger->info("Info message");
$logger->debug("Debug message");
$logger->error("Error message");
$logger->fatal("Fatal error");</code></pre></div>
											<h3>Example Config.</h3>
											<div><pre><code>&lt;?xml version="1.0" encoding="utf-8" ?&gt;
			&lt;configuration xmlns="http://logging.apache.org/log4php/"&gt;
			    &lt;appender name="default" class="LoggerAppenderDailyFile"&gt;
			        &lt;layout class="LoggerLayoutPattern"&gt;
			            &lt;param name="conversionPattern" value="%date %logger %-5level %msg%n" /&gt;
			        &lt;/layout&gt;
						
			        &lt;param name="file" value="logs/log-%s.log" /&gt;
			        &lt;param name="datePattern" value="Y-m-d" /&gt;
			        &lt;param name="append" value="true" /&gt;
			    &lt;/appender&gt;

			    &lt;root&gt;
					&lt;level value="TRACE" /&gt;
			        &lt;appender_ref ref="default" /&gt;
			    &lt;/root&gt;
			&lt;/configuration&gt;</code></pre></div>
											
										</div>
									</div>
									<!-- END PHP CONFIG -->
									</div>
							</div>
							<!-- END SDK CONFIGURATION -->
							<!-- BEGIN SIGN UP OVERVIEW -->
							<div class="tab-pane" id="overview">
								<h1>Overview</h1>
								<p>Before your developer can integrate MasterPass with your store, you will need to complete the signup process.</p>
								<p>There are three different ways that this signup process can be completed:</p>
								<ul>
									<li>Merchants who want to integrate with MasterPass directly, without the assistance of a service provider, should choose the <a href="https://www.unboundcommerce.com/MasterPass/documentation/signup_bymerchant.html">Direct Merchant Onboarding Model</a>.</li>
									<li>Service providers who are integrating one merchant at a time should choose the <a href="https://www.unboundcommerce.com/MasterPass/documentation/Service_MerchantbyMerchant.html">Service Provider Merchant by Merchant Onboarding Model</a>.</li>
									<li>Service providers who want to use file-based or API-based methods to onboard one or mutiple merchants at a time should select the <a href="https://www.unboundcommerce.com/MasterPass/documentation/APIfile.html">File- and API-Based Merchant Onboarding Model</a>.</li>
								</ul>

								<p>To get started, contact your MasterPass representative to receive an invitation code. If you don't have a representative, fill out <a href="https://masterpass.com/#en-us/get-in-touch">this form</a> and we'll get back to you with an invitation code shortly.</p>


								<h2>Sign Up Process</h2>
								<ol>
									<li>Depending on the onboarding model chosen, either the merchant, the service provider, or both will need to create an <a href="https://masterpass.com/SP/Merchant/Home">account with MasterPass</a>.</li>
									<li>The merchant or service provider sets up the merchant business profile.</li>
									<li>The merchant or service provider will need to invite developers to create a <a href="https://masterpass.com/SP/Merchant/Home">developer account with MasterPass</a>.</li>
									<li>The developer will need to create a <a href="https://masterpass.com/SP/Merchant/Home">developer account with MasterPass</a>, and an account with <a href="https://developer.mastercard.com">MasterCard Developer Zone</a>.</li>
									<li>The developer will need to create a consumer key request in the <a href="https://developer.mastercard.com">MasterCard Developer Zone</a>.</li>
									<li>The merchant or service provider will need to approve the developer consumer key request.</li>
									<li>The developer will begin the integration process once the consumer key request has been approved.</li>
								</ol>

								
							</div>
							<!-- END SIGN UP OVERVIEW -->

<!--

ONBOARDING 

-->

							<!-- BEGIN BY MERCHANT SIGN UP -->
							<div class="tab-pane" id="bmMerchant">
								<h2 id="toc_0">Direct Merchant Onboarding Model</h2>

								<h3 id="toc_1">Merchant Account Registration</h3>

								<ol>
									<li>Navigate to <a href="https://masterpass.com/SP/Merchant/Home">https://masterpass.com/SP/Merchant/Home</a>. On the right-hand side of the page, select your country and click the <em>Create an Account button</em>.</li>
									<li> A modal window will appear. Submit your invitation code and click <em>Continue</em>.</li>
									<li>You will be asked if are registering as a merchant or as a service provider. Select <em>Merchant</em> and click <em>Continue</em>.</li>
									<li><p>Next, you are required to complete the three-step <em>Account Registration</em> process.</p>

									<p>4a. In the first step, <em>Enter Account Information</em>, fill out the fields to create your <a href="https://masterpass.com/SP/Merchant/Home">Merchant Account</a> profile. Click <em>Continue</em>.</p>

									<p>4b. Complete the second step of your <em>Account Registration</em> by selecting and answering two security questions. Click <em>Continue</em>.</p>

									<p>4c. Finish the <em>Account Registration</em> process by filling out the fields in the <em>Enter Business Information</em> step. Click <em>Finish</em>. </p></li>
								</ol>

								<h3 id="toc_2">Configure Merchant Information</h3>

								<ol>
									<li><p>When you have completed the <em>Merchant Account Registration</em>, you will be logged into your <a href="https://masterpass.com/SP/Merchant/Home">Merchant Account</a>. From here, you will need to create your checkout identifier. Optionally, you may also set shipping profiles, set up loyalty programs, and enable 3-D Secure. You can manage all of these tasks using the left-hand navigation menu. </p></li>
									<li><p>A <em>checkout identifier</em> is required to identify the merchant during all MasterPass transactions. It is also used to display the merchant&#39;s name and logo to consumers during checkout. To generate the checkout identifier, click <em>Digital Assets</em> in the navigation. Click <em>Add Assets</em> and follow the on-screen instructions. Upon saving, a checkout identifier will be generated. </p>

									<p><strong>NOTE:</strong> Merchants doing business in the US only should enter the display name and an alias, but should <em>not</em> upload a logo.</p></li>
								</ol>

								<h3 id="toc_3">Configure Merchant Shipping Profiles</h3>

								<ol>
									<li><em>Optional</em>: If your store ships physical goods, you can set up to 25 shipping location profiles. A minimum of one shipping location profile is required. A default profile, set to your company&#39;s country of incorporation, has been created automatically for you. To create a new shipping location profile, click <em>Shipping Profiles</em> in the navigation. </li>
									<li>Click the <em>Add Shipping Profile</em> button.</li>
									<li>Select your organization and create a name for your new shipping location profile.</li>
									<li>Select a region from the list shown below. All countries in the region are automatically selected. To deselect a country, click the corresponding orange arrow for that region and uncheck the box next to the country to remove.</li>
									<li>Click the checkbox in the top right to set this profile as your default shipping profile.</li>
									<li>Click the <em>Save</em> button.</li>
								</ol>

								<h3 id="toc_4">Add Merchant Loyalty Programs</h3>

								<p><em>Optional</em>: If your store provides loyalty programs for your customers, you may configure these in your account. Please note that this feature is currently only available for merchants outside of the US.</p>

								<ol>
									<li>To set loyalty programs, click the <em>Loyalty Program</em> link in the navigation. </li>
									<li>Click the <em>Add Loyalty Program</em> button. </li>
									<li>Fill out the required fields and upload a logo .The recommended dimensions for a loyalty program logo are 65x60 pixels.</li>
								</ol>

								<h3 id="toc_5">Merchant Enables 3-D Secure</h3>

								<ol>
									<li><em>Optional</em>: MasterPass supports 3-D Secure for MasterCard, Maestro and Visa cards.  MasterCard uses a third party, Cardinal Commerce, as a Merchant Plug In (MPI) for the 3-D Secure step-up process. When set up, the 3-D Secure user interface will be involved for all checkout transactions for the selected card brand. To enable this feature, select <em>Authentication Settings</em> from the navigation menu. </li>
									<li>Click the <em>Add Acquirer</em> button.</li>
									<li>Select your organization and enter your acquirer ID (BIN) and assigned merchant ID. The Brand and Acquirer Name fields will be filled out automatically. Select your supported currencies under that acquirer.</li>
									<li>Click the <em>Save</em> button.</li>
									<li><p>After you have added an acquirer, make sure to select the <em>Advanced Checkout</em> checkbox for each card brand to enable that brand. </p>

									<p><strong>NOTE</strong>: Select MasterCard for both MasterCard and Maestro acquirers.</p>

									<p><strong>NOTE</strong>: Cardinal Commerce must have your acquirer in their system before it can be active for 3-D secure.  If you add an acquirer not yet submitted to Cardinal, you will see the item <em>Unknown Acquirers</em> in your list of acquirers. Click this item to view the link to download the <a href="http://masterpass.com/hub/downloads/AcquirerForm.pdf">Acquirer Certificate Request Form</a>. Fill out and submit this form to Cardinal Commerce for processing. Acquirer setup should take 3–5 business days from submission of this form. </p></li>
								</ol>

								<h3 id="toc_6">Add Developer(s) to Merchant Profile</h3>

								<ol>
									<li>Next, you must add your developer(s) to the project. Click the <em>Developers</em> item in the navigation menu.</li>
									<li>Click the <em>Add a Developer</em> button. </li>
									<li><p>You will be presented with three options. If you have hired a developer to complete your integration, select <em>An Internal or Contracted Developer</em> and click <em>Next</em>. The window will then present a form that collects contact information for the developer. Fill out this form and click <em>Complete</em>. The developer will receive an email containing instructions to complete their account registration.</p>

									<p>3a. <em>Optional:</em> To invite another administrator to the project, select <em>I&#39;m not sure</em> and click the <em>Next</em> button. To proceed with the invitation, click the <em>Do this now</em> button; otherwise, click <em>Complete</em>. If you did choose to add another administrator, you will be presented with a form that collects the administrator&#39;s contact information. After you submit the form, the administrator will receive an email containing instructions to complete their account registration.</p>

									<p>3b. <em>Optional:</em> If you would instead prefer to invite a service provider to complete your integration, select <em>A Third Party Platform Provider</em> and click <em>Next</em>. Then, select your provider from the dropdown menu and click <em>Complete</em>. The service provider will receive an email containing instructions to complete their account registration. Your service provider should refer to the <strong>Service Provider Merchant By Merchant</strong> instructions to complete the integration.</p></li>
								</ol>
								<h3 id="toc_9">Merchant Approves Key</h3>

								<ol>
									<li>After the developer creates the key, the merchant approves the key by logging into their <a href="https://masterpass.com/SP/Merchant/Home">Merchant Account</a> and clicking the <em>Key Management</em> navigation item. The merchant selects the developer that created the key request by clicking the corresponding orange arrow. </li>
									<li><p>The merchant can then view any pending keys created by that developer. Click the <em>Approve</em> button to approve the pending key. The developer will receive email confirmation that the key was approved.</p>

								</ol>
							</div>

							<div class="tab-pane" id="bmDeveloper">
								<h2 id="toc_0">Direct Merchant Onboarding Model</h2>

								<h3 id="toc_7">MasterPass Developer Account Registration</h3>

								<ol>
									<li>After the merchant invites you as a developer, you will receive two emails from MasterCard, one with a UserId and one with a password. Click the link in either email to sign into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a> with the credentials emailed to you.</li>
									<li>Follow the prompts to reset your password and set security questions.</li>
									<li>You will be taken to the <em>Manage Development</em> section of your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a>. Your first task here is to register with the <a href="https://developer.mastercard.com">MasterCard Developer Zone</a>. Click <em>Start This Step</em> to navigate to the <a href="https://developer.mastercard.com">Developer Zone</a> and begin your registration.</li>
									<li>After your browser redirects to the <a href="https://developer.mastercard.com">Developer Zone</a>, click the <em>Register</em> link in the top righthand corner. </li>
									<li>Fill out the fields in the modal window and click <em>Sign Up</em>. </li>
									<li>You will then see a message prompting you to check your inbox for a confirmation email. Click the activation link in the confirmation email to complete your registration.</li>
								</ol>

								<h3 id="toc_8">Developer Creates Consumer Key</h3>

								<ol>
									<li>As the developer, before you can begin the integration, you need to create a merchant-approved <em>consumer key</em> in order to interact with the MasterPass services. To begin this process, log into your <a href="https://developer.mastercard.com">Developer Zone Account</a>.</li>
									<li>Select <em>My Projects</em> from the left-hand navigation. </li>
									<li><p>Click the <em>MasterPass Merchant Keys</em> button on the top right-hand corner of the <em>Get Started</em> page. Follow the workflow on the page to generate MasterPass sandbox and production keys. 
									<strong>Note:</strong> You will need to supply a PEM encoded Certificate Request File in order to get an API Key.  You may use the <a href="www.todo.com">CSR Generation Tool</a> to easily create this file. Alternately, you can instead supply a PEM encoded Certificate Request File using a tool of your choice, such as OpenSSL or Java Keytool. Choose your preferred method and complete the steps.</p>

									<p><strong>Note:</strong> When naming your keys, we recommend adding the prefix &quot;SBX_&quot; or &quot;PRD_&quot; to make it easy to distinguish between sandbox and production keys.</p></li>
									<li><p>Log into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a> and select <em>Key Management</em> in the navigation menu. You may be asked to provide your <a href="https://developer.mastercard.com">Developer Zone</a> login credentials.</p></li>
									<li><p>Click the <em>Create Consumer Key</em> button. </p></li>
									<li><p>Select the environment and click <em>Continue</em>. </p></li>
									<li><p>Next, click the <em>Browse Keys</em> button. </p></li>
									<li><p>The key you created in the <a href="https://developer.mastercard.com">Developer Zone</a> will appear as an option. Select this key and click <em>Submit for Approval</em>. The merchant will receive an email request to approve this pending key.</p></li>
								</ol>

								<p><strong>NOTE:</strong> The developer must create separate sandbox and production keys. Keys expire after one year, and have to be renewed by initiating the <a href="www.linktokeyrenewal.com">Developer Zone Key Renewal Process</a>.</p>

							</div>
							<!-- END BY MERCHANT SIGN UP -->

							<!-- BEGIN BY MERCHANT BY MERCHANT MODEL -->
							<div class="tab-pane" id="mbmService">
								<h2 id="toc_0">Service Provider Merchant by Merchant</h2>

								<h3 id="toc_1">Service Provider Account Registration</h3>

								<ol>
									<li>Navigate to <a href="https://masterpass.com/SP/Merchant/Home">https://masterpass.com/SP/Merchant/Home</a>. On the right-hand side of the page, select your country and click the <em>Create an Account button</em>.</li>
									<li> A modal window will appear. Submit your invitation code and click <em>Continue</em>.</li>
									<li>A popup window will ask if you are registering as a merchant or as a service provider. Select <em>Service Provider</em> and click <em>Continue</em>.</li>
									<li><p>Next, you are required to complete the three-step <em>Account Registration</em> process.</p>

									<p>4a. In the first step, <em>Enter Account Information</em>, fill out the fields to create your service provider account profile. Click <em>Continue</em>.</p>

									<p>4b. Complete the second step of your <em>Account Registration</em> by selecting and answering two security questions. Click <em>Continue</em>.</p>

									<p>4c. Finish the <em>Account Registration</em> process by filling out the fields in the <em>Enter Business Information</em> step. Click <em>Finish</em>. </p></li>
								</ol>

								<h3 id="toc_2">Set Availability to Merchants</h3>

								<ol>
									<li>When you have completed the <em>Service Provider Account Registration</em>, you will be logged into your <a href="https://masterpass.com/SP/Merchant/Home">Service Provider Account</a>. Click the <em>Account Settings</em> menu item in the top righthand corner. </li>
									<li>Click the checkbox that reads, &quot;I want merchants to be able to select me to perform their MasterPass implementation&quot;. This setting makes you visible to merchants seeking a service provider.</li>
								</ol>

								<h3 id="toc_3">Add Developer(s) to Service Provider Profile</h3>

								<ol>
									<li>Next, you must add the developer(s) who will integrate MasterPass on behalf of your merchant(s). Click the <em>Developers</em> item in the navigation menu.</li>
									<li>Click the <em>Add a Developer</em> button.<br></li>
									<li><p>In the modal that appears, select <em>An Internal or Contracted Developer</em> and click <em>Next</em>. The window will then present a form that collects contact information for the developer. Fill out this form and click <em>Complete</em>. The developer will receive an email containing instructions to complete their account registration. See the <strong>Developer Account Registration</strong> step for more details.</p>

									<p>3a. <em>Optional:</em> To invite another administrator to the project, select <em>I&#39;m not sure</em> and click the <em>Next</em> button. To proceed with the invitation, click the <em>Do this now</em> button; otherwise, click <em>Complete</em>. If you did choose to add another administrator, you will be presented with a form that collects the administrator&#39;s contact information. After you submit the form, the administrator will receive an email containing instructions to complete their account registration.</p></li>
								</ol>

								<h3 id="toc_12">Service Provider Approves Key</h3>

								<ol>
									<li>After the developer creates the key, the service provider approves the key by logging into their <a href="https://masterpass.com/SP/Merchant/Home">Service Provider Account</a> and clicking the <em>Key Management</em> navigation item. The service provider selects the developer that created the key request by clicking the corresponding orange arrow. </li>
									<li>The service provider can then view any pending keys created by that developer. Click the <em>Approve</em> button to approve the pending key. The developer will receive email confirmation that the key was approved.</li>
								</ol>
							</div>

							<div class="tab-pane" id="mbmMerchant">
								<h2 id="toc_0">Service Provider Merchant by Merchant</h2>

								<h3 id="toc_4">Merchant Registration and Setup</h3>

								<ol>
									<li>Navigate to <a href="https://masterpass.com/SP/Merchant/Home">https://masterpass.com/SP/Merchant/Home</a>. On the right-hand side of the page, select your country and click the <em>Create an Account button</em>.</li>
									<li> A modal window will appear. Submit your invitation code and click <em>Continue</em>.</li>
									<li>You will be asked if are registering as a merchant or as a service provider. Select <em>Merchant</em> and click <em>Continue</em>.</li>
									<li><p>Next, you are required to complete the three-step <em>Account Registration</em> process.</p>

									<p>4a. In the first step, <em>Enter Account Information</em>, fill out the fields to create your <a href="https://masterpass.com/SP/Merchant/Home">Merchant Account</a> profile. Click <em>Continue</em>.</p>

									<p>4b. Complete the second step of your <em>Account Registration</em> by selecting and answering two security questions. Click <em>Continue</em>.</p>

									<p>4c. Finish the <em>Account Registration</em> process by filling out the fields in the <em>Enter Business Information</em> step. Click <em>Finish</em>.   </p></li>
								</ol>

								<h3 id="toc_5">Configure Merchant Information</h3>

								<ol>
									<li><p>When you have completed the <em>Merchant Account Registration</em>, you will be logged into your <a href="https://masterpass.com/SP/Merchant/Home">Merchant Account</a>. From here, you will need to create your checkout identifier. Optionally, you may also set shipping profiles, set up loyalty programs, and enable 3-D Secure. You can manage all of these tasks using the left-hand navigation menu. </p></li>
									<li><p>A <em>checkout identifier</em> is required to identify the merchant during all MasterPass transactions. It is also used to display the merchant&#39;s name and logo to consumers during checkout. To generate the checkout identifier, click <em>Digital Assets</em> in the navigation. Click <em>Add Assets</em> and follow the on-screen instructions. Upon saving, a checkout identifier will be generated. </p>

									<p><strong>NOTE:</strong> Merchants doing business in the US only should enter the display name and an alias, but should <em>not</em> upload a logo.</p></li>
								</ol>

								<h3 id="toc_6">Configure Merchant Shipping Profiles</h3>

								<ol>
									<li><em>Optional</em>: If your store ships physical goods, you can set up to 25 shipping location profiles. A minimum of one shipping location profile is required. A default profile, set to your company&#39;s country of incorporation, has been created automatically for you. To create a new shipping location profile, click <em>Shipping Profiles</em> in the navigation. </li>
									<li>Click the <em>Add Shipping Profile</em> button.</li>
									<li>Select your organization and create a name for your new shipping location profile.</li>
									<li>Select a region from the list shown below. All countries in the region are automatically selected. To deselect a country, click the corresponding orange arrow for that region and uncheck the box next to the country to remove.</li>
									<li>Click the checkbox in the top right to set this profile as your default shipping profile.</li>
									<li>Click the <em>Save</em> button.</li>
								</ol>

								<h3 id="toc_7">Add Merchant Loyalty Programs</h3>

								<p><em>Optional</em>: If your store provides loyalty programs for your customers, you may configure these in your account. Please note that this feature is currently only available for merchants outside of the US. </p>

								<ol>
									<li>If your store provides loyalty programs, you may set loyalty programs by clicking the <em>Loyalty Program</em> link in the navigation. </li>
									<li>Click the <em>Add Loyalty Program</em> button. </li>
									<li>Fill out the required fields and upload a logo .The recommended dimensions for a loyalty program logo are 65x60 pixels.</li>
								</ol>

								<h3 id="toc_8">Merchant Enables 3-D Secure</h3>

								<ol>
									<li><em>Optional</em>: MasterPass supports 3-D Secure for MasterCard, Maestro and Visa cards.  MasterCard uses a third party, Cardinal Commerce, as a Merchant Plug In (MPI) for the 3-D Secure step-up process. When set up, the 3-D Secure user interface will be involved for all checkout transactions for the selected card brand. To enable this feature, select <em>Authentication Settings</em> from the navigation menu. </li>
									<li>Click the <em>Add Acquirer</em> button.</li>
									<li>Select your organization and enter your acquirer ID (BIN) and assigned merchant ID. The Brand and Acquirer Name fields will be filled out automatically. Select your supported currencies under that acquirer.</li>
									<li>Click the <em>Save</em> button.</li>
									<li><p>After you have added an acquirer, make sure to select the <em>Advanced Checkout</em> checkbox for each card brand to enable that brand. </p>

									<p><strong>NOTE</strong>: Select MasterCard for both MasterCard and Maestro acquirers.</p>

									<p><strong>NOTE</strong>: Cardinal Commerce must have your acquirer in their system before it can be active for 3-D secure.  If you add an acquirer not yet submitted to Cardinal, you will see the item <em>Unknown Acquirers</em> in your list of acquirers. Click this item to view the link to download the <a href="http://masterpass.com/hub/downloads/AcquirerForm.pdf">Acquirer Certificate Request Form</a>. Fill out and submit this form to Cardinal Commerce for processing. Acquirer setup should take 3–5 business days from submission of this form. </p></li>
								</ol>

								<h3 id="toc_9">Invite Service Provider to Perform Integration</h3>

								<ol>
									<li>Next, you will select a service provider to perform your MasterPass integration. Click the <em>Developers</em> item in the navigation, and then click the <em>Add a Developer</em> button.</li>
									<li>Select <em>A third party platform provider</em> and then click <em>Next</em>.</li>
									<li>Select the service provider from the drop down list and then click <em>Complete</em>. The service provider will receive an email from MasterPass inviting them to handle the integration on your behalf. </li>
								</ol>
							</div>
							<div class="tab-pane" id="mbmDeveloper">
								<h2 id="toc_0">Service Provider Merchant by Merchant</h2>

								<h3 id="toc_10">MasterPass Developer Account Registration</h3>

								<ol>
									<li>After the service provider invites you as a developer, you will receive two emails from MasterCard, one with a UserId and one with a password. Click the link in either email to sign into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a> with the credentials emailed to you.</li>
									<li>Follow the prompts to reset your password and set security questions.</li>
									<li>Next, you will be taken to the <em>Manage Development</em> section of your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a>. Your first task here is to register with the <a href="https://developer.mastercard.com">MasterCard Developer Zone</a>, where you can view integration documentation and generate developer keys. Click <em>Start This Step</em> to navigate to the <a href="https://developer.mastercard.com">Developer Zone</a> and begin your registration.</li>
									<li>After your browser redirects to the <a href="https://developer.mastercard.com">Developer Zone</a>, click the <em>Register</em> link in the top righthand corner.</li>
									<li>Fill out the fields in the modal window and click <em>Sign Up</em>.</li>
									<li>You will then see a message prompting you to check your inbox for a confirmation email. Click the activation link in the confirmation email to complete your registration.<br></li>
								</ol>

								<h3 id="toc_11">Developer Creates Consumer Key</h3>

								<ol>
									<li>As the developer, before you can begin the integration, you need to create a <em>consumer key</em> in order to interact with the MasterPass services. To begin this process, log into the <a href="https://developer.mastercard.com">Developer Zone</a>.</li>
									<li>Select <em>My Projects</em> from the left-hand navigation. </li>
									<li><p>Click the <em>MasterPass Merchant Keys</em> button on the top right-hand corner of the <em>Get Started</em> page. Follow the workflow on the page to generate MasterPass sandbox and production keys. 
									<strong>Note:</strong> You will need to supply a PEM encoded Certificate Request File in order to get an API Key.  You may use the <a href="www.todo.com">CSR Generation Tool</a> to easily create this file. Alternately, you can instead supply a PEM encoded Certificate Request File using a tool of your choice, such as OpenSSL or Java Keytool. Choose your preferred method and complete the steps.</p></li>
									<li><p>Log into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a> and select <em>Key Management</em> in the navigation menu. You may be asked to provide your <a href="https://developer.mastercard.com">Developer Zone</a> login credentials.</p></li>
									<li><p>Click the <em>Create Consumer Key</em> button. </p></li>
									<li><p>Select the environment and click <em>Continue</em>. </p></li>
									<li><p>Next, click the <em>Browse Keys</em> button. </p></li>
									<li><p>The key you created in the <a href="https://developer.mastercard.com">Developer Zone</a> will appear as an option. Select this key and click <em>Submit for Approval</em>. The service provider will receive an email request to approve this pending key.</p>

									<p><strong>NOTE:</strong> You need to create separate sandbox and production keys. Keys expire after one year, and have to be renewed by initiating the <a href="www.linktokeyrenewal.com">Developer Zone Key Renewal Process</a>. </p></li>
								</ol>
							</div>
							<!-- END BY MERCHANT BY MERCHANT MODEL -->

							<!-- BEGIN FILE / API -->
							<div class="tab-pane" id="fileapiprovider">
								<h2 id="toc_0">Service Provider File and API Onboarding Model</h2>

								<h3 id="toc_1">Service Provider Account Registration</h3>

								<ol>
									<li>Navigate to <a href="https://masterpass.com/SP/Merchant/Home">https://masterpass.com/SP/Merchant/Home</a>. On the right-hand side of the page, select your country and click the <em>Create an Account button</em>.</li>
									<li> A modal window will appear. Submit your invitation code and click <em>Continue</em>.</li>
									<li>A popup window will ask if you are registering as a merchant or as a service provider. Select <em>Service Provider</em> and click <em>Continue</em>.</li>
									<li><p>Next, you are required to complete the three-step <em>Account Registration</em> process.</p>

									<p>4a. In the first step, <em>Enter Account Information</em>, fill out the fields to create your service provider account profile. Click <em>Continue</em>.</p>

									<p>4b. Complete the second step of your <em>Account Registration</em> by selecting and answering two security questions. Click <em>Continue</em>.</p>

									<p>4c. Finish the <em>Account Registration</em> process by filling out the fields in the <em>Enter Business Information</em> step. Click <em>Finish</em>. </p></li>
								</ol>

								<h3 id="toc_2">Service Provider Sets Merchant Shipping Locations</h3>

								<ol>
									<li><em>Optional</em>: If any of your merchants ship physical goods, you can set up shipping location profiles to specify where they can ship. To create a new shipping location profile, log into your <a href="https://masterpass.com/SP/Merchant/Home">Service Provider Account</a> and click Shipping Profiles in the navigation. </li>
									<li>Click the <em>Add Shipping Profile</em> button.</li>
									<li>Select your organization and create a name for your new shipping location profile.</li>
									<li>Select a region from the list shown below. All countries in the region are automatically selected. To deselect a country, click the corresponding orange arrow for that region and uncheck the box next to the country to remove.</li>
									<li>Click the checkbox in the top right to set this profile as your default shipping profile.</li>
									<li>Click the <em>Save</em> button.</li>
								</ol>

								<h3 id="toc_3">Add Developer(s) to Service Provider Profile</h3>

								<ol>
									<li>Next, you must add the developer(s) who will integrate MasterPass on behalf of your merchant(s). Log into your <a href="https://masterpass.com/SP/Merchant/Home">Service Provider Account</a> and click the <em>Developers</em> item in the navigation menu. </li>
									<li>Click the <em>Add a Developer</em> button.<br></li>
									<li><p>In the modal that appears, select <em>An Internal or Contracted Developer</em> and click <em>Next</em>. The window will then present a form that collects contact information for the developer. Fill out this form and click <em>Complete</em>. The developer will receive an email containing instructions to complete their account registration. See the <strong>MasterPass Developer Account Registration</strong> step for more details.</p>

									<p>3a. <em>Optional:</em> To invite another administrator to the project, select <em>I&#39;m not sure</em> and click the <em>Next</em> button. To proceed with the invitation, click the <em>Do this now</em> button; otherwise, click <em>Complete</em>. If you did choose to add another administrator, you will be presented with a form that collects the administrator&#39;s contact information. After you submit the form, the administrator will receive an email containing instructions to complete their account registration.</p></li>
								</ol>

								<h3 id="toc_6">Service Provider Approves Key</h3>

								<ol>
								<li>After the developer creates the key, the service provider approves the key by logging into their <a href="https://masterpass.com/SP/Merchant/Home">Service Provider Account</a> and clicking the <em>Key Management</em> navigation item. The service provider selects the developer that created the key request by clicking the corresponding orange arrow. </li>
								<li>The service provider can then view any pending keys created by that developer. Click the <em>Approve</em> button to approve the pending key. The developer will receive email confirmation that the key was approved.</li>
								</ol>
							</div>

							<div class="tab-pane" id="fileapideveloper">
								<h2 id="toc_0">Service Provider File and API Onboarding Model</h2>

								<h3 id="toc_4">MasterPass Developer Account Registration</h3>

								<ol>
									<li>After the service provider invites you as a developer, you will receive two emails from MasterCard, one with a UserId and one with a password. Click the link in either email to sign into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a> with the credentials emailed to you.</li>
									<li>Follow the prompts to reset your password and set security questions.</li>
									<li>Next, you will be taken to the <em>Manage Development</em> section of your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a>. Your first task here is to register with the <a href="https://developer.mastercard.com">MasterCard Developer Zone</a>, where you can view integration documentation and generate developer keys. Click <em>Start This Step</em> to navigate to the <a href="https://developer.mastercard.com">Developer Zone</a> and begin your registration.</li>
									<li>After your browser redirects to the <a href="https://developer.mastercard.com">Developer Zone</a>, click the <em>Register</em> link in the top righthand corner.</li>
									<li>Fill out the fields in the modal window and click <em>Sign Up</em>.</li>
									<li>You will then see a message prompting you to check your inbox for a confirmation email. Click the activation link in the confirmation email to complete your registration.<br></li>
								</ol>

								<h3 id="toc_5">Developer Creates Consumer Key</h3>

								<ol>
									<li>As the developer, before you can begin the integration, you need to create a <em>consumer key</em> in order to interact with the MasterPass services. To begin this process, log into the <a href="https://developer.mastercard.com">Developer Zone</a>.</li>
									<li>Select <em>My Projects</em> from the left-hand navigation. </li>
									<li><p>Click the <em>MasterPass Merchant Keys</em> button on the top right-hand corner of the <em>Get Started</em> page. Follow the workflow on the page to generate MasterPass sandbox and production keys. 
									<strong>Note:</strong> You will need to supply a PEM encoded Certificate Request File in order to get an API Key.  You may use the <a href="www.todo.com">CSR Generation Tool</a> to easily create this file. Alternately, you can instead supply a PEM encoded Certificate Request File using a tool of your choice, such as OpenSSL or Java Keytool. Choose your preferred method and complete the steps.</p></li>
									<li><p>Log into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a> and select <em>Key Management</em> in the navigation menu. You may be asked to provide your <a href="https://developer.mastercard.com">Developer Zone</a> login credentials.</p></li>
									<li><p>Click the <em>Create Consumer Key</em> button. </p></li>
									<li><p>Select the environment and click <em>Continue</em>. </p></li>
									<li><p>Next, click the <em>Browse Keys</em> button. </p></li>
									<li><p>The key you created in the <a href="https://developer.mastercard.com">Developer Zone</a> will appear as an option. Select this key and click <em>Submit for Approval</em>. The service provider will receive an email request to approve this pending key.</p>

									<p><strong>NOTE:</strong> You need to create separate sandbox and production keys. Keys expire after one year, and have to be renewed by initiating the <a href="www.linktokeyrenewal.com">Developer Zone Key Renewal Process</a>. </p></li>
								</ol>

								<h3 id="toc_6">File-Based Onboarding</h3>

								<p>Developers can upload XML files to add, update, or delete merchant records. Use the file templates referenced <a href="www.todo.com">here - schema files and swagger file?</a> and view the sample below to upload and create a project.  </p>

								<h4 id="toc_7">Create Merchant Record</h4>

								<ol>
									<li><p>Sign into your <a href="https://masterpass.com/SP/Merchant/Home">MasterPass Developer Account</a>. Navigate to the <em>Merchant File Upload</em> menu item.</p></li>
									<li><p>Click the <em>Upload</em> button in the top right. </p></li>
									<li><p>First, you must add a merchant record. All merchant elements shown below (SPMerchantId, Action, Profile, CheckoutBrand) are required when adding a new merchant. Set the <em>Action</em> to <strong>C</strong>.</p>

								<div><pre><code class="language-markup">&lt;MerchantUpload&gt;
    &lt;Merchant&gt;
        &lt;SPMerchantId&gt;SPMerchantId1&lt;/SPMerchantId&gt;
        &lt;Action&gt;C&lt;/Action&gt;
        &lt;Profile&gt;
            &lt;Name&gt;SPMerch58401&lt;/Name&gt;
            &lt;DoingBusAs&gt;SPMerch58401&lt;/DoingBusAs&gt;
            &lt;Address&gt;
                &lt;City&gt;SPMerch58401&lt;/City&gt;
                &lt;Country&gt;US&lt;/Country&gt;
                &lt;Line1&gt;898 SPMerch58401&lt;/Line1&gt;
                &lt;PostalCode&gt;78090&lt;/PostalCode&gt;
            &lt;/Address&gt;
            &lt;Phone&gt;
                &lt;CountryCode&gt;1&lt;/CountryCode&gt;
                &lt;Number&gt;3734517671&lt;/Number&gt;
            &lt;/Phone&gt;
            &lt;Acquirer&gt;
                &lt;Id&gt;292978156&lt;/Id&gt;
                &lt;Name&gt;QATESTACQ&lt;/Name&gt;
                &lt;AssignedMerchantId&gt;MCQA1&lt;/AssignedMerchantId&gt;
            &lt;/Acquirer&gt;
        &lt;/Profile&gt;
        &lt;CheckoutBrand&gt;
            &lt;Name&gt;SPMerch58401&lt;/Name&gt;
            &lt;DisplayName&gt;SPMerch58401&lt;/DisplayName&gt;
            &lt;ProductionUrl&gt;https://SPMerch58401.com&lt;/ProductionUrl&gt;
            &lt;SandboxUrl&gt;https://SPMerch58401.com&lt;/SandboxUrl&gt;
        &lt;/CheckoutBrand&gt;
    &lt;/Merchant&gt;
&lt;/MerchantUpload&gt;</code></pre></div></li>
									<li><p>To upload your XML file, click the <em>Upload</em> button. </p></li>
									<li><p>Click <em>Choose File</em> to select your XML file. Enter a brief description of the file, and click the <em>Upload</em> button. </p></li>
									<li><p>When the file is finished processing, a message will display, indicating the number of successful and failed records processed. You will also receive an email notifying you that the file has been processed.</p></li>
									<li><p>Click the <em>Download Result File</em> button to view the results of the XML file processing. This file contains the merchant ID and checkout identifier for each uploaded merchant.</p></li>
								</ol>

								<h4 id="toc_8">Optional - Add Reward Program</h4>

								<ol>
									<li><p>You may add a reward program for customers to use during MasterPass transactions. Please note that this feature is only available to MasterPass consumers outside of the United States.</p>

								<div><pre><code class="language-markup">&lt;MerchantUpload&gt;
    &lt;Merchant&gt;
        &lt;SPMerchantId&gt;SPMerchantId1&lt;/SPMerchantId&gt;
        ...
        &lt;RewardProgram&gt;
            &lt;Name&gt;RAMATSR9&lt;/Name&gt;
            &lt;Id&gt;RAMATSR9&lt;/Id&gt;
            &lt;LogoUrl&gt;http://www.mastercard.us/_globalAssets/img/nav/navl_logo_mastercardcom.png&lt;/LogoUrl&gt;
        &lt;/RewardProgram&gt;
        ...
    &lt;/Merchant&gt;
&lt;/MerchantUpload&gt;</code></pre></div></li>
								</ol>

								<h4 id="toc_9">Optional - Add 3D-S Authentication</h4>

								<ol>
									<li><p>Add 3D-S authentication to this merchant account to allow your merchant to complete the 3-D Secure protocol during MasterPass transactions. </p>

									<p><strong>NOTE</strong>: You may not have two Merchant Acquirers with both the same currency and the same CardBrand. </p>

								<div><pre><code class="language-markup">&lt;MerchantUpload&gt;
    &lt;Merchant&gt;
        &lt;SPMerchantId&gt;SPMerchantId1&lt;/SPMerchantId&gt;
        ...
        &lt;AuthOption&gt;
            &lt;CardBrand&gt;MASTER_CARD&lt;/CardBrand&gt;
            &lt;Type&gt;ALL_TRANSACTIONS&lt;/Type&gt;
        &lt;/AuthOption&gt;
        &lt;MerchantAcquirer&gt;
            &lt;Acquirer&gt;
                &lt;Id&gt;523078&lt;/Id&gt;
                &lt;Name&gt;CartaSI&lt;/Name&gt;
                &lt;AssignedMerchantId&gt;001&lt;/AssignedMerchantId&gt;
            &lt;/Acquirer&gt;
            &lt;MerchantAcquirerBrand&gt;
                &lt;CardBrand&gt;MASTER_CARD&lt;/CardBrand&gt;
                &lt;Currency&gt;EUR&lt;/Currency&gt;
            &lt;/MerchantAcquirerBrand&gt;
        &lt;/MerchantAcquirer&gt;
        ...
    &lt;/Merchant&gt;
&lt;/MerchantUpload&gt;</code></pre></div></li>
								</ol>

									<h4 id="toc_10">Optional - Validate XML Files Before Submitting</h4>

								<ol>
									<li><p>If you prefer, you may verify your file submission for schema and business rules validation before uploading it. This will allow you to identify and fix any errors before submitting your file for processing. Click the <em>Validate File</em> button, select your file, and click <em>Validate Now</em>. </p>

									<p>1a. If your file successfully follows all rules, you will receive the message &quot;Validation complete, no errors found.&quot; </p>

									<p>1b. Otherwise, you will be instructed to fix your error(s) and resubmit the file. To view the errors, click the <em>Download Result File</em> button.</p>

									<h5 id="toc_11">XML Schema Validation Error Message Example</h5>

								<div><pre><code class="language-markup">&lt;MerchantDownload&gt;
    &lt;Summary&gt;
        &lt;ErrorText&gt;1337: String Length for
Merchant_Upload.MerchantAcquirer.Acquirer.Name needs to be greater than 1 and
less than or equal to 250 characters&lt;/ErrorText&gt;
    &lt;/Summary&gt;
&lt;/MerchantDownload&gt;</code></pre></div>

								<h4 id="toc_9">Business Rule Error Codes</h4>
								<div class="tableWrapper">
									<table class="BusinessRuleCodes">
										<thead>
											<tr>
												<th>Error Codes</th>
												<th>Description</th>
												<th>Sample Error Message</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<th>VBMU0100</th>
												<td>Validate that a provided checkout brand data element exists.</td>
												<td>VBMU0100: minimum of one checkoutBrand required : merchant-spMerchantId=STGQA09</td>
											</tr>
											<tr>
												<th>VBMU0101</th>
												<td>Validate that a merchant with action code &quot;C&quot; does not include any brandings with checkout identifiers.</td>
												<td>VBMU0101: checkoutBrand cannot include checkout identifiers on create : checkoutId=a4a6w4vnkdeazi6c6ynxk1i6cdd6e2aki</td>
											</tr>
											<tr>
												<th>VBMU0102</th>
												<td>Validate that a provided checkout identifier exists when using Action Code &quot;U&quot; within CheckoutBrandĘdata element.</td>
												<td>VBMU0102: checkoutBrand does not exist : checkoutId=a4d6x344fquvhi8ix0 v6n1i8udwvar1zv6</td>
											</tr>
											<tr>
												<th>VBMU0110</th>
												<td>For Merchant Action Code “U” and Merchant Acquirer Action Code “C,&quot; validate the merchant acquirer doesn’t exist in Cardinal Commerce.</td>
												<td>VBMU0110: invalid merchant acquirer actionCode during create : actionCode=U</td>
											</tr>
											<tr>
												<th>VBMU0111</th>
												<td>For Merchant Action Code “U” and Merchant Acquirer Action Codes “U” or “D,&quot; validate the merchant acquirer does exist in Cardinal Commerce.</td>
												<td>VBMU0111: invalid merchant acquirer action code: U or D</td>
											</tr>
											<tr>
												<th>VBMU0112</th>
												<td>Validate Profile data element exists in the MerchantUpload XML file.</td>
												<td>VBMU0112: merchant create requires profile for spMerchantId=STGQA09</td>
											</tr>
											<tr>
												<th>VBMU0120</th>
												<td>Validate Reward Program Name is Unique</td>
												<td>VBMU0120: reward program name must be unique: RAMAQA312, spMerchantId=STGQA09</td>
											</tr>
											<tr>
												<th>VBMU0121</th>
												<td>Validate Reward Program ID is Unique</td>
												<td>VBMU0121: reward program id must be unique: RAMAQA312, spMerchantId=STGQA09</td>
											</tr>
											<tr>
												<th>VBMU0130</th>
												<td>Validate a Merchant Acquirer is provisioned in Cardinal for a specified CardBrand.</td>
												<td>VBMU0130: no merchant acquirer for cardbrand type=MAESTRO</td>
											</tr>
											<tr>
												<th>VBMU0140</th>
												<td>Validate SPMerchantID is Unique when applying Merchant Action Code of “C.”</td>
												<td>VBMU0140: merchantId already exists for serviceProviderId=305960760 and spMerchantId=STGQA03</td>
											</tr>
											<tr>
												<th>VBMU0141</th>
												<td>Validate Merchant Acquirer ID is unique when applying Merchant Action Code of “C.”</td>
												<td>VBMU0141: invalid merchant acquirer actionCode=C : acquirer record already exists : acquirerId=523078 assignedMerchantId=001test cardBrand=MASTERCARD currencyCode=EUR</td>
											</tr>
											<tr>
												<th>VBMU0142</th>
												<td>Validate Merchant Acquirer ID exists in Cardinal Commerce.</td>
												<td>VBMU0142: acquirer id does not exist : id=88848888, cardBrand=MASTERCARD</td>
											</tr>
											<tr>
												<th>VBMU0150</th>
												<td>Validate SPMerchantID exists for Merchant Action Codes &quot;U&quot; or &quot;D&quot;.</td>
												<td>VBMU0150: merchant not found for update or delete</td>
											</tr>
											<tr>
												<th>VBMU0160</th>
												<td>Validate the SPMerchantID is alphanumeric and less than 25 characters.</td>
												<td>VBMU0160: invalid assignedMerchantId=STGAPI21_******5681M, must be alpha-numeric and less than 25 characters in length</td>
											</tr>
											<tr>
												<th>VBMU0170</th>
												<td>Validate the Merchant Acquirer CurrencyCode is supported by Cardinal Commerce.</td>
												<td>VBMU0170: unsupported currency code : USD</td>
											</tr>
											<tr>
												<th>VBMU0171</th>
												<td>Validate two merchant acquirers of the same CardBrand are not configured to support the same currency by Cardinal Commerce.</td>
												<td>VBMU0171: acquirer card brand currency code pairing must be unique</td>
											</tr>
										</tbody>
										</table>
									</div></li>
								</ol>

								<h3 id="toc_14">Single Merchant API Onboarding</h3>

								<p>Services providers who have already completed the <strong>File-Based Onboarding</strong> step at least once have the option to use API-based onboarding to create, update, and delete merchant records directly to production. Providers may use the <em>Single Merchant API Service</em>, along with a production <em>consumer key</em> and merchant <em>checkout id</em> to update merchant records in real time.</p>

								<ol>
									<li>After your XML file from the <strong>File-Based Onboarding</strong> process has been submitted, confirm that an <em>Open Feed Project</em> appears at the top of the project list of your <a href="https://masterpass.com/SP/Merchant/Home">Developer Account</a>. </li>
									<li>Get the <em>Project ID</em> from the <em>Open Feed Project</em>. </li>
									<li>Using the same schema as you used in the <em>File-Based Onboarding</em>, create your XML file. Only a single merchant may be added or updated at a time. </li>
									<li>Follow the example shown below to make a <em>Single Merchant API</em> service call. </li>
								</ol>

								<p>Use the following parameters to make your HTTP request:</p>

								<ul>
									<li><strong>checkoutproject:</strong> Your <em>Project ID</em> from Step 2. Use the URL format https://api.mastercard.com/masterpasspsp/v6/checkoutproject/<strong>projectID</strong>/file. </li>
									<li><strong>oauth_body_hash:</strong> SHA1 hash of the message body.</li>
									<li><strong>oauth_consumer_key:</strong> Your <em>consumer key</em> that was generated during the onboarding process.</li>
									<li><strong>oauth_nonce:</strong> Unique alphanumeric string generated from code.</li>
									<li><strong>oauth_signature_method:</strong> OAuth signature method. Value should be RSA-SHA1.</li>
									<li><strong>oauth_timestamp:</strong> Current timestamp.</li>
									<li><strong>oauth_version:</strong> OAuth version. Value should be 1.0.</li>
								</ul>

								<h4 id="toc_15">Signature Base String - Single Merchant API</h4>

								<div><pre><code class="language-none">POST&amp;https%3A%2F%2F.api.mastercard.com%2Fmasterpasspsp%2Fv6%2Fcheckoutproject%2
F[0-9]+%2Ffile&amp;oauth_body_hash%3D8K9uhveZjVdZW8AIYiXpR70KCtk%253D%26oauth_consumer_ke%3DcLb0
tKkEJhGTITp_6ltDIibO5Wgbx4rIldeXM_jRd4b0476c%2521414f4859446c4a366c726a32747469
5545332b353049303d%26oauth_nonce%3DDEAEB1CD-CA03-405D-A7B4-
B4263CB5A305%26oauth_signature_method%3DRSASHA1%26oauth_timestamp%3D1380049711%26oauth_version%3D1.0</code></pre></div>

								<h4 id="toc_16">HTTP Request Example - Single Merchant API</h4>

								<div><pre><code class="language-none">POST&amp;https%3A%2F%2Fapi.mastercard.com%2Fitf%2Fmasterpasspsp%2Fv6%2Fcheckoutproj
ect%2F285415568%2Ffile&amp;oauth_body_hash%3DCWrePW5A%252BKMde7DxI5mBp
NVr%252Fok%253D%26oauth_consumer_key%3DewdIBgRu1i6uCoFjuWGU4BNGDb0Udvh26N_mYah6
8efd62f9%252141496b7a452f35764d715752755579436b70467871476f3d%26oauth_nonce%3D1
7157164231493%26oauth_signature_method%3DRSASHA1%26oauth_timestamp%3D1432749165%26oauth_version%3D1.0</code></pre></div>

								<h4 id="toc_17">Merchant Upload Request - Single Merchant API</h4>

								<div><pre><code class="language-markup">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;MerchantUpload&gt;
 &lt;Merchant&gt;
 &lt;SPMerchantId&gt;STGQA09&lt;/SPMerchantId&gt;
 &lt;Action&gt;C&lt;/Action&gt;
 &lt;CheckoutBrand&gt;
 &lt;Name&gt;STGQA09&lt;/Name&gt;
 &lt;DisplayName&gt;STGQA09&lt;/DisplayName&gt;
 &lt;ProductionUrl&gt;https://STGQA09.com&lt;/ProductionUrl&gt;
  &lt;SandboxUrl&gt;https://STGQA09.com&lt;/SandboxUrl&gt;
 &lt;LogoUrl&gt;http://www.mastercard.us/_globalAssets/img/nav/-
navl_logo_mastercardcom.png&lt;/LogoUrl&gt;
 &lt;/CheckoutBrand&gt;
 &lt;/Merchant&gt;
&lt;/MerchantUpload&gt;</code></pre></div>

								<h3 id="toc_18">Optional - Single Merchant API Validation</h3>

								<p>If desired, service providers may also use the <em>Validate Merchant API Service</em> to verify their submissions. This will allow you to identify and fix any errors before submitting your file for processing. Use the following sample code to assist you in making your Validation API call. </p>

								<h4 id="toc_19">Signature Base String - Single Merchant API Validation</h4>

								<div><pre><code class="language-none">POST&amp;https%3A%2F%2F.api.mastercard.com%2Fmasterpasspsp%2Fv6%2Fcheckoutproject%2
F[0-9]+%2Ffile&amp;oauth_body_hash%3D8K9uhveZjVdZW8AIYiXpR70KCtk%253D%26oauth_consumer_ke%3DcLb0
tKkEJhGTITp_6ltDIibO5Wgbx4rIldeXM_jRd4b0476c%2521414f4859446c4a366c726a32747469
5545332b353049303d%26oauth_nonce%3DDEAEB1CD-CA03-405D-A7B4-
B4263CB5A305%26oauth_signature_method%3DRSASHA1%26oauth_timestamp%3D1380049711%26oauth_version%3D1.0</code></pre></div>

								<h4 id="toc_20">HTTP Request Example - Single Merchant API Validation</h4>

								<div><pre><code class="language-none">POST&amp;https%3A%2F%2Fapi.mastercard.com%2Fitf%2Fmasterpasspsp%2Fv6%2Fcheckoutproj
ect%2F285415568%2Ffile%2Fvalidation&amp;oauth_body_hash%3DCWrePW5A%252BKMde7DxI5mBp
NVr%252Fok%253D%26oauth_consumer_key%3DewdIBgRu1i6uCoFjuWGU4BNGDb0Udvh26N_mYah6
8efd62f9%252141496b7a452f35764d715752755579436b70467871476f3d%26oauth_nonce%3D1
7157164231493%26oauth_signature_method%3DRSASHA1%26oauth_timestamp%3D1432749165%26oauth_version%3D1.0</code></pre></div>

								<h4 id="toc_21">Merchant Upload Response - Validation</h4>

								<div><pre><code class="language-markup">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ValidateFileResponse&gt;
 &lt;ValidatedMerchant&gt;
 &lt;MerchantId&gt;STGQA09&lt;/MerchantId&gt;
 &lt;ErrorText&gt;VBMU0140: merchantId already exists for
serviceProviderId=285415466 and spMerchantId=STGQA09&lt;/ErrorText&gt;
 &lt;/ValidatedMerchant&gt;
&lt;/ValidateFileResponse&gt;</code></pre></div>
							</div>
							<!-- END FILE / API -->

<!--

IMPLEMENTATION PROCESS

-->

							<!-- BEGIN CLIENT SIDE -->
							<div class="tab-pane" id="clientside">
								<h3 id="toc_0">Add jQuery to your site</h2>

								<div><pre><code class="language-markup">&lt;script src=”https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js” type=”text/javascript”&gt;&lt;/script&gt;</code></pre></div>

								<h3 id="toc_1">Add MasterPass Client Javascript to the page appropriate to the desired MasterPass environment</h2>

								<div><pre><code class="language-markup">&lt;!-- Sandbox --&gt;
&lt;script src=”https://sandbox.static.masterpass.com/dyn/js/switch/integration/
MasterPass.client.js” type=”text/javascript”&gt;&lt;/script&gt;

&lt;!-- Production --&gt;
&lt;script src=”https://static.masterpass.com/dyn/js/switch/integration/
MasterPass.client.js” type=”text/javascript”&gt;&lt;/script&gt;</code></pre></div>

								<h1 id="toc_2">Initiate Lightbox</h1>

								<h3 id="toc_3">Standard Checkout</h3>

								<div><pre><code class="language-javascript">// initiate lightbox
MasterPass.client.checkout({
    requestToken : configurationState.requestToken,
    callbackUrl : configurationState.callbackUrl,
    successCallback : internalSuccessCallback,
    cancelCallback : internalCancelCallback,
    failureCallback : internalFailureCallback,
    suppressShippingAddressEnable : false,
    merchantCheckoutId : configurationState.checkoutId.checkoutId,
    allowedCardTypes : [“visa”, “master”, “amex”, ”discover”],
    loyaltyEnabled : true,
    allowedLoyaltyPrograms : [“reward1”, “reward3”],
    shippingLocationProfile : “SP-0001,default”,
    requestBasicCheckout : configurationState.authLevelBasic,
    version : configurationState.xmlVersion
};</code></pre></div>

								<h3 id="toc_4">Pair during Standard Checkout</h3>

								<div><pre><code class="language-javascript">// initiate lightbox
MasterPass.client.checkout({
    requestToken : configurationState.requestToken,
    callbackUrl : configurationState.callbackUrl,
    successCallback : internalSuccessCallback,
    cancelCallback : internalCancelCallback,
    failureCallback : internalFailureCallback,
    suppressShippingAddressEnable : false,
    merchantCheckoutId : configurationState.checkoutId.checkoutId,
    allowedCardTypes : [“visa”, “master”, “amex”, ”discover”],
    loyaltyEnabled : true,
    allowedLoyaltyPrograms : [“reward1”, “reward3”],
    shippingLocationProfile : “SP-0001,default”,
    requestBasicCheckout : configurationState.authLevelBasic,
    version : configurationState.xmlVersion,
    requestPairing : true,
    requestExpressCheckout : false,  // set to true when pairing for Express Checkout
    requestedDataTypes : [“PROFILE”, “ADDRESS”, “CARD”, “REWARD_PROGRAM”],
    pairingRequestToken : &quot;insert_pairing_request_token&quot;

};</code></pre></div>

								<h3 id="toc_5">Pair</h3>

								<div><pre><code class="language-javascript">// initiate lightbox
MasterPass.client.checkout({
    requestToken : configurationState.requestToken,
    callbackUrl : configurationState.callbackUrl,
    successCallback : internalSuccessCallback,
    cancelCallback : internalCancelCallback,
    failureCallback : internalFailureCallback,
    suppressShippingAddressEnable : false,
    merchantCheckoutId : configurationState.checkoutId.checkoutId,
    allowedCardTypes : [“visa”, “master”, “amex”, ”discover”],
    loyaltyEnabled : true,
    allowedLoyaltyPrograms : [“reward1”, “reward3”],
    shippingLocationProfile : “SP-0001,default”,
    requestBasicCheckout : configurationState.authLevelBasic,
    version : configurationState.xmlVersion,
    requestPairing : true,
    requestExpressCheckout : false,  // set to true when pairing for Express Checkout
    requestedDataTypes : [“PROFILE”, “ADDRESS”, “CARD”, “REWARD_PROGRAM”],
    pairingRequestToken : &quot;insert_pairing_request_token&quot;

};</code></pre></div>
							</div>
							<!-- END CLIENT SIDE -->

							<!-- BEGIN SERVER SIDE STANDARD CHECKOUT -->
							<div class="tab-pane" id="ssStandard">
								<ul class="nav nav-pills">
									<li class="dropdown active">
										<a class="dropdown-toggle" data-toggle="dropdown" href="#">Change SDK Language
										<span class="caret"></span></a> <span class="titleCheckout">Standard</span>
										<ul class="dropdown-menu">
											<li><a data-toggle="tab" href="#java">Java</a></li>
											<li><a data-toggle="tab" href="#csharp">C#</a></li>
											<li><a data-toggle="tab" href="#ruby">Ruby</a></li>
											<li><a data-toggle="tab" href="#php">PHP</a></li> 
										</ul>
									</li>
								</ul>

								<div class="tab-content">
								<!-- JAVA CONTENT -->
									<div id="java" class="tab-pane fade in active">
										
									<div id="section4" class="">
										<h1 id="toc_4">Standard Checkout Integration</h1>
									</div>
									<div id="section5" class="">
										<h2 id="toc_5">1. Call Request Token Service</h2>
										<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.create(callback_url);
String request_token = requestTokenResponse.getOauthToken();</code></pre></div>
									</div>
									<div id="section6" class="">
										<h2 id="toc_6">2. Call Shopping Cart Service</h2>
										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 1.</p>
										<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL. </p>
										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-java">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest()
		.shoppingCart(new ShoppingCart()
			.subtotal(11900L)
			.currencyCode("USD")
			.shoppingCartItem(new ShoppingCartItem()
				.value(1900L)
				.description("This is one item")
				.quantity(1))

			.shoppingCartItem(new ShoppingCartItem()
				.imageURL("https://somemerchant.com/someimage")
				.value(10000L)
				.description("Five items")
				.quantity(5)))
		.oAuthToken(request_token);

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.create(shoppingCartRequest);</code></pre></div>
									</div>
									<div id="section7" class="">
										<h2 id="toc_7">3. Call Merchant Initialization Service</h2>
										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>request token</em> from Step 1. </p>
										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
									<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
        .originUrl("https://somemerchant.com")
        .oAuthToken(request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);</code></pre></div>
									</div>
									<div id="section8" class="">
										<h2 id="toc_8">4. Invoke MasterPass UI (Lightbox) for checkout</h2>
										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
										<div><pre><code class="language-markup">&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;
 &lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;
 &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;</code></pre></div>

								<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button. </p>
								<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
         &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                      //required
         &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,//required
         &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                  //required
         &quot;allowedCardTypes&quot;:[&quot;master,amex,diners,discover,maestro,visa&quot;], //optional 
         &quot;version&quot;:&quot;v6&quot;,                                                  //optional
         &quot;successCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }            //optional
    });
&lt;/script&gt;</code></pre></div>
										<ul>
											<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 1. </li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>
									</div>
									<div id="section9" class="">
										<h2 id="toc_9">5. Redirect to callback URL or call callback function</h2>
										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will be redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
										<h3 id="toc_10">On Success</h3>
										<p>On Success, MasterPass returns the following parameters:</p>
										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used to retrieve the <em>access token</em> in Step 6. </li>
											<li><strong>oauth_token:</strong> The <em>request token</em> that is used to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
										</ul>
										<h4 id="toc_11">Example Callback URL (Success)</h4>
										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
								<h4 id="toc_12">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_13">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
								<h4 id="toc_14">Example Callback Function (Success)</h4>
								<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section10" class="">
											<h2 id="toc_15">6. Call Access Token Service</h2>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 5. </p>
										<div><pre><code class="language-java">AccessTokenResponse accessTokenResponse = AccessTokenApi.create(request_token, verifier_token);
String accessToken = accessTokenResponse.getOauthToken();
</code></pre></div>
										</div>
										<div id="section11" class="">
											<h2 id="toc_16">7. Retrieve payment, shipping data, rewards and 3DS details</h2>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>access token</em> from Step 6 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
										<div><pre><code class="language-java">int startIndex = checkoutResourceUrl.lastIndexOf('/') + 1;
int endIndex = checkoutResourceUrl.indexOf('?') != -1 ? 
		checkoutResourceUrl.indexOf('?')
		: checkoutResourceUrl.length();
String checkoutId = checkoutResourceUrl.substring(startIndex, endIndex);

Checkout checkout = CheckoutApi.show(checkoutId, accessToken);

Card card = checkout.getCard();
Address billingAddress = card.getBillingAddress();
Contact contact = checkout.getContact();
AuthenticationOptions authOptions = checkout.getAuthenticationOptions(); 
String preCheckoutTransactionId = checkout.getPreCheckoutTransactionId(); 
RewardProgram rewardProgram = checkout.getRewardProgram(); 
ShippingAddress shippingAddress = checkout.getShippingAddress();
String transactionId = checkout.getTransactionId();
String walletId = checkout.getWalletID();</code></pre></div>
 										</div>
			 							<div id="section12" class="">
											<h2 id="toc_17">8. Process payment through a payment gateway</h2>
											<p>Using the information retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section13" class="">
											<h2 id="toc_18">9. Log transactions with MasterPass</h2>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
										<div><pre><code class="language-java">//Create an instance of MerchantTransactions
MerchantTransactions request = new MerchantTransactions()
        .merchantTransactions(new MerchantTransaction()
            .transactionId("4549794")                         //from Step 7
            .purchaseDate("2014-08-01T14:52:57.539-05:00")
            .expressCheckoutIndicator(false)                //from Step 7
            .approvalCode("888888")                         // authorization code returned by payment gateway
            .transactionStatus(TransactionStatusEnum.valueOf("Success"))
            .orderAmount(1229L)                              // total charged to card
            .preCheckoutTransactionId("a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947")
            .currency("USD")
            .consumerKey("0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d")); //generated during onboarding process

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.create(request);</code></pre></div>
										</div>
									</div>
									<!-- END JAVA CONTENT -->

									<!-- C# Standard content -->
									<div id="csharp" class="tab-pane fade">
									
									<div id="csharp" class="tab-pane fade in active">
									
									<div id="section4" class="">
										<h1 id="toc_4">Standard Checkout Integration</h1>
									</div>
									<div id="section5" class="">
										<h2 id="toc_5">1. Call Request Token Service</h2>
										<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-c#">string callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string request_token = requestTokenResponse.OauthToken;</code></pre></div>
									</div>
									<div id="section6" class="">
										<h2 id="toc_6">2. Call Shopping Cart Service</h2>
										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 1.</p>
										<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL. </p>
										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-c#">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest();
ShoppingCart shoppingCart = new ShoppingCart();
List&lt;ShoppingCartItem&gt; shoppingCartItems = new List&lt;ShoppingCartItem&gt;();
shoppingCartItems.Add(new ShoppingCartItem
{
    Value = 1900L,
    Description = "This is one item",
    Quantity = 1
});
shoppingCartItems.Add(new ShoppingCartItem
{
    ImageURL = "https://somemerchant.com/someimage",
    Value = 10000L,
    Description = "Five items",
    Quantity = 5
});

shoppingCart.Subtotal = 11900L;
shoppingCart.CurrencyCode = "USD";
shoppingCart.ShoppingCartItem = shoppingCartItems;

shoppingCartRequest.ShoppingCart = shoppingCart;
shoppingCartRequest.OAuthToken = request_token;

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.Create(shoppingCartRequest);</code></pre></div>
									</div>
									<div id="section7" class="">
										<h2 id="toc_7">3. Call Merchant Initialization Service</h2>
										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>request token</em> from Step 1. </p>
										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
									<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = request_token
};

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);</code></pre></div>
									</div>
									<div id="section8" class="">
										<h2 id="toc_8">4. Invoke MasterPass UI (Lightbox) for checkout</h2>
										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
										<div><pre><code class="language-markup">&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;
 &lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;
 &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;</code></pre></div>

								<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button. </p>
								<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
         &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                      //required
         &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,//required
         &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                  //required
         &quot;allowedCardTypes&quot;:[&quot;master,amex,diners,discover,maestro,visa&quot;], //optional 
         &quot;version&quot;:&quot;v6&quot;,                                                  //optional
         &quot;successCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }            //optional
    });
&lt;/script&gt;</code></pre></div>
										<ul>
											<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 1. </li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>
									</div>
									<div id="section9" class="">
										<h2 id="toc_9">5. Redirect to callback URL or call callback function</h2>
										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will be redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
										<h3 id="toc_10">On Success</h3>
										<p>On Success, MasterPass returns the following parameters:</p>
										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used to retrieve the <em>access token</em> in Step 6. </li>
											<li><strong>oauth_token:</strong> The <em>request token</em> that is used to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
										</ul>
										<h4 id="toc_11">Example Callback URL (Success)</h4>
										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
								<h4 id="toc_12">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_13">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
								<h4 id="toc_14">Example Callback Function (Success)</h4>
								<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section10" class="">
											<h2 id="toc_15">6. Call Access Token Service</h2>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 5. </p>
										<div><pre><code class="language-c#">AccessTokenResponse accessTokenResponse = AccessTokenApi.Create(request_token, verifier_token);
string accessToken = accessTokenResponse.OauthToken;
</code></pre></div>
										</div>
										<div id="section11" class="">
											<h2 id="toc_16">7. Retrieve payment, shipping data, rewards and 3DS details</h2>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>access token</em> from Step 6 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
										<div><pre><code class="language-c#">string checkoutId = checkoutResourceUrl.IndexOf('?') != -1 ? checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1).Split('?')[0] : checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1);

Checkout checkout = CheckoutApi.Show(checkoutId, accessToken);

Card card = checkout.Card;
Address billingAddress = card.BillingAddress;
Contact contact = checkout.Contact;
AuthenticationOptions authOptions = checkout.AuthenticationOptions;
string preCheckoutTransactionId = checkout.PreCheckoutTransactionId;
RewardProgram rewardProgram = checkout.RewardProgram;
ShippingAddress shippingAddress = checkout.ShippingAddress;
string transactionId = checkout.TransactionId;
string walletId = checkout.WalletID;</code></pre></div>
 										</div>
			 							<div id="section12" class="">
											<h2 id="toc_17">8. Process payment through a payment gateway</h2>
											<p>Using the information retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section13" class="">
											<h2 id="toc_18">9. Log transactions with MasterPass</h2>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
										<div><pre><code class="language-c#">//Create an instance of MerchantTransactions
MerchantTransactions objMerchantTransactions = new MerchantTransactions();
List&lt;MerchantTransaction&gt; merchantTransactions = new List&lt;MerchantTransaction&gt;();
MerchantTransaction merchantTransaction = new MerchantTransaction
{
    TransactionId = "4549794", // from Step 7
    PurchaseDate = "2014-08-01T14:52:57.539-05:00",
    ExpressCheckoutIndicator = false,
    ApprovalCode = "888888",  // authorization code returned by payment gateway
    TransactionStatus = "Success",
    OrderAmount = 1229L, // total charged to card
    PreCheckoutTransactionId = "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
    Currency = "USD",
    ConsumerKey = "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d" //generated during onboarding process
};

merchantTransactions.Add(merchantTransaction);

objMerchantTransactions._MerchantTransactions = merchantTransactions;

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.Create(objMerchantTransactions);</code></pre></div>
										</div>
									</div>
									</div>
									<!-- END C# CONTENT -->

									<!-- RUBY CONTENT -->
									<div id="ruby" class="tab-pane fade">
										
									<div id="section2" class="">
										<h1 id="toc_2">Standard Checkout Integration</h1>
									</div>
									<div id="section3" class="">
										<h2 id="toc_3">1. Call Request Token Service</h2>
										<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
request_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
request_token = request_token_response.oauth_token;</code></pre></div>
									</div>
									<div id="section4" class="">
										<h2 id="toc_4">2. Call Shopping Cart Service</h2>
										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 1.</p>
										<p>Each shopping_cart_item must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A shopping_cart_item may also have an optional image_url. </p>
										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-ruby">shopping_cart_request = MastercardMasterpassMerchant::ShoppingCartRequest.new(
    :o_auth_token => request_token,
    :shopping_cart => MastercardMasterpassMerchant::ShoppingCart.new(
        :currency_code => 'USD',
        :subtotal => '11900',
        :shopping_cart_item => [
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'One Item',
                :quantity => 1,
                :value => 1900
            ),
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'Five of an Item',
                :quantity => 5,
                :value => 10000,
                :image_url => 'http://somemerchant.com/someimage'
            )
        ]
    )
)

shopping_cart_response = MastercardMasterpassMerchant::Api::ShoppingCartApi.create(shopping_cart_request)</code></pre></div>
									</div>
									<div id="section5" class="">
										<h2 id="toc_5">3. Call Merchant Initialization Service</h2>
										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The origin_url identifies the origin of the page that will initialize the Lightbox. This service requires the <em>request token</em> from Step 1. </p>
										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
									<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>
									</div>
									<div id="section6" class="">
										<h2 id="toc_6">4. Invoke MasterPass UI (Lightbox) for checkout</h2>
										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
										<div><pre><code class="language-markup">&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;
 &lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;
 &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;</code></pre></div>

								<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button. </p>
								<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
         &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                      //required
         &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,//required
         &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                  //required
         &quot;allowedCardTypes&quot;:[&quot;master,amex,diners,discover,maestro,visa&quot;], //optional 
         &quot;version&quot;:&quot;v6&quot;,                                                  //optional
         &quot;successCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }            //optional
    });
&lt;/script&gt;</code></pre></div>
										<ul>
											<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 1. </li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>
									</div>
									<div id="section7" class="">
										<h2 id="toc_7">5. Redirect to callback URL or call callback function</h2>
										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will be redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
										<h3 id="toc_8">On Success</h3>
										<p>On Success, MasterPass returns the following parameters:</p>
										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used to retrieve the <em>access token</em> in Step 6. </li>
											<li><strong>oauth_token:</strong> The <em>request token</em> that is used to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
										</ul>
										<h4 id="toc_9">Example Callback URL (Success)</h4>
										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
								<h4 id="toc_10">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_11">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
								<h4 id="toc_12">Example Callback Function (Success)</h4>
								<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section8" class="">
											<h2 id="toc_13">6. Call Access Token Service</h2>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 5. </p>
										<div><pre><code class="language-ruby">access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(verifier_token, request_token)
access_token = access_token_response.oauth_token
}</code></pre></div>
										</div>
										<div id="section9" class="">
											<h2 id="toc_14">7. Retrieve payment, shipping data, rewards and 3DS details</h2>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>access token</em> from Step 6 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
										<div><pre><code class="language-ruby">
start_index = checkout_resource_url.rindex('/') + 1
end_index = checkout_resource_url.index('?').nil? ? -1 : checkout_resource_url.index('?')
path_id = checkout_resource_url[start_index..end_index]

checkout = MastercardMasterpassMerchant::Api::CheckoutApi.show(path_id, access_token)
card = checkout.card
billing_address = card.billing_address
contact = checkout.contact
auth_options = checkout.authentication_options
precheckout_transaction_id = checkout.pre_checkout_transaction_id
reward_program = checkout.reward_program
shipping_address = checkout.shipping_address
transaction_id = checkout.transaction_id
wallet_id = checkout.wallet_id</code></pre></div>
 										</div>
			 							<div id="section12" class="">
											<h2 id="toc_17">8. Process payment through a payment gateway</h2>
											<p>Using the information retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section13" class="">
											<h2 id="toc_18">9. Log transactions with MasterPass</h2>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
										<div><pre><code class="language-ruby">merchant_transactions = MastercardMasterpassMerchant::MerchantTransactions.new(
    :merchant_transactions => [
        MastercardMasterpassMerchant::MerchantTransaction.new(
            :transaction_id => 4549794,
            :consumer_key => '0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d',
            :currency => 'USD',
            :order_amount => 1800,
            :transaction_status => 'Success',
            :approval_code => '888888',
            :pre_checkout_transaction_id => 'a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947',
            :express_checkout_indicator => false,
            :purchase_date => '2016-06-23T15:09:32+00:00'
        )
    ]
)

merchant_trans_response = MastercardMasterpassMerchant::Api::PostbackApi.create(merchant_transactions)</code></pre></div>
										</div>
	
									</div>
									<!-- BEGIN PHP STANDARD -->
									<div id="php" class="tab-pane fade">
									<div id="section2" class="">
										<h1 id="toc_2">Standard Checkout Integration</h1>
									</div>
									<div id="section3" class="">
										<h2 id="toc_3">1. Call Request Token Service</h2>
										<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callbackUrl that the browser will redirect to when the Lightbox closes. </p>
										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/checkoutconfirm.htm";
$requestTokenResponse = RequestTokenApi::create($callbackUrl);
$requestToken = $requestTokenResponse->getOauthToken();</code></pre></div>
									</div>
									<div id="section4" class="">
										<h2 id="toc_4">2. Call Shopping Cart Service</h2>
										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 1.</p>
										<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional ImageURL. </p>
										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
										<div><pre><code class="language-php">//Build Out ShoppingCartRequest object
$shoppingCartItem1 = new ShoppingCartItem(
	array(
		"Value" => 700,
		"Description" => "This is one item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someimage"
	)
);

$shoppingCartItem2 = new ShoppingCartItem(
	array(
		"Value" => 300,
		"Description" => "This is another item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someotherimage"
		)
);

$shoppingCart = new ShoppingCart(
	array(
		"CurrencyCode" => "USD",
		"Subtotal" => 1000,
		"ShoppingCartItem" => array($shoppingCartItem1, $shoppingCartItem2)
	)
);

$shoppingCartRequest = new ShoppingCartRequest(
	array(
		"OAuthToken" => $requestToken,
		"OriginUrl" => $callbackDomain,
		"ShoppingCart" => $shoppingCart,
	)
);

//Call the ShoppingCartService with required params
$shoppingCartResponse = ShoppingCartApi::create($shoppingCartRequest);</code></pre></div>
									</div>
									<div id="section5" class="">
										<h2 id="toc_5">3. Call Merchant Initialization Service</h2>
										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The OriginUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>request token</em> from Step 1. </p>
										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
									<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $requestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>
									</div>
									<div id="section6" class="">
										<h2 id="toc_6">4. Invoke MasterPass UI (Lightbox) for checkout</h2>
										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
										<div><pre><code class="language-markup">&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;
 &lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;
 &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;</code></pre></div>

								<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button. </p>
								<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
         &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                      //required
         &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,//required
         &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                  //required
         &quot;allowedCardTypes&quot;:[&quot;master,amex,diners,discover,maestro,visa&quot;], //optional 
         &quot;version&quot;:&quot;v6&quot;,                                                  //optional
         &quot;successCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },          //optional
         &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }            //optional
    });
&lt;/script&gt;</code></pre></div>
										<ul>
											<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 1. </li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>
									</div>
									<div id="section7" class="">
										<h2 id="toc_7">5. Redirect to callback URL or call callback function</h2>
										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will be redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
										<h3 id="toc_8">On Success</h3>
										<p>On Success, MasterPass returns the following parameters:</p>
										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used to retrieve the <em>access token</em> in Step 6. </li>
											<li><strong>oauth_token:</strong> The <em>request token</em> that is used to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
										</ul>
										<h4 id="toc_9">Example Callback URL (Success)</h4>
										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
								<h4 id="toc_10">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_11">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
								<h4 id="toc_12">Example Callback Function (Success)</h4>
								<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section8" class="">
											<h2 id="toc_13">6. Call Access Token Service</h2>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 5. </p>
										<div><pre><code class="language-php">$accessTokenResponse = AccessTokenApi::create(requestToken, verifierToken);
$accessToken = $accessTokenResponse->getOauthToken();</code></pre></div>
										</div>
										<div id="section9" class="">
											<h2 id="toc_14">7. Retrieve payment, shipping data, rewards and 3DS details</h2>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>access token</em> from Step 6 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
										<div><pre><code class="language-php">$explodedURL = explode("/", $checkoutResourceUrl);
$checkoutId = array_pop($explodedURL);
if(strpos($checkoutId, "?") !== false){
    $checkoutId = explode($checkoutId, "?")[0];
}

$logger->info($checkoutId);

$checkout = CheckoutApi::show($checkoutId, $accessToken);

$card = $checkout->getCard();
$billingAddress = $card->getBillingAddress();
$contact = $checkout->getContact();
$authOptions = checkout->getAuthenticationOptions(); 
$preCheckoutTransactionId = checkout->getPreCheckoutTransactionId(); 
$rewardProgram = checkout->getRewardProgram(); 
$shippingAddress = checkout->getShippingAddress();
$transactionId = checkout->getTransactionId();
$walletId = checkout->getWalletID();</code></pre></div>
 										</div>
			 							<div id="section12" class="">
											<h2 id="toc_17">8. Process payment through a payment gateway</h2>
											<p>Using the information retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section13" class="">
											<h2 id="toc_18">9. Log transactions with MasterPass</h2>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
										<div><pre><code class="language-php">//Create an instance of MerchantTransactions

$merchantTransaction = new MerchantTransaction(
	array(
		"TransactionId" => "4549794",
		"ConsumerKey" => "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d", //generated during onboarding process
		"Currency" => "USD",
		"OrderAmount" => 500, // total charged to card
		"TransactionStatus" => "Success",
		"ApprovalCode" => "888888", // authorization code returned by payment gateway
		"PrecheckoutTransactionId" => "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
		"ExpressCheckoutIndicator" => false,
		"PurchaseDate" => date("Y/m/d H:i:s")
	)
);
$request = new MerchantTransactions(array("MerchantTransactions" => array($merchantTransaction)));

//Call the PostbackService with required params
$response = PostbackApi::create($request);</code></pre></div>
										</div>


									</div>
									<!-- END PHP STANDARD -->
								</div>
							</div>
							<!-- END SERVER SIDE STANDARD CHECKOUT -->

							<!-- BEGIN SERVER SIDE CONNECTED CHECKOUT -->
							<div class="tab-pane" id="ssConnect">
								<ul class="nav nav-pills">
									<li class="dropdown active">
										<a class="dropdown-toggle" data-toggle="dropdown" href="#">Change SDK Language
										<span class="caret"></span></a> <span class="titleCheckout">Connected</span>
										<ul class="dropdown-menu">
											<li><a data-toggle="tab" href="#Cjava">Java</a></li>
											<li><a data-toggle="tab" href="#Ccsharp">C#</a></li>
											<li><a data-toggle="tab" href="#Cruby">Ruby</a></li>
											<li><a data-toggle="tab" href="#Cphp">PHP</a></li> 
										</ul>
									</li>
								</ul>

								<div class="tab-content">
									<!-- BEGIN JAVA CONNECTED -->
									<div id="Cjava" class="tab-pane fade in active">										
										<div class="">
											<h1 id="toc_4">Connected Checkout Integration</h1>
										</div>
										<div id="" class="">
												<h2 id="toc_5">Pairing During Checkout</h2>
										</div>
										<div id="section4" class="">
											<h3 id="toc_6">1. Call Request Token Service (2 times)</h3>
											<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account. </p>
											<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";

RequestTokenResponse pairingResponse = RequestTokenApi.create(callback_url);
String pairing_request_token = pairingResponse.getOauthToken();

RequestTokenResponse checkoutResponse = RequestTokenApi.create(callback_url);
String checkout_request_token = checkoutResponse.getOauthToken();</code></pre></div>
										</div>
										<div id="section5" class="">
											<h3 id="toc_7">2. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>
											<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest()
		.shoppingCart(new ShoppingCart()
			.subtotal(11900L)
			.currencyCode("USD")
			.shoppingCartItem(new ShoppingCartItem()
				.value(1900L)
				.description("This is one item")
				.quantity(1))

			.shoppingCartItem(new ShoppingCartItem()
				.imageURL("https://somemerchant.com/someimage")
				.value(10000L)
				.description("Five items")
				.quantity(5)))
		.oAuthToken(request_token);

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.create(shoppingCartRequest);
</code></pre></div>
										</div>
										<div id="section6" class="">
											<h3 id="toc_8">3. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
		.originUrl("https://somemerchant.com")
		.oAuthToken(checkout_request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section7" class="">
											<h3 id="toc_9">4. Invoke MasterPass UI (Lightbox) for checkout</h3>
											<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
       &quot;requestPairing&quot;:true,                                                      //required
       &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
       &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
       &quot;version&quot;:&quot;v6&quot;,                                                             //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1. </li>
												<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
											</ul>
										</div>
										<div id="section8" class="">
											<h3 id="toc_10">5. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_11">On success</h4>
											<p>On success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7. </li>
												<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6. </li>
												<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<h4 id="toc_12">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
								<h4 id="toc_13">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_14">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
										</div>
										<div id="section9" class="">
											<h3 id="toc_15">6. Call Access Token Service (2 times)</h3>
											<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction. </p>
											<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions. </p>
											<div><pre><code class="language-java">AccessTokenResponse checkoutAccessTokenResponse = AccessTokenApi.create(oauth_checkout_request_token, oauth_checkout_verifier_token);
String checkout_access_token = checkoutAccessTokenResponse.getOauthToken();

AccessTokenResponse longAccessTokenResponse = AccessTokenApi.create(oauth_pairing_request_token, oauth_pairing_verifier_token);
String long_access_token = longAccessTokenResponse.getOauthToken(); // store for future requests</code></pre></div>
										</div>
										<div id="section10" class="">
											<h3 id="toc_16">7. Retrieve payment, shipping data, rewards and 3DS details</h3>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-java">int startIndex = checkoutResourceUrl.lastIndexOf('/') + 1;
int endIndex = checkoutResourceUrl.indexOf('?') != -1 ? 
		checkoutResourceUrl.indexOf('?')
		: checkoutResourceUrl.length();
String checkoutId = checkoutResourceUrl.substring(startIndex, endIndex);

Checkout checkout = CheckoutApi.show(checkoutId, accessToken);

Card card = checkout.getCard();
Address billingAddress = card.getBillingAddress();
Contact contact = checkout.getContact();
AuthenticationOptions authOptions = checkout.getAuthenticationOptions(); 
String preCheckoutTransactionId = checkout.getPreCheckoutTransactionId(); 
RewardProgram rewardProgram = checkout.getRewardProgram(); 
ShippingAddress shippingAddress = checkout.getShippingAddress();
String transactionId = checkout.getTransactionId();
String walletId = checkout.getWalletID();</code></pre></div>
 										</div>
				 						<div id="section11" class="">
											<h3 id="toc_17">8. Process payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section12" class="">
											<h3 id="toc_18">9. Log transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-java">//Create an instance of MerchantTransactions
MerchantTransactions request = new MerchantTransactions()
		.merchantTransactions(new MerchantTransaction()
			.transactionId("4549794")                        // from Step 7
			.purchaseDate("2014-08-01T14:52:57.539-05:00")
			.expressCheckoutIndicator(false)                 // from Step 7
			.approvalCode("888888")                          // authorization code returned by payment gateway
			.transactionStatus(TransactionStatusEnum.valueOf("Success"))
			.orderAmount(1229L)                              // total charged to card
			.preCheckoutTransactionId("a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947")
			.currency("USD")
			.consumerKey("0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d")); //generated during onboarding process

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.create(request);</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_19">Pairing without Checkout</h2>
										</div>
										<div id="section13" class="">
											<h3 id="toc_20">1. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/pairingcomplete.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.create(callback_url);
String pairing_request_token = requestTokenResponse.getOauthToken();
</code></pre></div>
										</div>
										<div id="section14" class="">
											<h3 id="toc_21">2. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1. </p>
											<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
		.originUrl("https://somemerchant.com")
		.oAuthToken(pairing_request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);
</code></pre></div>
										</div>
										<div id="section15" class="">
											<h3 id="toc_22">3. Invoke MasterPass UI (Lightbox) for pairing</h3>
											<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button. </p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.connect({ 
       &quot;requestPairing&quot;:true,                                            //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,        //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;, //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
       &quot;version&quot;:&quot;v6&quot;                                                    //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section16" class="">
											<h3 id="toc_23">4. Redirect to callback URL or call callback function</h3>
											<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_24">Example Callback URL (Success)</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
											<h4 id="toc_25">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_26">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_27">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>
										</div>
										<div id="section17" class="">
											<h3 id="toc_28">5. Call Access Token Service</h3>
											<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4. </p>
											<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>
											<div><pre><code class="language-java">AccessTokenResponse accessTokenResponse = AccessTokenApi.create(pairing_request_token, pairing_verifier_token);
String long_access_token = accessTokenResponse.getOauthToken(); // store for future requests
</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_29">Checkout after Pairing</h2>
										</div>
										<div id="section18" class="">
											<h3 id="toc_30">1. Consumer logs onto merchant site</h3>
											<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>
										</div>
										<div id="section19" class="">
											<h3 id="toc_31">2. Call PreCheckout Data Service</h3>
											<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout). </p>
											<div><pre><code class="language-java">String[] requestedDataTypes = {"REWARD_PROGRAM", "ADDRESS", "PROFILE", "CARD"};

PrecheckoutDataRequest preCheckoutDataRequest = new PrecheckoutDataRequest();
PairingDataTypes pairingDataTypes = new PairingDataTypes();
for(int i = 0; i &lt; requestedDataTypes.length; i++){
	pairingDataTypes.pairingDataType(new PairingDataType().type(TypeEnum.valueOf(requestedDataTypes[i])));
}
preCheckoutDataRequest.pairingDataTypes(pairingDataTypes);

PrecheckoutDataResponse response = PrecheckoutDataApi.create(long_access_token, preCheckoutDataRequest);</code></pre></div>
										</div>
										<div id="section20" class="">
											<h3 id="toc_32">3. Consumer makes card/shipping address selection</h3>
											<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used on the Place Order page of the merchant site.</p>
										</div>
										<div id="section21" class="">
											<h3 id="toc_33">4. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.create(callback_url);
String request_token = requestTokenResponse.getOauthToken();</code></pre></div>
										</div>
										<div id="section22" class="">
											<h3 id="toc_34">5. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 4.</p>
											<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest()
		.shoppingCart(new ShoppingCart()
			.subtotal(11900L)
			.currencyCode("USD")
			.shoppingCartItem(new ShoppingCartItem()
				.value(1900L)
				.description("This is one item")
				.quantity(1))

			.shoppingCartItem(new ShoppingCartItem()
				.imageURL("https://somemerchant.com/someimage")
				.value(10000L)
				.description("Five items")
				.quantity(5)))
		.oAuthToken(request_token);

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.create(shoppingCartRequest);</code></pre></div>
										</div>
										<div id="section23" class="">
											<h3 id="toc_35">6. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 4. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
		.originUrl("https://somemerchant.com")
		.oAuthToken(request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section24" class="">
											<h3 id="toc_36">7. Create Buy With MasterPass Button</h3>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
											<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>On the Place Order page of the merchant&#39;s website, create the <strong>Buy with MasterPass</strong> button using the <em>cardId</em>, <em>addressId</em>, and <em>rewardId</em> from Step 3 and the <em>request token</em> from Step 4.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
MasterPass.client.checkout({
     &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
     &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
     &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
     &quot;cardId&quot;:&quot;insert_selected_card_id_here&quot;,                          //required
     &quot;shippingId&quot;:&quot;insert_selected_shipping_address_id_here&quot;,          //required
     &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
     &quot;walletName&quot;:&quot;insert_wallet_name_here&quot;,                           //required
     &quot;consumerWalletId&quot;:&quot;insert_consumer_walletid_here&quot;,               //required
     &quot;loyaltyId&quot;:&quot;insert_loyalty_id_here&quot;,                             //optional
     &quot;requireShippingDestination&quot;: &quot;true&quot;                              //optional                                                                                                                                                                 
     &quot;version&quot;:&quot;v6&quot;,                                                   //optional
     &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 4. </li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>cardId:</strong> The identifier of the selected card collected in Step 3.</li>
												<li><strong>shippingId:</strong> The identifier of the shipping information collected in Step 3.</li>
												<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected in Step 3.</li>
												<li><strong>walletName:</strong> The consumer&#39;s wallet name collected in Step 3.</li>
												<li><strong>consumerWalletId:</strong> The consumer&#39;s wallet identifier collected in Step 3.</li>
												<li><strong>loyaltyId:</strong> The <em>rewardId</em>, optionally collected in Step 3.</li>
												<li><strong>requireShippingDestination:</strong> Denotes whether the consumer&#39;s shipping information is required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section25" class="">
											<h3 id="toc_37">8. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_38">on Success</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 10.</li>
												<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used in conjunction with the <em>request token</em> to retrieve the <em>access token</em> in Step 9. </li>
												<li><strong>oauth_token:</strong> The <em>request token</em> that is used in conjunction with the <em>verifier token</em> to retrieve the <em>access token</em> in Step 9. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
											</ul>
											<h4 id="toc_39">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
											<h4 id="toc_40">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_41">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_42">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section26" class="">
											<h3 id="toc_43">9. Call Access Token Service</h3>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 8. </p>
											<p>As there is no need to retrieve a <em>long access token</em> again, only this one call to the <strong>Access Token Service</strong> will be made. </p>
											<div><pre><code class="language-java">AccessTokenResponse accessTokenResponse = AccessTokenApi.create(request_token, verifier_token);
String accessToken = accessTokenResponse.getOauthToken();</code></pre></div>
										</div>
										<div id="section27" class="">
											<h3 id="toc_44">10. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>
											<p>Use the <strong>Checkout Resource URL</strong> received in Step 8 and the <em>access token</em> from Step 9 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-java">int startIndex = checkoutResourceUrl.lastIndexOf('/') + 1;
int endIndex = checkoutResourceUrl.indexOf('?') != -1 ? 
		checkoutResourceUrl.indexOf('?')
		: checkoutResourceUrl.length();
String checkoutId = checkoutResourceUrl.substring(startIndex, endIndex);

Checkout checkout = CheckoutApi.show(checkoutId, accessToken);

Card card = checkout.getCard();
Address billingAddress = card.getBillingAddress();
Contact contact = checkout.getContact();
AuthenticationOptions authOptions = checkout.getAuthenticationOptions(); 
String preCheckoutTransactionId = checkout.getPreCheckoutTransactionId(); 
RewardProgram rewardProgram = checkout.getRewardProgram(); 
ShippingAddress shippingAddress = checkout.getShippingAddress();
String transactionId = checkout.getTransactionId();
String walletId = checkout.getWalletID();</code></pre></div>
 										</div>
			 							<div id="section28" class="">
											<h3 id="toc_45">11. Process Payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 10, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section29" class="">
											<h3 id="toc_46">12. Log Transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 11, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-java">//Create an instance of MerchantTransactions
MerchantTransactions request = new MerchantTransactions()
		.merchantTransactions(new MerchantTransaction()
			.transactionId("4549794")
			.purchaseDate("2014-08-01T14:52:57.539-05:00")
			.expressCheckoutIndicator(false)
			.approvalCode("888888")                          // authorization code returned by payment gateway
			.transactionStatus(TransactionStatusEnum.valueOf("Success"))
			.orderAmount(1229L)                              // total charged to card
			.preCheckoutTransactionId("a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947")
			.currency("USD")
			.consumerKey("0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d")); //generated during onboarding process

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.create(request);</code></pre></div>
										</div>
									</div>
									<!-- END JAVA CONNECTED -->
									<!-- C# CONNECTED-->
									<div id="Ccsharp" class="tab-pane fade">
										
										<div class="">
											<h1 id="toc_4">Connected Checkout Integration</h1>
										</div>
										<div id="" class="">
												<h2 id="toc_5">Pairing During Checkout</h2>
										</div>
										<div id="section4" class="">
											<h3 id="toc_6">1. Call Request Token Service (2 times)</h3>
											<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account. </p>
											<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">string callback_url = "https://www.somemerchant.com/pairingcomplete.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string pairing_request_token = requestTokenResponse.OauthToken;
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string request_token = requestTokenResponse.OauthToken;</code></pre></div>
										</div>
										<div id="section5" class="">
											<h3 id="toc_7">2. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>
											<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest();
ShoppingCart shoppingCart = new ShoppingCart();
List&lt;ShoppingCartItem&gt; shoppingCartItems = new List&lt;ShoppingCartItem&gt;();
shoppingCartItems.Add(new ShoppingCartItem
{
	Value = 1900L,
	Description = "This is one item",
	Quantity = 1
});
shoppingCartItems.Add(new ShoppingCartItem
{
    ImageURL = "https://somemerchant.com/someimage",
    Value = 10000L,
    Description = "Five items",
    Quantity = 5
});

shoppingCart.Subtotal = 11900L;
shoppingCart.CurrencyCode = "USD";
shoppingCart.ShoppingCartItem = shoppingCartItems;

shoppingCartRequest.ShoppingCart = shoppingCart;
shoppingCartRequest.OAuthToken = request_token;

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.Create(shoppingCartRequest);
</code></pre></div>
										</div>
										<div id="section6" class="">
											<h3 id="toc_8">3. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = request_token
};

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section7" class="">
											<h3 id="toc_9">4. Invoke MasterPass UI (Lightbox) for checkout</h3>
											<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
       &quot;requestPairing&quot;:true,                                                      //required
       &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
       &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
       &quot;version&quot;:&quot;v6&quot;,                                                             //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1. </li>
												<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
											</ul>
										</div>
										<div id="section8" class="">
											<h3 id="toc_10">5. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_11">On success</h4>
											<p>On success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7. </li>
												<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6. </li>
												<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<h4 id="toc_12">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
								<h4 id="toc_13">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_14">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
										</div>
										<div id="section9" class="">
											<h3 id="toc_15">6. Call Access Token Service (2 times)</h3>
											<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction. </p>
											<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions. </p>
											<div><pre><code class="language-c#">AccessTokenResponse accessTokenResponse = AccessTokenApi.Create(request_token, verifier_token);
string accessToken = accessTokenResponse.OauthToken;

AccessTokenResponse accessTokenResponse = AccessTokenApi.Create(pairing_request_token, pairing_verifier_token);
string long_access_token = accessTokenResponse.OauthToken; // store for future requests</code></pre></div>
										</div>
										<div id="section10" class="">
											<h3 id="toc_16">7. Retrieve payment, shipping data, rewards and 3DS details</h3>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-c#">string checkoutId = checkoutResourceUrl.IndexOf('?') != -1 ? checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1).Split('?')[0] : checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1);

Checkout checkout = CheckoutApi.Show(checkoutId, accessToken);

Card card = checkout.Card;
Address billingAddress = card.BillingAddress;
Contact contact = checkout.Contact;
AuthenticationOptions authOptions = checkout.AuthenticationOptions;
string preCheckoutTransactionId = checkout.PreCheckoutTransactionId;
RewardProgram rewardProgram = checkout.RewardProgram;
ShippingAddress shippingAddress = checkout.ShippingAddress;
string transactionId = checkout.TransactionId;
string walletId = checkout.WalletID;</code></pre></div>
 										</div>
				 						<div id="section11" class="">
											<h3 id="toc_17">8. Process payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section12" class="">
											<h3 id="toc_18">9. Log transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-c#">//Create an instance of MerchantTransactions
MerchantTransactions objMerchantTransactions = new MerchantTransactions();
List&lt;MerchantTransaction&gt; merchantTransactions = new List&lt;MerchantTransaction&gt;();
MerchantTransaction merchantTransaction = new MerchantTransaction
{
    TransactionId = "4549794", // from Step 7
    PurchaseDate = "2014-08-01T14:52:57.539-05:00",
    ExpressCheckoutIndicator = false,
    ApprovalCode = "888888",  // authorization code returned by payment gateway
    TransactionStatus = "Success",
    OrderAmount = 1229L, // total charged to card
    PreCheckoutTransactionId = "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
    Currency = "USD",
    ConsumerKey = "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d" //generated during onboarding process
};

merchantTransactions.Add(merchantTransaction);

objMerchantTransactions._MerchantTransactions = merchantTransactions;

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.Create(objMerchantTransactions);</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_19">Pairing without Checkout</h2>
										</div>
										<div id="section13" class="">
											<h3 id="toc_20">1. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">string callback_url = "https://www.somemerchant.com/pairingcomplete.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string pairing_request_token = requestTokenResponse.OauthToken;
</code></pre></div>
										</div>
										<div id="section14" class="">
											<h3 id="toc_21">2. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1. </p>
											<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = request_token
};

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);
</code></pre></div>
										</div>
										<div id="section15" class="">
											<h3 id="toc_22">3. Invoke MasterPass UI (Lightbox) for pairing</h3>
											<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button. </p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.connect({ 
       &quot;requestPairing&quot;:true,                                            //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,        //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;, //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
       &quot;version&quot;:&quot;v6&quot;                                                    //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section16" class="">
											<h3 id="toc_23">4. Redirect to callback URL or call callback function</h3>
											<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_24">Example Callback URL (Success)</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
											<h4 id="toc_25">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_26">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_27">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>
										</div>
										<div id="section17" class="">
											<h3 id="toc_28">5. Call Access Token Service</h3>
											<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4. </p>
											<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>
											<div><pre><code class="language-c#">AccessTokenResponse accessTokenResponse = AccessTokenApi.Create(pairing_request_token, pairing_verifier_token);
string long_access_token = accessTokenResponse.OauthToken; // store for future requests
</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_29">Checkout after Pairing</h2>
										</div>
										<div id="section18" class="">
											<h3 id="toc_30">1. Consumer logs onto merchant site</h3>
											<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>
										</div>
										<div id="section19" class="">
											<h3 id="toc_31">2. Call PreCheckout Data Service</h3>
											<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout). </p>
											<div><pre><code class="language-c#">string[] requestedDataTypes = { "REWARD_PROGRAM", "ADDRESS", "PROFILE", "CARD" };
PrecheckoutDataRequest preCheckoutDataRequest = new PrecheckoutDataRequest();
List&lt;PairingDataType&gt; lstPairingDataType = new List&lt;PairingDataType&gt;();
//foreach (var item in requestedDataTypes)
//{
//    lstPairingDataType.Add(new PairingDataType
//    {
//        Type = item
//    });
//}
lstPairingDataType = requestedDataTypes.Select(item => new PairingDataType() { Type = item }).ToList();

preCheckoutDataRequest.PairingDataTypes.PairingDataType = lstPairingDataType;

PrecheckoutDataResponse response = PrecheckoutDataApi.Create(long_access_token, preCheckoutDataRequest);</code></pre></div>
										</div>
										<div id="section20" class="">
											<h3 id="toc_32">3. Consumer makes card/shipping address selection</h3>
											<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used on the Place Order page of the merchant site.</p>
										</div>
										<div id="section21" class="">
											<h3 id="toc_33">4. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">string callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string request_token = requestTokenResponse.OauthToken;</code></pre></div>
										</div>
										<div id="section22" class="">
											<h3 id="toc_34">5. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 4.</p>
											<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest();
ShoppingCart shoppingCart = new ShoppingCart();
List&lt;ShoppingCartItem&gt; shoppingCartItems = new List&lt;ShoppingCartItem&gt;();
shoppingCartItems.Add(new ShoppingCartItem
{
    Value = 1900L,
    Description = "This is one item",
    Quantity = 1
});
shoppingCartItems.Add(new ShoppingCartItem
{
    ImageURL = "https://somemerchant.com/someimage",
    Value = 10000L,
    Description = "Five items",
    Quantity = 5
});

shoppingCart.Subtotal = 11900L;
shoppingCart.CurrencyCode = "USD";
shoppingCart.ShoppingCartItem = shoppingCartItems;

shoppingCartRequest.ShoppingCart = shoppingCart;
shoppingCartRequest.OAuthToken = request_token;

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.Create(shoppingCartRequest);</code></pre></div>
										</div>
										<div id="section23" class="">
											<h3 id="toc_35">6. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 4. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = request_token
};

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section24" class="">
											<h3 id="toc_36">7. Create Buy With MasterPass Button</h3>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
											<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>On the Place Order page of the merchant&#39;s website, create the <strong>Buy with MasterPass</strong> button using the <em>cardId</em>, <em>addressId</em>, and <em>rewardId</em> from Step 3 and the <em>request token</em> from Step 4.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
MasterPass.client.checkout({
     &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
     &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
     &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
     &quot;cardId&quot;:&quot;insert_selected_card_id_here&quot;,                          //required
     &quot;shippingId&quot;:&quot;insert_selected_shipping_address_id_here&quot;,          //required
     &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
     &quot;walletName&quot;:&quot;insert_wallet_name_here&quot;,                           //required
     &quot;consumerWalletId&quot;:&quot;insert_consumer_walletid_here&quot;,               //required
     &quot;loyaltyId&quot;:&quot;insert_loyalty_id_here&quot;,                             //optional
     &quot;requireShippingDestination&quot;: &quot;true&quot;                              //optional                                                                                                                                                                 
     &quot;version&quot;:&quot;v6&quot;,                                                   //optional
     &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 4. </li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>cardId:</strong> The identifier of the selected card collected in Step 3.</li>
												<li><strong>shippingId:</strong> The identifier of the shipping information collected in Step 3.</li>
												<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected in Step 3.</li>
												<li><strong>walletName:</strong> The consumer&#39;s wallet name collected in Step 3.</li>
												<li><strong>consumerWalletId:</strong> The consumer&#39;s wallet identifier collected in Step 3.</li>
												<li><strong>loyaltyId:</strong> The <em>rewardId</em>, optionally collected in Step 3.</li>
												<li><strong>requireShippingDestination:</strong> Denotes whether the consumer&#39;s shipping information is required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section25" class="">
											<h3 id="toc_37">8. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_38">on Success</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 10.</li>
												<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used in conjunction with the <em>request token</em> to retrieve the <em>access token</em> in Step 9. </li>
												<li><strong>oauth_token:</strong> The <em>request token</em> that is used in conjunction with the <em>verifier token</em> to retrieve the <em>access token</em> in Step 9. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
											</ul>
											<h4 id="toc_39">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
											<h4 id="toc_40">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=cancel</code></pre></div>
											<h4 id="toc_41">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=failure</code></pre></div>
											<h4 id="toc_42">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section26" class="">
											<h3 id="toc_43">9. Call Access Token Service</h3>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 8. </p>
											<p>As there is no need to retrieve a <em>long access token</em> again, only this one call to the <strong>Access Token Service</strong> will be made. </p>
											<div><pre><code class="language-java">AccessTokenResponse accessTokenResponse = AccessTokenApi.Create(request_token, verifier_token);
string accessToken = accessTokenResponse.OauthToken;</code></pre></div>
										</div>
										<div id="section27" class="">
											<h3 id="toc_44">10. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>
											<p>Use the <strong>Checkout Resource URL</strong> received in Step 8 and the <em>access token</em> from Step 9 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-c#">string checkoutId = checkoutResourceUrl.IndexOf('?') != -1 ? checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1).Split('?')[0] : checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1);

Checkout checkout = CheckoutApi.Show(checkoutId, accessToken);

Card card = checkout.Card;
Address billingAddress = card.BillingAddress;
Contact contact = checkout.Contact;
AuthenticationOptions authOptions = checkout.AuthenticationOptions;
string preCheckoutTransactionId = checkout.PreCheckoutTransactionId;
RewardProgram rewardProgram = checkout.RewardProgram;
ShippingAddress shippingAddress = checkout.ShippingAddress;
string transactionId = checkout.TransactionId;
string walletId = checkout.WalletID;</code></pre></div>
 										</div>
			 							<div id="section28" class="">
											<h3 id="toc_45">11. Process Payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 10, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section29" class="">
											<h3 id="toc_46">12. Log Transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 11, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-c#">//Create an instance of MerchantTransactions
MerchantTransactions objMerchantTransactions = new MerchantTransactions();
List&lt;MerchantTransaction&gt; merchantTransactions = new List&lt;MerchantTransaction&gt;();
MerchantTransaction merchantTransaction = new MerchantTransaction
{
    TransactionId = "4549794", // from Step 7
    PurchaseDate = "2014-08-01T14:52:57.539-05:00",
    ExpressCheckoutIndicator = false,
    ApprovalCode = "888888",  // authorization code returned by payment gateway
    TransactionStatus = "Success",
    OrderAmount = 1229L, // total charged to card
    PreCheckoutTransactionId = "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
    Currency = "USD",
    ConsumerKey = "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d" //generated during onboarding process
};

merchantTransactions.Add(merchantTransaction);

objMerchantTransactions._MerchantTransactions = merchantTransactions;

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.Create(objMerchantTransactions);</code></pre></div>
										</div>
									</div>
									<!--END C# CONNECTED -->
									<!-- RUBY CONNECTED -->
									<div id="Cruby" class="tab-pane fade">
										
									<div class="">
											<h1 id="toc_2">Connected Checkout Integration</h1>
										</div>
										<div id="" class="">
												<h2 id="toc_3">Pairing During Checkout</h2>
										</div>
										<div id="section2" class="">
											<h3 id="toc_4">1. Call Request Token Service (2 times)</h3>
											<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account. </p>
											<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
pairing_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
pairing_request_token = pairing_token_response.oauth_token;

request_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
request_token = request_token_response.oauth_token;</code></pre></div>
										</div>
										<div id="section3" class="">
											<h3 id="toc_5">2. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>
											<p>Each shopping_cart_item must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A shopping_cart_item may also have an optional image_url. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">shopping_cart_request = MastercardMasterpassMerchant::ShoppingCartRequest.new(
    :o_auth_token => request_token,
    :shopping_cart => MastercardMasterpassMerchant::ShoppingCart.new(
        :currency_code => 'USD',
        :subtotal => '11900',
        :shopping_cart_item => [
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'One Item',
                :quantity => 1,
                :value => 1900
            ),
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'Five of an Item',
                :quantity => 5,
                :value => 10000,
                :image_url => 'http://somemerchant.com/someimage'
            )
        ]
    )
)

shopping_cart_response = MastercardMasterpassMerchant::Api::ShoppingCartApi.create(shopping_cart_request)</code></pre></div>
										</div>
										<div id="section4" class="">
											<h3 id="toc_6">3. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>
										</div>
										<div id="section5" class="">
											<h3 id="toc_7">4. Invoke MasterPass UI (Lightbox) for checkout</h3>
											<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
       &quot;requestPairing&quot;:true,                                                      //required
       &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
       &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
       &quot;version&quot;:&quot;v6&quot;,                                                             //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1. </li>
												<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
											</ul>
										</div>
										<div id="section6" class="">
											<h3 id="toc_8">5. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_9">On success</h4>
											<p>On success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7. </li>
												<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6. </li>
												<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<h4 id="toc_10">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
								<h4 id="toc_11">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_12">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
										</div>
										<div id="section7" class="">
											<h3 id="toc_13">6. Call Access Token Service (2 times)</h3>
											<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction. </p>
											<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions. </p>
											<div><pre><code class="language-ruby">access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(verifier_token, request_token)
access_token = access_token_response.oauth_token

long_access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(pairing_verifier_token, pairing_request_token)
long_access_token = long_access_token_response.oauth_token</code></pre></div>
										</div>
										<div id="section8" class="">
											<h3 id="toc_14">7. Retrieve payment, shipping data, rewards and 3DS details</h3>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-ruby">start_index = checkout_resource_url.rindex('/') + 1
end_index = checkout_resource_url.index('?').nil? ? -1 : checkout_resource_url.index('?')
path_id = checkout_resource_url[start_index..end_index]

checkout = MastercardMasterpassMerchant::Api::CheckoutApi.show(path_id, access_token)
card = checkout.card
billing_address = card.billing_address
contact = checkout.contact
auth_options = checkout.authentication_options
precheckout_transaction_id = checkout.pre_checkout_transaction_id
reward_program = checkout.reward_program
shipping_address = checkout.shipping_address
transaction_id = checkout.transaction_id
wallet_id = checkout.wallet_id</code></pre></div>
 										</div>
				 						<div id="section9" class="">
											<h3 id="toc_15">8. Process payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section10" class="">
											<h3 id="toc_16">9. Log transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-ruby">merchant_transactions = MastercardMasterpassMerchant::MerchantTransactions.new(
    :merchant_transactions => [
        MastercardMasterpassMerchant::MerchantTransaction.new(
            :transaction_id => 4549794,
            :consumer_key => '0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d',
            :currency => 'USD',
            :order_amount => 1800,
            :transaction_status => 'Success',
            :approval_code => '888888',
            :pre_checkout_transaction_id => 'a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947',
            :express_checkout_indicator => false,
            :purchase_date => '2016-06-23T15:09:32+00:00'
        )
    ]
)

merchant_trans_response = MastercardMasterpassMerchant::Api::PostbackApi.create(merchant_transactions)</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_17">Pairing without Checkout</h2>
										</div>
										<div id="section11" class="">
											<h3 id="toc_18">1. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
pairing_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
pairing_request_token = pairing_token_response.oauth_token;</code></pre></div>
										</div>
										<div id="section12" class="">
											<h3 id="toc_19">2. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The origin_url identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1. </p>
											<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => pairing_request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>
										</div>
										<div id="section13" class="">
											<h3 id="toc_20">3. Invoke MasterPass UI (Lightbox) for pairing</h3>
											<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button. </p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.connect({ 
       &quot;requestPairing&quot;:true,                                            //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,        //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;, //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
       &quot;version&quot;:&quot;v6&quot;                                                    //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section14" class="">
											<h3 id="toc_21">4. Redirect to callback URL or call callback function</h3>
											<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_22">Example Callback URL (Success)</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
											<h4 id="toc_23">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_24">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_25">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>
										</div>
										<div id="section15" class="">
											<h3 id="toc_26">5. Call Access Token Service</h3>
											<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4. </p>
											<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>
											<div><pre><code class="language-ruby">long_access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(pairing_verifier_token, pairing_request_token)
long_access_token = long_access_token_response.oauth_token</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_27">Checkout after Pairing</h2>
										</div>
										<div id="section16" class="">
											<h3 id="toc_28">1. Consumer logs onto merchant site</h3>
											<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>
										</div>
										<div id="section18" class="">
											<h3 id="toc_29">2. Call PreCheckout Data Service</h3>
											<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout). </p>
											<div><pre><code class="language-ruby">requested_data_types = ['REWARD_PROGRAM', 'ADDRESS', 'PROFILE', 'CARD']
pairing_data_types = []
requested_data_types.each do |data_type|
  pairing_data_type = MastercardMasterpassMerchant::PairingDataType.new
  pairing_data_type.type = data_type
  pairing_data_types.append(pairing_data_type)
end

pre_checkout_data_request = MastercardMasterpassMerchant::PrecheckoutDataRequest.new(
    :pairing_data_types => MastercardMasterpassMerchant::PairingDataTypes.new(
        :pairing_data_type => pairing_data_types
    )
)

response = MastercardMasterpassMerchant::Api::PrecheckoutDataApi.create(long_access_token, pre_checkout_data_request)</code></pre></div>
										</div>
										<div id="section19" class="">
											<h3 id="toc_30">3. Consumer makes card/shipping address selection</h3>
											<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used on the Place Order page of the merchant site.</p>
										</div>
										<div id="section20" class="">
											<h3 id="toc_31">4. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
request_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
request_token = request_token_response.oauth_token;</code></pre></div>
										</div>
										<div id="section21" class="">
											<h3 id="toc_32">5. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 4.</p>
											<p>Each shopping_cart_item must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A shopping_cart_item may also have an optional image_url. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">shopping_cart_request = MastercardMasterpassMerchant::ShoppingCartRequest.new(
    :o_auth_token => request_token,
    :shopping_cart => MastercardMasterpassMerchant::ShoppingCart.new(
        :currency_code => 'USD',
        :subtotal => '11900',
        :shopping_cart_item => [
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'One Item',
                :quantity => 1,
                :value => 1900
            ),
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'Five of an Item',
                :quantity => 5,
                :value => 10000,
                :image_url => 'http://somemerchant.com/someimage'
            )
        ]
    )
)

shopping_cart_response = MastercardMasterpassMerchant::Api::ShoppingCartApi.create(shopping_cart_request)</code></pre></div>
										</div>
										<div id="section22" class="">
											<h3 id="toc_33">6. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 4. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>
										</div>
										<div id="section23" class="">
											<h3 id="toc_34">7. Create Buy With MasterPass Button</h3>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
											<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>On the Place Order page of the merchant&#39;s website, create the <strong>Buy with MasterPass</strong> button using the <em>cardId</em>, <em>addressId</em>, and <em>rewardId</em> from Step 3 and the <em>request token</em> from Step 4.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
MasterPass.client.checkout({
     &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
     &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
     &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
     &quot;cardId&quot;:&quot;insert_selected_card_id_here&quot;,                          //required
     &quot;shippingId&quot;:&quot;insert_selected_shipping_address_id_here&quot;,          //required
     &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
     &quot;walletName&quot;:&quot;insert_wallet_name_here&quot;,                           //required
     &quot;consumerWalletId&quot;:&quot;insert_consumer_walletid_here&quot;,               //required
     &quot;loyaltyId&quot;:&quot;insert_loyalty_id_here&quot;,                             //optional
     &quot;requireShippingDestination&quot;: &quot;true&quot;                              //optional                                                                                                                                                                 
     &quot;version&quot;:&quot;v6&quot;,                                                   //optional
     &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 4. </li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>cardId:</strong> The identifier of the selected card collected in Step 3.</li>
												<li><strong>shippingId:</strong> The identifier of the shipping information collected in Step 3.</li>
												<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected in Step 3.</li>
												<li><strong>walletName:</strong> The consumer&#39;s wallet name collected in Step 3.</li>
												<li><strong>consumerWalletId:</strong> The consumer&#39;s wallet identifier collected in Step 3.</li>
												<li><strong>loyaltyId:</strong> The <em>rewardId</em>, optionally collected in Step 3.</li>
												<li><strong>requireShippingDestination:</strong> Denotes whether the consumer&#39;s shipping information is required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section24" class="">
											<h3 id="toc_35">8. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_36">On Success</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 10.</li>
												<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used in conjunction with the <em>request token</em> to retrieve the <em>access token</em> in Step 9. </li>
												<li><strong>oauth_token:</strong> The <em>request token</em> that is used in conjunction with the <em>verifier token</em> to retrieve the <em>access token</em> in Step 9. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
											</ul>
											<h4 id="toc_37">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
											<h4 id="toc_38">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_39">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_40">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section25" class="">
											<h3 id="toc_41">9. Call Access Token Service</h3>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 8. </p>
											<p>As there is no need to retrieve a <em>long access token</em> again, only this one call to the <strong>Access Token Service</strong> will be made. </p>
											<div><pre><code class="language-ruby">access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(verifier_token, request_token)
access_token = access_token_response.oauth_token</code></pre></div>
										</div>
										<div id="section26" class="">
											<h3 id="toc_42">10. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>
											<p>Use the <strong>Checkout Resource URL</strong> received in Step 8 and the <em>access token</em> from Step 9 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-ruby">start_index = checkout_resource_url.rindex('/') + 1
end_index = checkout_resource_url.index('?').nil? ? -1 : checkout_resource_url.index('?')
path_id = checkout_resource_url[start_index..end_index]

checkout = MastercardMasterpassMerchant::Api::CheckoutApi.show(path_id, access_token)
card = checkout.card
billing_address = card.billing_address
contact = checkout.contact
auth_options = checkout.authentication_options
precheckout_transaction_id = checkout.pre_checkout_transaction_id
reward_program = checkout.reward_program
shipping_address = checkout.shipping_address
transaction_id = checkout.transaction_id
wallet_id = checkout.wallet_id</code></pre></div>
 										</div>
			 							<div id="section27" class="">
											<h3 id="toc_44">11. Process Payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 10, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section28" class="">
											<h3 id="toc_45">12. Log Transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 11, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-ruby">merchant_transactions = MastercardMasterpassMerchant::MerchantTransactions.new(
    :merchant_transactions => [
        MastercardMasterpassMerchant::MerchantTransaction.new(
            :transaction_id => 4549794,
            :consumer_key => '0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d',
            :currency => 'USD',
            :order_amount => 1800,
            :transaction_status => 'Success',
            :approval_code => '888888',
            :pre_checkout_transaction_id => 'a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947',
            :express_checkout_indicator => false,
            :purchase_date => '2016-06-23T15:09:32+00:00'
        )
    ]
)

merchant_trans_response = MastercardMasterpassMerchant::Api::PostbackApi.create(merchant_transactions)</code></pre></div>
										</div>
									</div>
									<!-- END RUBY CONNECTED -->
									<!-- BEGIN PHP CONNECTED -->
									<div id="Cphp" class="tab-pane fade">
										<div class="">
											<h1 id="toc_2">Connected Checkout Integration</h1>
										</div>
										<div id="" class="">
												<h2 id="toc_3">Pairing During Checkout</h2>
										</div>
										<div id="section2" class="">
											<h3 id="toc_4">1. Call Request Token Service (2 times)</h3>
											<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account. </p>
											<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callbackUrl that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/checkoutconfirm.htm";

$pairingResponse = RequestTokenApi::create($callbackUrl);
$pairingRequestToken = $pairingResponse->getOauthToken();

$checkoutResponse = RequestTokenApi::create($callbackUrl);
$checkoutRequestToken = $checkoutResponse::getOauthToken();</code></pre></div>
										</div>
										<div id="section3" class="">
											<h3 id="toc_5">2. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>
											<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional ImageURL. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">//Build Out ShoppingCartRequest object
$shoppingCartItem1 = new ShoppingCartItem(
	array(
		"Value" => 700,
		"Description" => "This is one item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someimage"
	)
);

$shoppingCartItem2 = new ShoppingCartItem(
	array(
		"Value" => 300,
		"Description" => "This is another item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someotherimage"
	)
);

$shoppingCart = new ShoppingCart(
	array(
		"CurrencyCode" => "USD",
		"Subtotal" => 1000,
		"ShoppingCartItem" => array($shoppingCartItem1, $shoppingCartItem2)
	)
);

$shoppingCartRequest = new ShoppingCartRequest(
	array(
		"OAuthToken" => $requestToken,
		"OriginUrl" => $callbackDomain,
		"ShoppingCart" => $shoppingCart,
	)
);

//Call the ShoppingCartService with required params
$shoppingCartResponse = ShoppingCartApi::create($shoppingCartRequest);</code></pre></div>
										</div>
										<div id="section4" class="">
											<h3 id="toc_6">3. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The OriginUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $checkoutRequestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section5" class="">
											<h3 id="toc_7">4. Invoke MasterPass UI (Lightbox) for checkout</h3>
											<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.checkout({ 
       &quot;requestPairing&quot;:true,                                                      //required
       &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
       &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
       &quot;version&quot;:&quot;v6&quot;,                                                             //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1. </li>
												<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
											</ul>
										</div>
										<div id="section6" class="">
											<h3 id="toc_8">5. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_9">On success</h4>
											<p>On success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7. </li>
												<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6. </li>
												<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<h4 id="toc_10">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
								<h4 id="toc_11">Example Callback URL (Cancel)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
								<h4 id="toc_12">Example Callback URL (Failure)</h4>
								<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
										</div>
										<div id="section7" class="">
											<h3 id="toc_13">6. Call Access Token Service (2 times)</h3>
											<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction. </p>
											<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions. </p>
											<div><pre><code class="language-php">$checkoutAccessTokenResponse = AccessTokenApi::create(oauthCheckoutRequestToken, oauthCheckoutVerifierToken);
$checkoutAccessToken = checkoutAccessTokenResponse->getOauthToken();

$longAccessTokenResponse = AccessTokenApi::create(oauthPairingRequestToken, oauthPairingVerifierToken);
$longAccessToken = longAccessTokenResponse->getOauthToken(); // store for future requests</code></pre></div>
										</div>
										<div id="section8" class="">
											<h3 id="toc_14">7. Retrieve payment, shipping data, rewards and 3DS details</h3>
											<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-php">$explodedURL = explode("/", $checkoutResourceUrl);
$checkoutId = array_pop($explodedURL);
if(strpos($checkoutId, "?") !== false){
	$checkoutId = explode($checkoutId, "?")[0];
}

$logger->info($checkoutId);

$checkout = CheckoutApi::show($checkoutId, $accessToken);

$card = $checkout->getCard();
$billingAddress = $card->getBillingAddress();
$contact = $checkout->getContact();
$authOptions = checkout->getAuthenticationOptions(); 
$preCheckoutTransactionId = checkout->getPreCheckoutTransactionId(); 
$rewardProgram = checkout->getRewardProgram(); 
$shippingAddress = checkout->getShippingAddress();
$transactionId = checkout->getTransactionId();
$walletId = checkout->getWalletID();</code></pre></div>
 										</div>
				 						<div id="section9" class="">
											<h3 id="toc_15">8. Process payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section10" class="">
											<h3 id="toc_16">9. Log transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-php">//Create an instance of MerchantTransactions
$merchantTransaction = new MerchantTransaction(
	array(
		"TransactionId" => "4549794",
		"ConsumerKey" => "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d", //generated during onboarding process
		"Currency" => "USD",
		"OrderAmount" => 500, // total charged to card
		"TransactionStatus" => "Success",
		"ApprovalCode" => "888888", // authorization code returned by payment gateway
		"PrecheckoutTransactionId" => "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
		"ExpressCheckoutIndicator" => false,
		"PurchaseDate" => date("Y/m/d H:i:s")
	)
);
$request = new MerchantTransactions(array("MerchantTransactions" => array($merchantTransaction)));

//Call the PostbackService with required params
$response = PostbackApi::create($request);</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_17">Pairing without Checkout</h2>
										</div>
										<div id="section11" class="">
											<h3 id="toc_18">1. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callbackUrl that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/pairingcomplete.htm";
$requestTokenResponse = RequestTokenApi::create($callbackUrl);
$pairingRequestToken = $requestTokenResponse->getOauthToken();</code></pre></div>
										</div>
										<div id="section12" class="">
											<h3 id="toc_19">2. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The OriginUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1. </p>
											<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $pairingRequestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section13" class="">
											<h3 id="toc_20">3. Invoke MasterPass UI (Lightbox) for pairing</h3>
											<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>
											<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>
											<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button. </p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt; 
    MasterPass.client.connect({ 
       &quot;requestPairing&quot;:true,                                            //required
       &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,        //required
       &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;, //required
       &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
       &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
       &quot;version&quot;:&quot;v6&quot;                                                    //optional
       &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
       &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
    });
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
												<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section14" class="">
											<h3 id="toc_21">4. Redirect to callback URL or call callback function</h3>
											<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_22">Example Callback URL (Success)</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
												<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
											</ul>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>
											<h4 id="toc_23">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_24">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_25">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>
										</div>
										<div id="section15" class="">
											<h3 id="toc_26">5. Call Access Token Service</h3>
											<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4. </p>
											<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>
											<div><pre><code class="language-php">$accessTokenResponse = AccessTokenApi::create($pairingRequestToken, $pairingVerifierToken);
$longAccessToken = $accessTokenResponse->getOauthToken(); // store for future requests</code></pre></div>
										</div>
										<div class="">
											<h2 id="toc_27">Checkout after Pairing</h2>
										</div>
										<div id="section16" class="">
											<h3 id="toc_28">1. Consumer logs onto merchant site</h3>
											<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>
										</div>
										<div id="section18" class="">
											<h3 id="toc_29">2. Call PreCheckout Data Service</h3>
											<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout). </p>
											<div><pre><code class="language-php">$requestedDataTypes = array("REWARD_PROGRAM", "ADDRESS", "PROFILE", "CARD");

$preCheckoutDataRequest = new PreCheckoutDataRequest();
$pairingDataTypes = new PairingDataTypes();

foreach ($requestedDataTypes as $pairingType){
	$newPairingType = new PairingDataType(
		array(
			"Type" => $pairingType
		)
	);
	$pairingDataTypes->setPairingDataType = $newPairingType;
}

$preCheckoutDataRequest->setPairingDataTypes($pairingDataTypes);

$preCheckoutDataResponse = PrecheckoutDataApi::create($longAccessToken, $preCheckoutDataRequest);</code></pre></div>
										</div>
										<div id="section19" class="">
											<h3 id="toc_30">3. Consumer makes card/shipping address selection</h3>
											<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used on the Place Order page of the merchant site.</p>
										</div>
										<div id="section20" class="">
											<h3 id="toc_31">4. Call Request Token Service</h3>
											<p>Call the <strong>Request Token Service</strong> to generate the <em>request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callbackUrl that the browser will redirect to when the Lightbox closes. </p>
											<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/checkoutconfirm.htm";
$requestTokenResponse = RequestTokenApi::create($callbackUrl);
$requestToken = $requestTokenResponse->getOauthToken();</code></pre></div>
										</div>
										<div id="section21" class="">
											<h3 id="toc_32">5. Call Shopping Cart Service</h3>
											<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>request token</em> from Step 4.</p>
											<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional ImageURL. </p>
											<p>The <strong>Shopping Cart Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">//Build Out ShoppingCartRequest object
$shoppingCartItem1 = new ShoppingCartItem(
	array(
		"Value" => 700,
		"Description" => "This is one item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someimage"
	)
);

$shoppingCartItem2 = new ShoppingCartItem(
	array(
		"Value" => 300,
		"Description" => "This is another item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someotherimage"
	)
);

$shoppingCart = new ShoppingCart(
	array(
		"CurrencyCode" => "USD",
		"Subtotal" => 1000,
		"ShoppingCartItem" => array($shoppingCartItem1, $shoppingCartItem2)
	)
);

$shoppingCartRequest = new ShoppingCartRequest(
	array(
		"OAuthToken" => $requestToken,
		"OriginUrl" => $callbackDomain,
		"ShoppingCart" => $shoppingCart,
	)
);

//Call the ShoppingCartService with required params
$shoppingCartResponse = ShoppingCartApi::create($shoppingCartRequest);</code></pre></div>
										</div>
										<div id="section22" class="">
											<h3 id="toc_33">6. Call Merchant Initialization Service</h3>
											<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The OriginUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 4. </p>
											<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>
											<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $requestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>
										</div>
										<div id="section23" class="">
											<h3 id="toc_34">7. Create Buy With MasterPass Button</h3>
											<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>
											<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>
											<p>On the Place Order page of the merchant&#39;s website, create the <strong>Buy with MasterPass</strong> button using the <em>cardId</em>, <em>addressId</em>, and <em>rewardId</em> from Step 3 and the <em>request token</em> from Step 4.</p>
											<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
MasterPass.client.checkout({
     &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
     &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
     &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
     &quot;cardId&quot;:&quot;insert_selected_card_id_here&quot;,                          //required
     &quot;shippingId&quot;:&quot;insert_selected_shipping_address_id_here&quot;,          //required
     &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
     &quot;walletName&quot;:&quot;insert_wallet_name_here&quot;,                           //required
     &quot;consumerWalletId&quot;:&quot;insert_consumer_walletid_here&quot;,               //required
     &quot;loyaltyId&quot;:&quot;insert_loyalty_id_here&quot;,                             //optional
     &quot;requireShippingDestination&quot;: &quot;true&quot;                              //optional                                                                                                                                                                 
     &quot;version&quot;:&quot;v6&quot;,                                                   //optional
     &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
     &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});
&lt;/script&gt;</code></pre></div>
											<ul>
												<li><strong>requestToken:</strong> The <em>request token</em> generated in Step 4. </li>
												<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
												<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
												<li><strong>cardId:</strong> The identifier of the selected card collected in Step 3.</li>
												<li><strong>shippingId:</strong> The identifier of the shipping information collected in Step 3.</li>
												<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected in Step 3.</li>
												<li><strong>walletName:</strong> The consumer&#39;s wallet name collected in Step 3.</li>
												<li><strong>consumerWalletId:</strong> The consumer&#39;s wallet identifier collected in Step 3.</li>
												<li><strong>loyaltyId:</strong> The <em>rewardId</em>, optionally collected in Step 3.</li>
												<li><strong>requireShippingDestination:</strong> Denotes whether the consumer&#39;s shipping information is required.</li>
												<li><strong>version:</strong> MasterPass API version (default is v6).</li>
												<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
												<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
												<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
											</ul>
										</div>
										<div id="section24" class="">
											<h3 id="toc_35">8. Redirect to callback URL or call callback function</h3>
											<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function. </p>
											<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied. </p>
											<h4 id="toc_36">On Success</h4>
											<p>On Success, MasterPass returns the following parameters:</p>
											<ul>
												<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
												<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 10.</li>
												<li><strong>oauth_verifier:</strong> The <em>verifier token</em> that is used in conjunction with the <em>request token</em> to retrieve the <em>access token</em> in Step 9. </li>
												<li><strong>oauth_token:</strong> The <em>request token</em> that is used in conjunction with the <em>verifier token</em> to retrieve the <em>access token</em> in Step 9. This token has the same value as the <em>request token</em> that is generated in Step 1. </li>
											</ul>
											<h4 id="toc_37">Example Callback URL (Success)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fsandbox.api.mastercard.com%2Fmasterpass\%2Fv6%2Fcheckout%2F10189977%3Fwallet%3Dphw
&amp;oauth_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;oauth_token=d6fa60984308aebb6183d44fb9688fb9dc8332dc</code></pre></div>
											<h4 id="toc_38">Example Callback URL (Cancel)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>
											<h4 id="toc_39">Example Callback URL (Failure)</h4>
											<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>
											<h4 id="toc_40">Example Callback Function (Success)</h4>
											<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.oauth_token, data.oauth_verifier, data.checkout_resource_url);
}</code></pre></div>
										</div>
										<div id="section25" class="">
											<h3 id="toc_41">9. Call Access Token Service</h3>
											<p>If the checkout was completed successfully, call the <strong>Access Token Service</strong> to retrieve an <em>access token</em>. You will need the <em>request token</em> and the <em>verifier token</em> received in Step 8. </p>
											<p>As there is no need to retrieve a <em>long access token</em> again, only this one call to the <strong>Access Token Service</strong> will be made. </p>
											<div><pre><code class="language-php">$accessTokenResponse = AccessTokenApi::create($requestToken, $verifierToken);
$accessToken = $accessTokenResponse->getOauthToken();</code></pre></div>
										</div>
										<div id="section26" class="">
											<h3 id="toc_42">10. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>
											<p>Use the <strong>Checkout Resource URL</strong> received in Step 8 and the <em>access token</em> from Step 9 to retrieve the constomer’s payment, shipping, reward and 3-D Secure information from MasterPass. </p>
											<div><pre><code class="language-php">$explodedURL = explode("/", $checkoutResourceUrl);
$checkoutId = array_pop($explodedURL);
if(strpos($checkoutId, "?") !== false){
	$checkoutId = explode($checkoutId, "?")[0];
}

$logger->info($checkoutId);

$checkout = CheckoutApi::show($checkoutId, $accessToken);

$card = $checkout->getCard();
$billingAddress = $card->getBillingAddress();
$contact = $checkout->getContact();
$authOptions = checkout->getAuthenticationOptions(); 
$preCheckoutTransactionId = checkout->getPreCheckoutTransactionId(); 
$rewardProgram = checkout->getRewardProgram(); 
$shippingAddress = checkout->getShippingAddress();
$transactionId = checkout->getTransactionId();
$walletId = checkout->getWalletID();</code></pre></div>
 										</div>
			 							<div id="section27" class="">
											<h3 id="toc_44">11. Process Payment through a payment gateway</h3>
											<p>Using the data retrieved in Step 10, process the payment through the merchant&#39;s payment gateway.</p>
										</div>
										<div id="section28" class="">
											<h3 id="toc_45">12. Log Transactions with MasterPass</h3>
											<p>After the payment has been processed in Step 11, make a service call to communicate the result of the transaction to MasterPass.</p>
											<div><pre><code class="language-php">//Create an instance of MerchantTransactions
$merchantTransaction = new MerchantTransaction(
	array(
		"TransactionId" => "4549794",
		"ConsumerKey" => "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d", //generated during onboarding process
		"Currency" => "USD",
		"OrderAmount" => 500, // total charged to card
		"TransactionStatus" => "Success",
		"ApprovalCode" => "888888", // authorization code returned by payment gateway
		"PrecheckoutTransactionId" => "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
		"ExpressCheckoutIndicator" => false,
		"PurchaseDate" => date("Y/m/d H:i:s")
	)
);
$request = new MerchantTransactions(array("MerchantTransactions" => array($merchantTransaction)));

//Call the PostbackService with required params
$response = PostbackApi::create($request);</code></pre></div>
										</div>
									</div>
									<!-- END PHP CONNECTED -->
								</div>
							</div>
							<!-- END SERVER SIDE CONNECTED CHECKOUT -->

							<!-- BEGIN SERVER SIDE EXPRESS CHECKOUT -->
							<div class="tab-pane" id="ssExpress">
								<ul class="nav nav-pills">
									<li class="dropdown active">
										<a class="dropdown-toggle" data-toggle="dropdown" href="#">Change SDK Language
										<span class="caret"></span></a> <span class="titleCheckout">Express</span>
										<ul class="dropdown-menu">
											<li><a data-toggle="tab" href="#Ejava">Java</a></li>
											<li><a data-toggle="tab" href="#Ecsharp">C#</a></li>
											<li><a data-toggle="tab" href="#Eruby">Ruby</a></li>
											<li><a data-toggle="tab" href="#Ephp">PHP</a></li> 
										</ul>
									</li>
								</ul>

								<div class="tab-content">
									<!-- BEGIN EXPRESS JAVA CONTENT -->
									<div id="Ejava" class="tab-pane fade in active">

										<h1 id="toc_4">Express Checkout Integration</h1>

										<h2 id="toc_5">Pairing During Checkout</h2>

										<h3 id="toc_6">1. Call Request Token Service (2 times)</h3>

										<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account.</p>

										<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";

RequestTokenResponse pairingResponse = RequestTokenApi.create(callback_url);
String pairing_request_token = pairingResponse.getOauthToken();

RequestTokenResponse checkoutResponse = RequestTokenApi.create(callback_url);
String checkout_request_token = checkoutResponse.getOauthToken();
</code></pre></div>

										<h3 id="toc_7">2. Call Shopping Cart Service</h3>

										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL.</p>

										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-java">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest()
		.shoppingCart(new ShoppingCart()
			.subtotal(11900L)
			.currencyCode("USD")
			.shoppingCartItem(new ShoppingCartItem()
				.value(1900L)
				.description("This is one item")
				.quantity(1))

			.shoppingCartItem(new ShoppingCartItem()
				.imageURL("https://somemerchant.com/someimage")
				.value(10000L)
				.description("Five items")
				.quantity(5)))
		.oAuthToken(request_token);

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.create(shoppingCartRequest);</code></pre></div>

										<h3 id="toc_8">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
		.originUrl("https://somemerchant.com")
		.oAuthToken(checkout_request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_9">4. Invoke MasterPass UI (Lightbox) for checkout</h3>

										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.checkout({
        &quot;requestPairing&quot;:true,                                                      //required
        &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
        &quot;requestExpressCheckout&quot;: true,                                             //required
        &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
        &quot;version&quot;:&quot;v6&quot;,                                                             //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1.</li>
											<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set this property to true to request pairing for Express Checkout.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
										</ul>

										<h3 id="toc_10">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_11">On success</h4>

										<p>On success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6.</li>
											<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<h4 id="toc_12">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_13">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_14">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>

										<h3 id="toc_15">6. Call Access Token Service (2 times)</h3>

										<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction.</p>

										<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions.</p>

										<div><pre><code class="language-java">AccessTokenResponse checkoutAccessTokenResponse = AccessTokenApi.create(oauth_checkout_request_token, oauth_checkout_verifier_token);
String checkout_access_token = checkoutAccessTokenResponse.getOauthToken();

AccessTokenResponse longAccessTokenResponse = AccessTokenApi.create(oauth_pairing_request_token, oauth_pairing_verifier_token);
String long_access_token = longAccessTokenResponse.getOauthToken(); // store for future requests</code></pre></div>

										<h3 id="toc_16">7. Retrieve payment, shipping data, rewards and 3DS details</h3>

										<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer&#39;s payment, shipping, reward and 3-D Secure information from MasterPass.</p>

										<div><pre><code class="language-java">int startIndex = checkoutResourceUrl.lastIndexOf('/') + 1;
int endIndex = checkoutResourceUrl.indexOf('?') != -1 ? 
		checkoutResourceUrl.indexOf('?')
		: checkoutResourceUrl.length();
String checkoutId = checkoutResourceUrl.substring(startIndex, endIndex);

Checkout checkout = CheckoutApi.show(checkoutId, accessToken);

Card card = checkout.getCard();
Address billingAddress = card.getBillingAddress();
Contact contact = checkout.getContact();
AuthenticationOptions authOptions = checkout.getAuthenticationOptions(); 
String preCheckoutTransactionId = checkout.getPreCheckoutTransactionId(); 
RewardProgram rewardProgram = checkout.getRewardProgram(); 
ShippingAddress shippingAddress = checkout.getShippingAddress();
String transactionId = checkout.getTransactionId();
String walletId = checkout.getWalletID();</code></pre></div>

										<h3 id="toc_17">8. Process payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_18">9. Log transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-java">//Create an instance of MerchantTransactions
MerchantTransactions request = new MerchantTransactions()
		.merchantTransactions(new MerchantTransaction()
			.transactionId("4549794")                        // from Step 7
			.purchaseDate("2014-08-01T14:52:57.539-05:00")
			.expressCheckoutIndicator(false)
			.approvalCode("888888")                          // authorization code returned by payment gateway
			.transactionStatus(TransactionStatusEnum.valueOf("Success"))
			.orderAmount(1229L)                              // total charged to card
			.preCheckoutTransactionId("a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947") // from Step 7
			.currency("USD")
			.consumerKey("0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d")); //generated during onboarding process

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.create(request);</code></pre></div>

										<h2 id="toc_19">Pairing without Checkout</h2>

										<h3 id="toc_20">1. Call Request Token Service</h3>

										<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/pairingcomplete.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.create(callback_url);
String pairing_request_token = requestTokenResponse.getOauthToken();</code></pre></div>

										<h3 id="toc_21">2. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1.</p>

										<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
		.originUrl("https://somemerchant.com")
		.oAuthToken(pairing_request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);
</code></pre></div>

										<h3 id="toc_22">3. Invoke MasterPass UI (Lightbox) for pairing</h3>

										<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.connect({
        &quot;requestPairing&quot;:true,                                                  //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,              //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;,        //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                         //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
        &quot;requestExpressCheckout&quot;:true,                                          //required
        &quot;version&quot;:&quot;v6&quot;,                                                         //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                   //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set to true to indicate pairing for Express Checkout.</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_23">4. Redirect to callback URL or call callback function</h3>

										<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_24">Example Callback URL (Success)</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_25">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_26">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_27">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>

										<h3 id="toc_28">5. Call Access Token Service</h3>

										<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4.</p>

										<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>

										<div><pre><code class="language-java">AccessTokenResponse accessTokenResponse = AccessTokenApi.create(pairing_request_token, pairing_verifier_token);
String long_access_token = accessTokenResponse.getOauthToken(); // store for future requests</code></pre></div>

										<h2 id="toc_29">Express Checkout</h2>

										<h3 id="toc_30">1. Consumer logs onto merchant site</h3>

										<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>

										<h3 id="toc_31">2. Call PreCheckout Data Service</h3>

										<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout).</p>

										<div><pre><code class="language-java">String[] requestedDataTypes = {"REWARD_PROGRAM", "ADDRESS", "PROFILE", "CARD"};

PrecheckoutDataRequest preCheckoutDataRequest = new PrecheckoutDataRequest();
PairingDataTypes pairingDataTypes = new PairingDataTypes();
for(int i = 0; i &lt; requestedDataTypes.length; i++){
	pairingDataTypes.pairingDataType(new PairingDataType().type(TypeEnum.valueOf(requestedDataTypes[i])));
}
preCheckoutDataRequest.pairingDataTypes(pairingDataTypes);

PrecheckoutDataResponse response = PrecheckoutDataApi.create(long_access_token, preCheckoutDataRequest);</code></pre></div>

										<h3 id="toc_32">3. Consumer makes card/shipping address selection</h3>

										<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used to get the checkout details.</p>

										<h3 id="toc_33">4. Display place order page</h3>

										<p>Show the place order button to the user.  Use the selected precheckout data as placeholders for order details.</p>

										<h3 id="toc_34">5. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>Call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected in Step 3 from MasterPass.</p>

										<div><pre><code class="language-java">ExpressCheckoutRequest expressCheckoutRequest = new ExpressCheckoutRequest()
		.precheckoutTransactionId("insert_precheckoutTransactionId_here")  // from precheckout data
		.merchantCheckoutId("insert_checkoutId_here")
		.originUrl("http://www.somemerchant.com")
		.currencyCode("USD")
		.advancedCheckoutOverride(false)                                   // set to true to disable 3-DS authentication
		.orderAmount("1299")
		.digitalGoods(false)
		.cardId("consumer_selected_cardId")
		.shippingAddressId("consumer_selected_shippingAddressId")
		.rewardProgramId("consumer_selected_rewardId");

ExpressCheckoutResponse response = ExpressCheckoutApi.create("insert_longAccessToken_here", expressCheckoutRequest);

Checkout checkout = response.getCheckout();

Card card = checkout.getCard();
Address billingAddress = card.getBillingAddress();
Contact contact = checkout.getContact();
AuthenticationOptions authOptions = checkout.getAuthenticationOptions();
String preCheckoutTransactionId = checkout.getPreCheckoutTransactionId();
RewardProgram rewardProgram = checkout.getRewardProgram();
ShippingAddress shippingAddress = checkout.getShippingAddress();
String transactionId = checkout.getTransactionId();
String walletId = checkout.getWalletID();</code></pre></div>

										<h3 id="toc_35">6. Handle 3-DS Authentication if needed</h3>

										<p>The <strong>Express Checkout Service</strong> may indicate that the consumer needs to pass 3-DS authentication before MasterPass can return the full credit card details.  This will be indicated with an error on the response.  See the section <strong>3-DS Security</strong> and then return to this step.</p>

										<h3 id="toc_36">7. Process Payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 5, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_37">8. Log Transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 7, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-java">//Create an instance of MerchantTransactions
MerchantTransactions request = new MerchantTransactions()
		.merchantTransactions(new MerchantTransaction()
			.transactionId("4549794")
			.purchaseDate("2014-08-01T14:52:57.539-05:00")
			.expressCheckoutIndicator(true)                  // mark this as true
			.approvalCode("888888")                          // authorization code returned by payment gateway
			.transactionStatus(TransactionStatusEnum.valueOf("Success"))
			.orderAmount(1229L)                              // total charged to card
			.preCheckoutTransactionId("a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947")
			.currency("USD")
			.consumerKey("0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d")); //generated during onboarding process

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.create(request);</code></pre></div>

										<h2 id="toc_38">3-DS Security</h2>

										<p>If the merchant has enabled 3-D Secure, the consumer will be required to provide additional authentication before MasterPass can return full credit card details. When this is the case, the <strong>Express Checkout Service</strong> (Step 6 of the Express Checkout flow) will return an error message indicating the need for 3-DS authentication. </p>

										<h3 id="toc_39">1. Determine if 3-DS Authentication is needed</h3>

										<p>Call the <strong>Express Checkout Service</strong> using your <em>long access token</em>. Check the response for an error that indicates 3-DS is needed.</p>

										<div><pre><code class="language-java">ExpressCheckoutResponse response = ExpressCheckoutApi.create("insert_longAccessToken_here", expressCheckoutRequest);

boolean expressSecurityRequired = false;

for (Error error : response.getErrors().getError()) {
	if (error.getSource().equals("3DS Needed")) {
		expressSecurityRequired = true;
	}
}</code></pre></div>

										<h3 id="toc_40">2. Call Request Token Service</h3>

										<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-java">String callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.create(callback_url);
String request_token = requestTokenResponse.getOauthToken();</code></pre></div>

										<h3 id="toc_41">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 2.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-java">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest()
		.originUrl("https://somemerchant.com")
		.oAuthToken(request_token);

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.create(merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_42">4. Initialize the MasterPass Card Security lightbox</h3>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>

										<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>On the Place Order page of the merchant&#39;s website, launch the Card Securty lightbox interface.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;

MasterPass.client.cardSecurity({
    &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
    &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
    &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
    &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
    &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});

&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestToken:</strong> The request token generated in Step 2.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected from the precheckout data.</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_43">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes the security authentication, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_44">on Success</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass Card Security flow resulted in success, failure, or cancel.</li>
										</ul>

										<h4 id="toc_45">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success</code></pre></div>

										<h4 id="toc_46">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_47">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_48">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.mpstatus);
}</code></pre></div>

										<h3 id="toc_49">6. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>If the authentication was completed successfully, call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected by the consumer from MasterPass.</p>

										<div><pre><code class="language-java">ExpressCheckoutRequest expressCheckoutRequest = new ExpressCheckoutRequest()
		.precheckoutTransactionId("insert_precheckoutTransactionId_here")  // from precheckout data
		.merchantCheckoutId("insert_checkoutId_here")
		.originUrl("http://www.somemerchant.com")
		.currencyCode("USD")
		.advancedCheckoutOverride(false)                                   // set to true to disable 3-DS authentication
		.orderAmount("1299")
		.digitalGoods(false)
		.cardId("consumer_selected_cardId")
		.shippingAddressId("consumer_selected_shippingAddressId")
		.rewardProgramId("consumer_selected_rewardId");

ExpressCheckoutResponse response = ExpressCheckoutApi.create("insert_longAccessToken_here", expressCheckoutRequest);

Checkout checkout = response.getCheckout();

Card card = checkout.getCard();
Address billingAddress = card.getBillingAddress();
Contact contact = checkout.getContact();
AuthenticationOptions authOptions = checkout.getAuthenticationOptions();
String preCheckoutTransactionId = checkout.getPreCheckoutTransactionId();
RewardProgram rewardProgram = checkout.getRewardProgram();
ShippingAddress shippingAddress = checkout.getShippingAddress();
String transactionId = checkout.getTransactionId();
String walletId = checkout.getWalletID();
</code></pre></div>

									</div>
									<!-- END EXPRESS JAVA CONTENT -->
									<!-- C# EXPRESS CONTENT -->
									<div id="Ecsharp" class="tab-pane fade">

										<h1 id="toc_4">Express Checkout Integration</h1>

										<h2 id="toc_5">Pairing During Checkout</h2>

										<h3 id="toc_6">1. Call Request Token Service (2 times)</h3>

										<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account.</p>

										<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-c#">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
pairing_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
pairing_request_token = pairing_token_response.oauth_token;

request_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
request_token = request_token_response.oauth_token;
</code></pre></div>

										<h3 id="toc_7">2. Call Shopping Cart Service</h3>

										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional imageURL.</p>

										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-c#">//Create an instance of ShoppingCartRequest
ShoppingCartRequest shoppingCartRequest = new ShoppingCartRequest();
ShoppingCart shoppingCart = new ShoppingCart();
List&lt;ShoppingCartItem&gt; shoppingCartItems = new List&lt;ShoppingCartItem&gt;();
shoppingCartItems.Add(new ShoppingCartItem
{
    Value = 1900L,
    Description = "This is one item",
    Quantity = 1
});
shoppingCartItems.Add(new ShoppingCartItem
{
    ImageURL = "https://somemerchant.com/someimage",
    Value = 10000L,
    Description = "Five items",
    Quantity = 5
});

shoppingCart.Subtotal = 11900L;
shoppingCart.CurrencyCode = "USD";
shoppingCart.ShoppingCartItem = shoppingCartItems;

shoppingCartRequest.ShoppingCart = shoppingCart;
shoppingCartRequest.OAuthToken = request_token;

//Call the ShoppingCartService with required params
ShoppingCartResponse shoppingCartResponse = ShoppingCartApi.Create(shoppingCartRequest);</code></pre></div>

										<h3 id="toc_8">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = request_token
};

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_9">4. Invoke MasterPass UI (Lightbox) for checkout</h3>

										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.checkout({
        &quot;requestPairing&quot;:true,                                                      //required
        &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
        &quot;requestExpressCheckout&quot;: true,                                             //required
        &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
        &quot;version&quot;:&quot;v6&quot;,                                                             //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1.</li>
											<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set this property to true to request pairing for Express Checkout.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
										</ul>

										<h3 id="toc_10">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_11">On success</h4>

										<p>On success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6.</li>
											<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<h4 id="toc_12">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_13">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=cancel</code></pre></div>

										<h4 id="toc_14">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=failure</code></pre></div>

										<h3 id="toc_15">6. Call Access Token Service (2 times)</h3>

										<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction.</p>

										<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions.</p>

										<div><pre><code class="language-c#">AccessTokenResponse checkoutAccessTokenResponse = AccessTokenApi.Create(oauth_checkout_request_token, oauth_checkout_verifier_token);
string checkout_access_token = checkoutAccessTokenResponse.OauthToken;

AccessTokenResponse longAccessTokenResponse = AccessTokenApi.Create(oauth_pairing_request_token, oauth_pairing_verifier_token);
string long_access_token = longAccessTokenResponse.OauthToken; // store for future requests</code></pre></div>

										<h3 id="toc_16">7. Retrieve payment, shipping data, rewards and 3DS details</h3>

										<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer&#39;s payment, shipping, reward and 3-D Secure information from MasterPass.</p>

										<div><pre><code class="language-c#">string checkoutId = checkoutResourceUrl.IndexOf('?') != -1 ? checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1).Split('?')[0] : checkoutResourceUrl.Substring(checkoutResourceUrl.LastIndexOf('/') + 1);

Checkout checkout = CheckoutApi.Show(checkoutId, accessToken);

Card card = checkout.Card;
Address billingAddress = card.BillingAddress;
Contact contact = checkout.Contact;
AuthenticationOptions authOptions = checkout.AuthenticationOptions;
string preCheckoutTransactionId = checkout.PreCheckoutTransactionId;
RewardProgram rewardProgram = checkout.RewardProgram;
ShippingAddress shippingAddress = checkout.ShippingAddress;
string transactionId = checkout.TransactionId;
string walletId = checkout.WalletID;</code></pre></div>

										<h3 id="toc_17">8. Process payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_18">9. Log transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-c#">//Create an instance of MerchantTransactions
MerchantTransactions objMerchantTransactions = new MerchantTransactions();
List&lt;MerchantTransaction&gt; merchantTransactions = new List&lt;MerchantTransaction&gt;();
MerchantTransaction merchantTransaction = new MerchantTransaction
{
    TransactionId = "4549794", // from Step 7
    PurchaseDate = "2014-08-01T14:52:57.539-05:00",
    ExpressCheckoutIndicator = false,
    ApprovalCode = "888888",  // authorization code returned by payment gateway
    TransactionStatus = "Success",
    OrderAmount = 1229L, // total charged to card
    PreCheckoutTransactionId = "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
    Currency = "USD",
    ConsumerKey = "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d" //generated during onboarding process
};

merchantTransactions.Add(merchantTransaction);

objMerchantTransactions._MerchantTransactions = merchantTransactions;

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.Create(objMerchantTransactions);</code></pre></div>

										<h2 id="toc_19">Pairing without Checkout</h2>

										<h3 id="toc_20">1. Call Request Token Service</h3>

										<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-c#">string callback_url = "https://www.somemerchant.com/pairingcomplete.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string pairing_request_token = requestTokenResponse.OauthToken;</code></pre></div>

										<h3 id="toc_21">2. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1.</p>

										<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = pairing_request_token
};
//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);
</code></pre></div>

										<h3 id="toc_22">3. Invoke MasterPass UI (Lightbox) for pairing</h3>

										<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.connect({
        &quot;requestPairing&quot;:true,                                                  //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,              //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;,        //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                         //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
        &quot;requestExpressCheckout&quot;:true,                                          //required
        &quot;version&quot;:&quot;v6&quot;,                                                         //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                   //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set to true to indicate pairing for Express Checkout.</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_23">4. Redirect to callback URL or call callback function</h3>

										<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_24">Example Callback URL (Success)</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_25">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_26">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_27">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>

										<h3 id="toc_28">5. Call Access Token Service</h3>

										<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4.</p>

										<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>

										<div><pre><code class="language-java">AccessTokenResponse accessTokenResponse = AccessTokenApi.create(pairing_request_token, pairing_verifier_token);
String long_access_token = accessTokenResponse.getOauthToken(); // store for future requests</code></pre></div>

										<h2 id="toc_29">Express Checkout</h2>

										<h3 id="toc_30">1. Consumer logs onto merchant site</h3>

										<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>

										<h3 id="toc_31">2. Call PreCheckout Data Service</h3>

										<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout).</p>

										<div><pre><code class="language-c#">string[] requestedDataTypes = { "REWARD_PROGRAM", "ADDRESS", "PROFILE", "CARD" };

PrecheckoutDataRequest preCheckoutDataRequest = new PrecheckoutDataRequest();
List&lt;PairingDataType&gt; lstPairingDataType = new List&lt;PairingDataType&gt;();
//foreach (var item in requestedDataTypes)
//{
//    lstPairingDataType.Add(new PairingDataType
//    {
//        Type = item
//    });
//}
lstPairingDataType = requestedDataTypes.Select(item => new PairingDataType() { Type = item }).ToList();

preCheckoutDataRequest.PairingDataTypes.PairingDataType = lstPairingDataType;

PrecheckoutDataResponse response = PrecheckoutDataApi.Create(long_access_token, preCheckoutDataRequest);</code></pre></div>

										<h3 id="toc_32">3. Consumer makes card/shipping address selection</h3>

										<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used to get the checkout details.</p>

										<h3 id="toc_33">4. Display place order page</h3>

										<p>Show the place order button to the user.  Use the selected precheckout data as placeholders for order details.</p>

										<h3 id="toc_34">5. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>Call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected in Step 3 from MasterPass.</p>

										<div><pre><code class="language-c#">ExpressCheckoutRequest expressCheckoutRequest = new ExpressCheckoutRequest
{
    PrecheckoutTransactionId = "insert_precheckoutTransactionId_here",  // from precheckout data
    MerchantCheckoutId = "insert_checkoutId_here",
    OriginUrl = "http://www.somemerchant.com",
    CurrencyCode = "USD",
    AdvancedCheckoutOverride = false, // set to true to disable 3-DS authentication
    OrderAmount = "1299",
    DigitalGoods = false,
    CardId = "consumer_selected_cardId",
    ShippingAddressId = "consumer_selected_shippingAddressId",
    RewardProgramId = "consumer_selected_rewardId",
};
ExpressCheckoutResponse response = ExpressCheckoutApi.Create("insert_longAccessToken_here", expressCheckoutRequest);

Checkout checkout = response.Checkout;

Card card = checkout.Card;
Address billingAddress = card.BillingAddress;
Contact contact = checkout.Contact;
AuthenticationOptions authOptions = checkout.AuthenticationOptions;
string preCheckoutTransactionId = checkout.PreCheckoutTransactionId;
RewardProgram rewardProgram = checkout.RewardProgram;
ShippingAddress shippingAddress = checkout.ShippingAddress;
string transactionId = checkout.TransactionId;
string walletId = checkout.WalletID;</code></pre></div>

										<h3 id="toc_35">6. Handle 3-DS Authentication if needed</h3>

										<p>The <strong>Express Checkout Service</strong> may indicate that the consumer needs to pass 3-DS authentication before MasterPass can return the full credit card details.  This will be indicated with an error on the response.  See the section <strong>3-DS Security</strong> and then return to this step.</p>

										<h3 id="toc_36">7. Process Payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 5, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_37">8. Log Transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 7, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-c#">//Create an instance of MerchantTransactions
MerchantTransactions objMerchantTransactions = new MerchantTransactions();
List&lt;MerchantTransaction&gt; merchantTransactions = new List&lt;MerchantTransaction&gt;();
MerchantTransaction merchantTransaction = new MerchantTransaction
{
    TransactionId = "4549794", // from Step 7
    PurchaseDate = "2014-08-01T14:52:57.539-05:00",
    ExpressCheckoutIndicator = true, // mark this as true
    ApprovalCode = "888888",  // authorization code returned by payment gateway
    TransactionStatus = "Success",
    OrderAmount = 1229L, // total charged to card
    PreCheckoutTransactionId = "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
    Currency = "USD",
    ConsumerKey = "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d" //generated during onboarding process
};

merchantTransactions.Add(merchantTransaction);

objMerchantTransactions._MerchantTransactions = merchantTransactions;

//Call the PostbackService with required params
MerchantTransactions response = PostbackApi.Create(objMerchantTransactions);</code></pre></div>

										<h2 id="toc_38">3-DS Security</h2>

										<p>If the merchant has enabled 3-D Secure, the consumer will be required to provide additional authentication before MasterPass can return full credit card details. When this is the case, the <strong>Express Checkout Service</strong> (Step 6 of the Express Checkout flow) will return an error message indicating the need for 3-DS authentication. </p>

										<h3 id="toc_39">1. Determine if 3-DS Authentication is needed</h3>

										<p>Call the <strong>Express Checkout Service</strong> using your <em>long access token</em>. Check the response for an error that indicates 3-DS is needed.</p>

										<div><pre><code class="language-c#">ExpressCheckoutResponse response = ExpressCheckoutApi.Create("insert_longAccessToken_here", expressCheckoutRequest);

bool expressSecurityRequired = false;
if (response.Errors != null && response.Errors.Error.Count > 0)
{
    expressSecurityRequired = response.Errors.Error.Any(x => x.Source == "3DS Needed");
}</code></pre></div>

										<h3 id="toc_40">2. Call Request Token Service</h3>

										<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-c#">string callback_url = "https://www.somemerchant.com/checkoutconfirm.htm";
RequestTokenResponse requestTokenResponse = RequestTokenApi.Create(callback_url);
string request_token = requestTokenResponse.OauthToken;</code></pre></div>

										<h3 id="toc_41">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 2.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-c#">//Create an instance of MerchantInitializationRequest
MerchantInitializationRequest merchantInitializationRequest = new MerchantInitializationRequest
{
    OriginUrl = "https://somemerchant.com",
    OAuthToken = request_token
};

//Call the MerchantInitializationApi with required params
MerchantInitializationResponse merchantInitializationResponse = MerchantInitializationApi.Create(merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_42">4. Initialize the MasterPass Card Security lightbox</h3>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>

										<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>On the Place Order page of the merchant&#39;s website, launch the Card Securty lightbox interface.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;

MasterPass.client.cardSecurity({
    &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
    &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
    &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
    &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
    &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});

&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestToken:</strong> The request token generated in Step 2.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected from the precheckout data.</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_43">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes the security authentication, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_44">on Success</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass Card Security flow resulted in success, failure, or cancel.</li>
										</ul>

										<h4 id="toc_45">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=success</code></pre></div>

										<h4 id="toc_46">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=cancel</code></pre></div>

										<h4 id="toc_47">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm?mpstatus=failure</code></pre></div>

										<h4 id="toc_48">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.mpstatus);
}</code></pre></div>

										<h3 id="toc_49">6. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>If the authentication was completed successfully, call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected by the consumer from MasterPass.</p>

										<div><pre><code class="language-c#">ExpressCheckoutRequest expressCheckoutRequest = new ExpressCheckoutRequest
{
    PrecheckoutTransactionId = "insert_precheckoutTransactionId_here",  // from precheckout data
    MerchantCheckoutId = "insert_checkoutId_here",
    OriginUrl = "http://www.somemerchant.com",
    CurrencyCode = "USD",
    AdvancedCheckoutOverride = false, // set to true to disable 3-DS authentication
    OrderAmount = "1299",
    DigitalGoods = false,
    CardId = "consumer_selected_cardId",
    ShippingAddressId = "consumer_selected_shippingAddressId",
    RewardProgramId = "consumer_selected_rewardId",
};
ExpressCheckoutResponse response = ExpressCheckoutApi.Create("insert_longAccessToken_here", expressCheckoutRequest);

Checkout checkout = response.Checkout;

Card card = checkout.Card;
Address billingAddress = card.BillingAddress;
Contact contact = checkout.Contact;
AuthenticationOptions authOptions = checkout.AuthenticationOptions;
string preCheckoutTransactionId = checkout.PreCheckoutTransactionId;
RewardProgram rewardProgram = checkout.RewardProgram;
ShippingAddress shippingAddress = checkout.ShippingAddress;
string transactionId = checkout.TransactionId;
string walletId = checkout.WalletID;
</code></pre></div>
									</div>
									<!-- END C# EXPRESS CONTENT -->
									<div id="Eruby" class="tab-pane fade">

										<h1 id="toc_2">Express Checkout Integration</h1>

										<h2 id="toc_3">Pairing During Checkout</h2>

										<h3 id="toc_4">1. Call Request Token Service (2 times)</h3>

										<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account.</p>

										<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
pairing_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
pairing_request_token = pairing_token_response.oauth_token;

request_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
request_token = request_token_response.oauth_token;</code></pre></div>

										<h3 id="toc_5">2. Call Shopping Cart Service</h3>

										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>Each shopping_cart_item must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A shopping_cart_item may also have an optional image_url.</p>

										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-ruby">shopping_cart_request = MastercardMasterpassMerchant::ShoppingCartRequest.new(
    :o_auth_token => request_token,
    :shopping_cart => MastercardMasterpassMerchant::ShoppingCart.new(
        :currency_code => 'USD',
        :subtotal => '11900',
        :shopping_cart_item => [
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'One Item',
                :quantity => 1,
                :value => 1900
            ),
            MastercardMasterpassMerchant::ShoppingCartItem.new(
                :description => 'Five of an Item',
                :quantity => 5,
                :value => 10000,
                :image_url => 'http://somemerchant.com/someimage'
            )
        ]
    )
)

shopping_cart_response = MastercardMasterpassMerchant::Api::ShoppingCartApi.create(shopping_cart_request)</code></pre></div>

										<h3 id="toc_6">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>

										<h3 id="toc_7">4. Invoke MasterPass UI (Lightbox) for checkout</h3>

										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.checkout({
        &quot;requestPairing&quot;:true,                                                      //required
        &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
        &quot;requestExpressCheckout&quot;: true,                                             //required
        &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
        &quot;version&quot;:&quot;v6&quot;,                                                             //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1.</li>
											<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set this property to true to request pairing for Express Checkout.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
										</ul>

										<h3 id="toc_8">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_9">On success</h4>

										<p>On success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6.</li>
											<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<h4 id="toc_10">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_11">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_12">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>

										<h3 id="toc_13">6. Call Access Token Service (2 times)</h3>

										<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction.</p>

										<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions.</p>

										<div><pre><code class="language-ruby">access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(verifier_token, request_token)
access_token = access_token_response.oauth_token

long_access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(pairing_verifier_token, pairing_request_token)
long_access_token = long_access_token_response.oauth_token</code></pre></div>

										<h3 id="toc_14">7. Retrieve payment, shipping data, rewards and 3DS details</h3>

										<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer&#39;s payment, shipping, reward and 3-D Secure information from MasterPass.</p>

										<div><pre><code class="language-ruby">start_index = checkout_resource_url.rindex('/') + 1
end_index = checkout_resource_url.index('?').nil? ? -1 : checkout_resource_url.index('?')
path_id = checkout_resource_url[start_index..end_index]

checkout = MastercardMasterpassMerchant::Api::CheckoutApi.show(path_id, access_token)
card = checkout.card
billing_address = card.billing_address
contact = checkout.contact
auth_options = checkout.authentication_options
precheckout_transaction_id = checkout.pre_checkout_transaction_id
reward_program = checkout.reward_program
shipping_address = checkout.shipping_address
transaction_id = checkout.transaction_id
wallet_id = checkout.wallet_id</code></pre></div>

										<h3 id="toc_15">8. Process payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_16">9. Log transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-ruby">merchant_transactions = MastercardMasterpassMerchant::MerchantTransactions.new(
    :merchant_transactions => [
        MastercardMasterpassMerchant::MerchantTransaction.new(
            :transaction_id => 4549794,
            :consumer_key => '0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d',
            :currency => 'USD',
            :order_amount => 1800,
            :transaction_status => 'Success',
            :approval_code => '888888',
            :pre_checkout_transaction_id => 'a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947',
            :express_checkout_indicator => false,
            :purchase_date => '2016-06-23T15:09:32+00:00'
        )
    ]
)

merchant_trans_response = MastercardMasterpassMerchant::Api::PostbackApi.create(merchant_transactions)</code></pre></div>

										<h2 id="toc_17">Pairing without Checkout</h2>

										<h3 id="toc_18">1. Call Request Token Service</h3>

										<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callback_url that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
pairing_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
pairing_request_token = pairing_token_response.oauth_token;</code></pre></div>

										<h3 id="toc_19">2. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1.</p>

										<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => pairing_request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>

										<h3 id="toc_20">3. Invoke MasterPass UI (Lightbox) for pairing</h3>

										<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.connect({
        &quot;requestPairing&quot;:true,                                                  //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,              //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;,        //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                         //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
        &quot;requestExpressCheckout&quot;:true,                                          //required
        &quot;version&quot;:&quot;v6&quot;,                                                         //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                   //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set to true to indicate pairing for Express Checkout.</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_21">4. Redirect to callback URL or call callback function</h3>

										<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_22">Example Callback URL (Success)</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_23">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_24">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_25">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>

										<h3 id="toc_26">5. Call Access Token Service</h3>

										<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4.</p>

										<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>

										<div><pre><code class="language-ruby">long_access_token_response = MastercardCoreSdk::Api::AccessTokenApi.create(pairing_verifier_token, pairing_request_token)
long_access_token = long_access_token_response.oauth_token</code></pre></div>

										<h2 id="toc_27">Express Checkout</h2>

										<h3 id="toc_28">1. Consumer logs onto merchant site</h3>

										<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>

										<h3 id="toc_29">2. Call PreCheckout Data Service</h3>

										<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout).</p>

										<div><pre><code class="language-ruby">requested_data_types = ['REWARD_PROGRAM', 'ADDRESS', 'PROFILE', 'CARD']
pairing_data_types = []
requested_data_types.each do |data_type|
  pairing_data_type = MastercardMasterpassMerchant::PairingDataType.new
  pairing_data_type.type = data_type
  pairing_data_types.append(pairing_data_type)
end

pre_checkout_data_request = MastercardMasterpassMerchant::PrecheckoutDataRequest.new(
    :pairing_data_types => MastercardMasterpassMerchant::PairingDataTypes.new(
        :pairing_data_type => pairing_data_types
    )
)

response = MastercardMasterpassMerchant::Api::PrecheckoutDataApi.create(long_access_token, pre_checkout_data_request)</code></pre></div>

										<h3 id="toc_30">3. Consumer makes card/shipping address selection</h3>

										<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used to get the checkout details.</p>

										<h3 id="toc_31">4. Display place order page</h3>

										<p>Show the place order button to the user.  Use the selected precheckout data as placeholders for order details.</p>

										<h3 id="toc_32">5. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>Call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected in Step 3 from MasterPass.</p>

										<div><pre><code class="language-ruby">express_checkout_request = MastercardMasterpassMerchant::ExpressCheckoutRequest.new(
    :merchant_checkout_id => 'insert_checkoutId_here',
    :precheckout_transaction_id => 'insert_precheckoutTransactionId_here',
    :currency_code => 'USD',
    :order_amount => 1299,
    :card_id => 'consumer_selected_cardId',
    :digital_goods => false,
    :shipping_address_id => 'consumer_selected_shippingAddressId',
    :reward_program_id => 'consumer_selected_rewardId',
    :advanced_checkout_override => false,
    :origin_url => 'http://somemerchant.com'
)

express_checkout_response = MastercardMasterpassMerchant::Api::ExpressCheckoutApi.create(long_access_token, express_checkout_request)
checkout = express_checkout_response.checkout
card = checkout.card
billing_address = card.billing_address
contact = checkout.contact
auth_options = checkout.authentication_options
precheckout_transaction_id = checkout.pre_checkout_transaction_id
reward_program = checkout.reward_program
shipping_address = checkout.shipping_address
transaction_id = checkout.transaction_id
wallet_id = checkout.wallet_id
</code></pre></div>

										<h3 id="toc_33">6. Handle 3-DS Authentication if needed</h3>

										<p>The <strong>Express Checkout Service</strong> may indicate that the consumer needs to pass 3-DS authentication before MasterPass can return the full credit card details.  This will be indicated with an error on the response.  See the section <strong>3-DS Security</strong> and then return to this step.</p>

										<h3 id="toc_34">7. Process Payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 5, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_35">8. Log Transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 7, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-ruby">merchant_transactions = MastercardMasterpassMerchant::MerchantTransactions.new(
    :merchant_transactions => [
        MastercardMasterpassMerchant::MerchantTransaction.new(
            :transaction_id => 4549794,
            :consumer_key => '0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d',
            :currency => 'USD',
            :order_amount => 1800,
            :transaction_status => 'Success',
            :approval_code => '888888',
            :pre_checkout_transaction_id => 'a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947',
            :express_checkout_indicator => false,
            :purchase_date => '2016-06-23T15:09:32+00:00'
        )
    ]
)

merchant_trans_response = MastercardMasterpassMerchant::Api::PostbackApi.create(merchant_transactions)</code></pre></div>

										<h2 id="toc_36">3-DS Security</h2>

										<p>If the merchant has enabled 3-D Secure, the consumer will be required to provide additional authentication before MasterPass can return full credit card details. When this is the case, the <strong>Express Checkout Service</strong> (Step 6 of the Express Checkout flow) will return an error message indicating the need for 3-DS authentication. </p>

										<h3 id="toc_37">1. Determine if 3-DS Authentication is needed</h3>

										<p>Call the <strong>Express Checkout Service</strong> using your <em>long access token</em>. Check the response for an error that indicates 3-DS is needed.</p>

										<div><pre><code class="language-ruby">if !merchant_trans_response.errors.nil? && merchant_trans_response.errors.error.size > 0
  merchant_trans_response.errors.error.each do |error|
    if error.source == '3DS Needed'
        express_security_required = true
    end
  end
end</code></pre></div>

										<h3 id="toc_38">2. Call Request Token Service</h3>

										<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-ruby">callback_url = "https://www.somemerchant.com/checkoutconfirm.htm"
request_token_response = MastercardCoreSdk::Api::RequestTokenApi.create(callback_url)
request_token = request_token_response.oauth_token;</code></pre></div>

										<h3 id="toc_39">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The originUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 2.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-ruby">merchant_init_request = MastercardMasterpassMerchant::MerchantInitializationRequest.new(
    :o_auth_token => request_token,
    :origin_url => 'https://somemerchant.com'
)

merchant_init_response = MastercardMasterpassMerchant::Api::MerchantInitializationApi.create(merchant_init_request)</code></pre></div>

										<h3 id="toc_40">4. Initialize the MasterPass Card Security lightbox</h3>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>

										<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>On the Place Order page of the merchant&#39;s website, launch the Card Securty lightbox interface.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;

MasterPass.client.cardSecurity({
    &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
    &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
    &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
    &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
    &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});

&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestToken:</strong> The request token generated in Step 2.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected from the precheckout data.</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_41">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes the security authentication, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_42">On Success</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass Card Security flow resulted in success, failure, or cancel.</li>
										</ul>

										<h4 id="toc_43">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success</code></pre></div>

										<h4 id="toc_44">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_45">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_46">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.mpstatus);
}</code></pre></div>

										<h3 id="toc_47">6. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>If the authentication was completed successfully, call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected by the consumer from MasterPass.</p>

										<div><pre><code class="language-ruby">express_checkout_request = MastercardMasterpassMerchant::ExpressCheckoutRequest.new(
    :merchant_checkout_id => 'insert_checkoutId_here',
    :precheckout_transaction_id => 'insert_precheckoutTransactionId_here',
    :currency_code => 'USD',
    :order_amount => 1299,
    :card_id => 'consumer_selected_cardId',
    :digital_goods => false,
    :shipping_address_id => 'consumer_selected_shippingAddressId',
    :reward_program_id => 'consumer_selected_rewardId',
    :advanced_checkout_override => false,
    :origin_url => 'http://somemerchant.com'
)

express_checkout_response = MastercardMasterpassMerchant::Api::ExpressCheckoutApi.create(long_access_token, express_checkout_request)
checkout = express_checkout_response.checkout
card = checkout.card
billing_address = card.billing_address
contact = checkout.contact
auth_options = checkout.authentication_options
precheckout_transaction_id = checkout.pre_checkout_transaction_id
reward_program = checkout.reward_program
shipping_address = checkout.shipping_address
transaction_id = checkout.transaction_id
wallet_id = checkout.wallet_id
</code></pre></div>
									</div>
									<!--BEGIN PHP EXPRESS -->
									<div id="Ephp" class="tab-pane fade">
										<h1 id="toc_2">Express Checkout Integration</h1>

										<h2 id="toc_3">Pairing During Checkout</h2>

										<h3 id="toc_4">1. Call Request Token Service (2 times)</h3>

										<p>Call the <strong>Request Token Service</strong> twice. The first call generates a <em>pairing request token</em>, which will be used to gain the <em>long access token</em> needed to pair the consumer&#39;s wallet and merchant account.</p>

										<p>The second call generates a <em>checkout request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callbackUrl that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> calls must be made before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/checkoutconfirm.htm";

$pairingResponse = RequestTokenApi::create($callbackUrl);
$pairingRequestToken = $pairingResponse->getOauthToken();

$checkoutResponse = RequestTokenApi::create($callbackUrl);
$checkoutRequestToken = $checkoutResponse::getOauthToken();</code></pre></div>

										<h3 id="toc_5">2. Call Shopping Cart Service</h3>

										<p>The <strong>Shopping Cart Service</strong> enables shopping cart data to be displayed to users as they proceed through the MasterPass login and checkout. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>Each ShoppingCartItem must have a description, quantity, and value. Value is represented as an integer (for example, USD 100.00 is 10000), and is calculated as the cost of a single item multiplied by the quantity of that item. A ShoppingCartItem may also have an optional ImageURL.</p>

										<p>The <strong>Shopping Cart Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-php">//Build Out ShoppingCartRequest object
$shoppingCartItem1 = new ShoppingCartItem(
	array(
		"Value" => 700,
		"Description" => "This is one item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someimage"
	)
);

$shoppingCartItem2 = new ShoppingCartItem(
	array(
		"Value" => 300,
		"Description" => "This is another item",
		"Quantity" => 1,
		"ImageURL" => "https://somemerchant.com/someotherimage"
	)
);

$shoppingCart = new ShoppingCart(
	array(
		"CurrencyCode" => "USD",
		"Subtotal" => 1000,
		"ShoppingCartItem" => array($shoppingCartItem1, $shoppingCartItem2)
	)
);

$shoppingCartRequest = new ShoppingCartRequest(
	array(
		"OAuthToken" => $requestToken,
		"OriginUrl" => $callbackDomain,
		"ShoppingCart" => $shoppingCart,
	)
);

//Call the ShoppingCartService with required params
$shoppingCartResponse = ShoppingCartApi::create($shoppingCartRequest);</code></pre></div>

										<h3 id="toc_6">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant and MasterPass. The OriginUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>checkout request token</em> from Step 1.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before the consumer clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $checkoutRequestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_7">4. Invoke MasterPass UI (Lightbox) for checkout</h3>

										<p>On the <strong>Checkout Page</strong> of the merchant&#39;s website, add the <strong>Buy with MasterPass</strong> button to your HTML (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mcpp_wllt_btn_chk_147x034px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
  &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.checkout({
        &quot;requestPairing&quot;:true,                                                      //required
        &quot;requestToken&quot;:&quot;insert_checkout_request_token_here&quot;,                        //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,                  //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;,           //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                             //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],      //required
        &quot;requestExpressCheckout&quot;: true,                                             //required
        &quot;allowedCardTypes&quot;:[&quot;master&quot;,&quot;amex&quot;,&quot;diners&quot;,&quot;discover&quot;,&quot;maestro&quot;,&quot;visa&quot;],  //optional
        &quot;version&quot;:&quot;v6&quot;,                                                             //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                     //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                       //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>requestToken:</strong> The <em>checkout request token</em> generated in Step 1.</li>
											<li><strong>pairingRequestToken:</strong> The <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the merchant onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set this property to true to request pairing for Express Checkout.</li>
											<li><strong>allowedCardTypes:</strong> Card types accepted by the merchant (default is all card types).</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass Lightbox flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass Lightbox flow.</li>
										</ul>

										<h3 id="toc_8">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes checkout, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_9">On success</h4>

										<p>On success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>checkout_resource_url:</strong> The API URL that will be used to retrieve checkout information in Step 7.</li>
											<li><strong>oauth_verifier:</strong> The <em>checkout verifier token</em> that is used  to retrieve the <em>access token</em> in Step 6.</li>
											<li><strong>oauth_token:</strong> The <em>checkout request token</em> that is used  to retrieve the <em>access token</em> in Step 6. This token has the same value as the <em>checkout request token</em> that is generated in Step 1.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<h4 id="toc_10">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success
&amp;checkout_resource_url=https%3A%2F%2Fstage.api.mastercard.com%2Fmasterpass%2Fv6%2Fcheckout%2F
10706241%3Fwallet%3Dphw
&amp;oauth_verifier=fbe45bcad30299c93765b1fb4b45bab208f84458
&amp;oauth_token=d9382e34e0721a68a9952110cecdf89517e45498
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_11">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_12">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>

										<h3 id="toc_13">6. Call Access Token Service (2 times)</h3>

										<p>If the checkout was completed successfully, the next step is to make two <strong>Access Token Service</strong> calls. The first call uses the <em>checkout request token</em> and the <em>checkout verifier token</em> from Step 5 to retrieve a <em>checkout access token</em>. This <em>checkout access token</em> will be used in the next step to retrieve checkout data from the current transaction.</p>

										<p>The second call uses the <em>pairing request token</em> and the <em>pairing verifier token</em> from Step 5 to retrieve a <em>long access token</em>. The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in future transactions.</p>

										<div><pre><code class="language-php">$checkoutAccessTokenResponse = AccessTokenApi::create(oauthCheckoutRequestToken, oauthCheckoutVerifierToken);
$checkoutAccessToken = checkoutAccessTokenResponse->getOauthToken();

$longAccessTokenResponse = AccessTokenApi::create(oauthPairingRequestToken, oauthPairingVerifierToken);
$longAccessToken = longAccessTokenResponse->getOauthToken(); // store for future requests</code></pre></div>

										<h3 id="toc_14">7. Retrieve payment, shipping data, rewards and 3DS details</h3>

										<p>Use the <em>checkout resource URL</em> received in Step 5 and the <em>checkout access token</em> from Step 6 to retrieve the consumer&#39;s payment, shipping, reward and 3-D Secure information from MasterPass.</p>

										<div><pre><code class="language-php">$explodedURL = explode("/", $checkoutResourceUrl);
$checkoutId = array_pop($explodedURL);
if(strpos($checkoutId, "?") !== false){
	$checkoutId = explode($checkoutId, "?")[0];
}

$logger->info($checkoutId);

$checkout = CheckoutApi::show($checkoutId, $accessToken);

$card = $checkout->getCard();
$billingAddress = $card->getBillingAddress();
$contact = $checkout->getContact();
$authOptions = checkout->getAuthenticationOptions(); 
$preCheckoutTransactionId = checkout->getPreCheckoutTransactionId(); 
$rewardProgram = checkout->getRewardProgram(); 
$shippingAddress = checkout->getShippingAddress();
$transactionId = checkout->getTransactionId();
$walletId = checkout->getWalletID();</code></pre></div>

										<h3 id="toc_15">8. Process payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 7, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_16">9. Log transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 8, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-php">//Create an instance of MerchantTransactions
$merchantTransaction = new MerchantTransaction(
	array(
		"TransactionId" => "4549794",
		"ConsumerKey" => "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d", //generated during onboarding process
		"Currency" => "USD",
		"OrderAmount" => 500, // total charged to card
		"TransactionStatus" => "Success",
		"ApprovalCode" => "888888", // authorization code returned by payment gateway
		"PrecheckoutTransactionId" => "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
		"ExpressCheckoutIndicator" => false,
		"PurchaseDate" => date("Y/m/d H:i:s")
	)
);
$request = new MerchantTransactions(array("MerchantTransactions" => array($merchantTransaction)));

//Call the PostbackService with required params
$response = PostbackApi::create($request);</code></pre></div>

										<h2 id="toc_17">Pairing without Checkout</h2>

										<h3 id="toc_18">1. Call Request Token Service</h3>

										<p>Call the <strong>Request Token Service</strong> to generate the <em>pairing request token</em> that will be used to invoke the MasterPass Lightbox. Pass a callbackUrl that the browser will redirect to when the Lightbox closes.</p>

										<p>The <strong>Request Token Service</strong> must be called before the consumer clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/pairingcomplete.htm";
$requestTokenResponse = RequestTokenApi::create($callbackUrl);
$pairingRequestToken = $requestTokenResponse->getOauthToken();</code></pre></div>

										<h3 id="toc_19">2. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The OriginUrl identifies the origin of the page that will initialize the Lightbox. This service requires the <em>pairing request token</em> from Step 1.</p>

										<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $pairingRequestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_20">3. Invoke MasterPass UI (Lightbox) for pairing</h3>

										<p>Add the <strong>Connect with MasterPass</strong> button to the merchant site (for example, on the user account page) (see <a href="http://todo.com">MasterPass Branding</a> to customize size and locale).</p>

										<div><pre><code class="language-markup">&lt;img src=&quot;https://www.mastercard.com/mc_us/wallet/img/en/US/mp_connect_with_button_126px.png&quot;/&gt;</code></pre></div>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment.</p>

										<div><pre><code class="language-markup">&lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>Invoke the MasterPass lightbox when the user clicks the <strong>Connect with MasterPass</strong> button.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;
    MasterPass.client.connect({
        &quot;requestPairing&quot;:true,                                                  //required
        &quot;pairingRequestToken&quot;:&quot;insert_pairing_request_token_here&quot;,              //required
        &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/pairingcomplete.htm&quot;,        //required
        &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                         //required
        &quot;requestedDataTypes&quot;:[&quot;REWARD_PROGRAM&quot;, &quot;ADDRESS&quot;, &quot;PROFILE&quot;, &quot;CARD&quot;],  //required
        &quot;requestExpressCheckout&quot;:true,                                          //required
        &quot;version&quot;:&quot;v6&quot;,                                                         //optional
        &quot;successCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },                 //optional
        &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }                   //optional
    });
&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestPairing:</strong> To enable pairing, value must be true.</li>
											<li><strong>pairingRequestToken:</strong> Your <em>pairing request token</em> generated in Step 1.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>requestedDataTypes:</strong> The data types the merchant requests for pairing. PROFILE and CARD are required.</li>
											<li><strong>requestExpressCheckout:</strong> Set to true to indicate pairing for Express Checkout.</li>
											<li><strong>version:</strong> MasterPass API version (default is v6).</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_21">4. Redirect to callback URL or call callback function</h3>

										<p>After the lightbox closes, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirect to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_22">Example Callback URL (Success)</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass flow resulted in success, failure, or cancel.</li>
											<li><strong>pairing_verifier:</strong> The <em>pairing verifier token</em> that is used to retrieve the <em>long access token</em> in Step 6.</li>
											<li><strong>pairing_token:</strong> The <em>pairing request token</em> used to retrieve the <em>long access token</em> in Step 6.</li>
										</ul>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=success
&amp;pairing_verifier=6c50838e31b7441e6eafa2229385452889255b13
&amp;pairing_token=35b2a0cf87f8160fcb5d24996a12edb7cce4c530</code></pre></div>

										<h4 id="toc_23">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_24">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/pairingcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_25">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    document.getElementById(&#39;pairingToken&#39;).value=data.pairing_token;
    document.getElementById(&#39;pairingVerifer&#39;).value=data.pairing_verifier;
}</code></pre></div>

										<h3 id="toc_26">5. Call Access Token Service</h3>

										<p>If the pairing was completed successfully, call the <strong>Access Token Service</strong> to retrieve a <em>long access token</em>. You will need the <em>pairing request token</em> and the <em>pairing verifier token</em> received in Step 4.</p>

										<p>The <em>long access token</em> will be used to retrieve pre-checkout data for this consumer in the future. Store the <em>long access token</em> with this user&#39;s merchant account data so that it can be retrieved anytime the user logs into the merchant site.</p>

										<div><pre><code class="language-php">$accessTokenResponse = AccessTokenApi::create($pairingRequestToken, $pairingVerifierToken);
$longAccessToken = $accessTokenResponse->getOauthToken(); // store for future requests</code></pre></div>

										<h2 id="toc_27">Express Checkout</h2>

										<h3 id="toc_28">1. Consumer logs onto merchant site</h3>

										<p>A consumer&#39;s <em>long access token</em> should have been stored with their account data for the merchant&#39;s site. When the consumer logs into their merchant site account, get their <em>long access token</em>.</p>

										<h3 id="toc_29">2. Call PreCheckout Data Service</h3>

										<p>Use the consumer&#39;s <em>long access token</em> to retrieve pre-checkout data. The data types returned will be the types that were requested via the requestedDataTypes parameter when the Lightbox was invoked (Step 4 of Pairing During Checkout or Step 3 of Pairing Without Checkout).</p>

										<div><pre><code class="language-php">$requestedDataTypes = array("REWARD_PROGRAM", "ADDRESS", "PROFILE", "CARD");

$preCheckoutDataRequest = new PreCheckoutDataRequest();
$pairingDataTypes = new PairingDataTypes();

foreach ($requestedDataTypes as $pairingType){
	$newPairingType = new PairingDataType(
		array(
			"Type" => $pairingType
		)
	);
	$pairingDataTypes->setPairingDataType = $newPairingType;
}

$preCheckoutDataRequest->setPairingDataTypes($pairingDataTypes);

$preCheckoutDataResponse = PrecheckoutDataApi::create($longAccessToken, $preCheckoutDataRequest);</code></pre></div>

										<h3 id="toc_30">3. Consumer makes card/shipping address selection</h3>

										<p>Display the wallet data retrieved in Step 2 to the consumer, and prompt the consumer to select from it. Save the selected <em>cardId</em>, <em>shippingId</em>, and (if applicable) <em>rewardId</em> to be used to get the checkout details.</p>

										<h3 id="toc_31">4. Display place order page</h3>

										<p>Show the place order button to the user.  Use the selected precheckout data as placeholders for order details.</p>

										<h3 id="toc_32">5. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>Call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected in Step 3 from MasterPass.</p>

										<div><pre><code class="language-php">$expressCheckoutRequest = new ExpressCheckoutRequest();

$expressCheckoutRequest->setMerchantCheckoutId("insert_checkoutId_here");
$expressCheckoutRequest->setPrecheckoutTransactionId("insert_precheckoutTransactionId_here"); // from precheckout data
$expressCheckoutRequest->setCurrencyCode("USD");
$expressCheckoutRequest->setCardId("consumer_selected_cardId");
$expressCheckoutRequest->setOriginUrl("http://www.somemerchant.com");
$expressCheckoutRequest->setAdvancedCheckoutOverride(false);
$expressCheckoutRequest->setOrderAmount("1299");
$expressCheckoutRequest->setDigitalGoods(false);
$expressCheckoutRequest->setShippingAddressId("consumer_selected_shippingAddressId");
$expressCheckoutRequest->setRewardProgramId("consumer_selected_rewardId");

$response = ExpressCheckoutApi::create("insert_longAccessToken_here", $expressCheckoutRequest);

$checkout = response->getCheckout();

$card = $checkout->getCard();
$billingAddress = $card->getBillingAddress();
$contact = $checkout->getContact();
$authOptions = checkout->getAuthenticationOptions(); 
$preCheckoutTransactionId = checkout->getPreCheckoutTransactionId(); 
$rewardProgram = checkout->getRewardProgram(); 
$shippingAddress = checkout->getShippingAddress();
$transactionId = checkout->getTransactionId();
$walletId = checkout->getWalletID();
</code></pre></div>

										<h3 id="toc_33">6. Handle 3-DS Authentication if needed</h3>

										<p>The <strong>Express Checkout Service</strong> may indicate that the consumer needs to pass 3-DS authentication before MasterPass can return the full credit card details.  This will be indicated with an error on the response.  See the section <strong>3-DS Security</strong> and then return to this step.</p>

										<h3 id="toc_34">7. Process Payment through a payment gateway</h3>

										<p>Using the data retrieved in Step 5, process the payment through the merchant&#39;s payment gateway.</p>

										<h3 id="toc_35">8. Log Transactions with MasterPass</h3>

										<p>After the payment has been processed in Step 7, make a service call to communicate the result of the transaction to MasterPass.</p>

										<div><pre><code class="language-php">//Create an instance of MerchantTransactions
$merchantTransaction = new MerchantTransaction(
	array(
		"TransactionId" => "4549794",
		"ConsumerKey" => "0zMKpm0nFtUv8lLXT97jDRo2bp4vNF8MFYyt3R5R87e3f3f4!414b48675861677159682b563745776b593652377939673d", //generated during onboarding process
		"Currency" => "USD",
		"OrderAmount" => 500, // total charged to card
		"TransactionStatus" => "Success",
		"ApprovalCode" => "888888", // authorization code returned by payment gateway
		"PrecheckoutTransactionId" => "a4a6x55-rgb1c5-hyaqkemj-1-hybxhplo-947",
		"ExpressCheckoutIndicator" => false,
		"PurchaseDate" => date("Y/m/d H:i:s")
	)
);
$request = new MerchantTransactions(array("MerchantTransactions" => array($merchantTransaction)));

//Call the PostbackService with required params
$response = PostbackApi::create($request);</code></pre></div>

										<h2 id="toc_36">3-DS Security</h2>

										<p>If the merchant has enabled 3-D Secure, the consumer will be required to provide additional authentication before MasterPass can return full credit card details. When this is the case, the <strong>Express Checkout Service</strong> (Step 6 of the Express Checkout flow) will return an error message indicating the need for 3-DS authentication. </p>

										<h3 id="toc_37">1. Determine if 3-DS Authentication is needed</h3>

										<p>Call the <strong>Express Checkout Service</strong> using your <em>long access token</em>. Check the response for an error that indicates 3-DS is needed.</p>

										<div><pre><code class="language-php">$response = ExpressCheckoutApi::create("insert_longAccessToken_here", $expressCheckoutRequest);

$expressSecurityRequired = false;

foreach ($response->getErrors()->getError() as $error) {
	if (error->getSource() === "3DS Needed") {
		$expressSecurityRequired = true;
	}
}</code></pre></div>

										<h3 id="toc_38">2. Call Request Token Service</h3>

										<p>The <strong>Request Token Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-php">$callbackUrl = "https://www.somemerchant.com/checkoutconfirm.htm";
$requestTokenResponse = RequestTokenApi::create($callbackUrl);
$requestToken = $requestTokenResponse->getOauthToken();</code></pre></div>

										<h3 id="toc_39">3. Call Merchant Initialization Service</h3>

										<p>The <strong>Merchant Initialization Service</strong> is used to secure Lightbox connections between the merchant site and MasterPass. The OriginUrl identifies the origin of the page that will invoke the Lightbox. This service requires the <em>request token</em> from Step 2.</p>

										<p>The <strong>Merchant Initialization Service</strong> must be called before creating the <strong>Buy with MasterPass</strong> button.</p>

										<div><pre><code class="language-php">//Create an instance of MerchantInitializationRequest
$merchantInitializationRequest = new MerchantInitializationRequest(
	array(
		"OriginUrl" => "https://somemerchant.com",
		"OAuthToken" => $requestToken
	)
);

//Call the MerchantInitializationApi with required params
$merchantInitializationResponse = MerchantInitializationApi::create($merchantInitializationRequest);</code></pre></div>

										<h3 id="toc_40">4. Initialize the MasterPass Card Security lightbox</h3>

										<p>Import jQuery, and add the MasterPass Integration Script for either the sandbox or the production environment</p>

										<div><pre><code class="language-markup"> &lt;!-- url to jquery 1.10.2 --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;https://ajax.googleapis.com/ajax/libs/
jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- url to sandbox MasterPass Lightbox --&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot; https://sandbox.masterpass.com/
lightbox/Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt;

&lt;!-- url to production MasterPass Lightbox --&gt;
 &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot; https://masterpass.com/lightbox/
Switch/integration/MasterPass.client.js &quot;&gt;&lt;/script&gt; --&gt;</code></pre></div>

										<p>On the Place Order page of the merchant&#39;s website, launch the Card Securty lightbox interface.</p>

										<div><pre><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; language=&quot;Javascript&quot;&gt;

MasterPass.client.cardSecurity({
    &quot;requestToken&quot;:&quot;insert_request_token_here&quot;,                       //required
    &quot;callbackUrl&quot;:&quot;http://www.somemerchant.com/checkoutcomplete.htm&quot;, //required
    &quot;merchantCheckoutId&quot;:&quot;insert_checkout_id_here&quot;,                   //required
    &quot;precheckoutTransactionId&quot;:&quot;insert_prechechout_txn_id_here&quot;,      //required
    &quot;successCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;failureCallback&quot;: function(mpLightboxResponse){ ... },           //optional
    &quot;cancelCallback&quot;: function(mpLightboxResponse){ ... }             //optional
});

&lt;/script&gt;</code></pre></div>

										<ul>
											<li><strong>requestToken:</strong> The request token generated in Step 2.</li>
											<li><strong>callbackUrl:</strong> The merchant URL to which the browser will redirect when the Lightbox closes.</li>
											<li><strong>merchantCheckoutId:</strong> The unique checkout identifier obtained during the Merchant Onboarding process.</li>
											<li><strong>precheckoutTransactionId:</strong> The pre-checkout transaction identifier collected from the precheckout data.</li>
											<li><strong>successCallback:</strong> The function that will be called if the MasterPass flow ends successfully.</li>
											<li><strong>failureCallback:</strong> The function that will be called if the MasterPass flow ends in failure.</li>
											<li><strong>cancelCallback:</strong> The function that will be called if the user cancels the MasterPass flow.</li>
										</ul>

										<h3 id="toc_41">5. Redirect to callback URL or call callback function</h3>

										<p>After the consumer completes the security authentication, MasterPass returns data to the merchant. By default, MasterPass redirects the browser to the callback URL, returning the data via URL parameters. Optionally, if callback functions were provided in Step 4, MasterPass returns control to the page that initiated the Lightbox, and the data is passed to the callback function.</p>

										<p>Under certain conditions, the MasterPass UI may be forced to run in Full Screen display instead of launching the Lightbox. When this occurs, the browser will redirected to the callback URL when the MasterPass flow is complete, even if callback functions were supplied.</p>

										<h4 id="toc_42">On Success</h4>

										<p>On Success, MasterPass returns the following parameters:</p>

										<ul>
											<li><strong>mpstatus:</strong> String that indicates whether the MasterPass Card Security flow resulted in success, failure, or cancel.</li>
										</ul>

										<h4 id="toc_43">Example Callback URL (Success)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=success</code></pre></div>

										<h4 id="toc_44">Example Callback URL (Cancel)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=cancel</code></pre></div>

										<h4 id="toc_45">Example Callback URL (Failure)</h4>

										<div><pre><code class="language-none">http://www.somemerchant.com/checkoutcomplete.htm
?mpstatus=failure</code></pre></div>

										<h4 id="toc_46">Example Callback Function (Success)</h4>

										<div><pre><code class="language-javascript">function handleCallbackSuccess (data) {
    callYourServerWith(data.mpstatus);
}</code></pre></div>

										<h3 id="toc_47">6. Retrieve Payment, Shipping Data, Rewards and 3-D Secure Details</h3>

										<p>If the authentication was completed successfully, call the <strong>Express Checkout Service</strong> to retrieve the full details of the customer&#39;s payment, shipping, and reward information selected by the consumer from MasterPass.</p>

										<div><pre><code class="language-php">$expressCheckoutRequest = new ExpressCheckoutRequest();

$expressCheckoutRequest->setMerchantCheckoutId("insert_checkoutId_here");
$expressCheckoutRequest->setPrecheckoutTransactionId("insert_precheckoutTransactionId_here"); // from precheckout data
$expressCheckoutRequest->setCurrencyCode("USD");
$expressCheckoutRequest->setCardId("consumer_selected_cardId");
$expressCheckoutRequest->setOriginUrl("http://www.somemerchant.com");
$expressCheckoutRequest->setAdvancedCheckoutOverride(false);
$expressCheckoutRequest->setOrderAmount("1299");
$expressCheckoutRequest->setDigitalGoods(false);
$expressCheckoutRequest->setShippingAddressId("consumer_selected_shippingAddressId");
$expressCheckoutRequest->setRewardProgramId("consumer_selected_rewardId");

$response = ExpressCheckoutApi::create("insert_longAccessToken_here", $expressCheckoutRequest);

$checkout = response->getCheckout();

$card = $checkout->getCard();
$billingAddress = $card->getBillingAddress();
$contact = $checkout->getContact();
$authOptions = checkout->getAuthenticationOptions(); 
$preCheckoutTransactionId = checkout->getPreCheckoutTransactionId(); 
$rewardProgram = checkout->getRewardProgram(); 
$shippingAddress = checkout->getShippingAddress();
$transactionId = checkout->getTransactionId();
$walletId = checkout->getWalletID();
</code></pre></div>
									</div>
									<!--END PHP EXPRESS -->
								</div>
							</div>
							<!-- END SERVER SIDE EXPRESS CHECKOUT -->

							<!-- BEGIN MOBILE APP -->
							<div class="tab-pane" id="mobileapp">
								<h1>Mobile App Implementation</h1>
								<p>The MasterPass Merchant Mobile Checkout Libraries/SDK enables developers to quickly implement native, app-to-app checkout experiences with EMV-like security</p>

								<h2>Android</h2>
								<p>The following content is currently applicable to US merchants with Android smartphone applications only.
								Information and Documentation for the MasterPass Merchant Android SDK is <a href="https://developer.mastercard.com/portal/display/api/MasterPass+-+Merchant+Android+SDK">available here</a></p>

								<h2>iOS</h2>
								<p>The MasterPass Merchant iOS SDK is coming soon.</p>
							</div>
							<!-- END MOBILE APP -->

							<!-- BEGIN TROUBLESHOOTING -->
							<div class="tab-pane" id="troubleshooting">
								<h1>Common Errors</h1>
								<p>The following are the procedures to troubleshoot the most common errors that you may encounter.</p>

								<p>If you get Error 400 when calling MasterPass web services:</p>
								<ul>
									<li>Verify Authorization header is not missing from the request.</li>
									<li>Verify Authorization header has the following:</li>
									<ul>	
										<li>Consumer Key (exists and correct length)</li>
										<li>Callback URL (Request Token call only)</li>
										<li>oauth_verifier (Access Token call only)</li>
										<li>oauth_token (Access Token call only)</li>
									</ul>
								</ul>

								<h2>401 Error</h2>
								<p>If you get Error 401 when calling MasterPass web services:</p>
								<ul>
									<li>Verify that you are passing the Access Token in the get CheckoutXML call.</li>
								</ul>

								<h2>403 Error</h2>
								<p>If you get Error 403 - Forbidden when calling MasterPass services:</p> 
								<ul>
									<li>Verify correct credentials or correct environment (that is, sandbox credentials with the prod URL).</li>
								</ul>

								<h2>500 Error</h2>
								<p>If you get Error 500 when calling MasterPass web services:</p>
								<ul>
									<li>Verify oauth_body_hash exists and is correct (Post Transaction call only).</li>
									<li>Verify correct private key.</li>
								</ul>

								<h2>Support</h2>
								<p>Refer to the FAQs at https://developer.mastercard.com/portal/display/api/MasterPass+- +Merchant+Checkout+-+FAQs. (should be removed if there are no FAQS in the new site)</p>

								<p>If you have any questions or comments relating to MasterPass merchant testing, contact your assigned implementation manager. If you don’t have an assigned implementation manager, send an email with the following information (as applicable) to merchant_testing_support@masterpass.com:</p>

								<ul>
									<li>Merchant/Service Provider Name Troubleshooting Common Errors</li>
									<li>Email Address</li>
									<li>Country/Region</li>
									<li>Onboarding Model (Direct Merchant, Service Provider Merchant-by-Merchant or Service</li>
								</ul>

								<p>Provider File and API Onboarding)</p>
								
								<ul>
									<li>Integration Environment (Sandbox or Production)</li>
									<li>Checkout Version and Checkout Identifier</li>
									<li>Consumer Key</li>
									<li>Postback Details (Amount, Date and Time of recent Checkout)</li>
									<li>Detailed description of the issue, including expected and actual test results (if applicable)</li>
									<li>Error Message(s)</li>
									<li>Screenshot(s)</li>
									<li>Exact Timestamp</li>
								</ul>
							</div>
							<!-- END TROUBLESHOOTING -->

							<!-- BEGIN TESTING/QA -->
							<div class="tab-pane" id="testingqa">
								<h1>MasterPass Sandbox Testing</h1>
								<p>In order to access the necessary information to test in the sandbox environment, you must submit an approval request to the merchant and obtain a sandbox consumer key as explained earlier in the guide. Testing can be conducted in the sandbox environment, using the test consumer account.</p>
								<p>Your code must gracefully handle the error states and scenarios listed here.</p>
								<p><strong>NOTE: You cannot add cards to a sandbox account. Only shipping addresses can be added to sandbox accounts.</strong></p>
								<p>The sandbox consumer accounts are shared by all sandbox testers. If you experience difficulty using these accounts, wait at least 30 minutes and try again.</p>
								<div class="tableWrapper">
									<table class="sandboxAccount">
										<thead>
											<tr>
												<th>Sandbox Accounts</th>
												<th>Test Account 1</th>
												<th>Test Account 2</th>
												<th>3DS Test - MasterCard SecureCode</th>
												<th>3DS Test - Visa Verified by Visa</th>
											</tr>
										</thead>
										<tbody class="sandboxAccountResults">
											<tr>
												<th>Login Email</th>
												<td>Joe.test@email.com</td>
												<td>Joe.test2@email.com</td>
												<td>3ds.masterpass+securecode@gmail.com</td>
												<td>3ds.masterpass+verifiedbyvisa@gmail.com</td>
											</tr>
											<tr>
												<th>Password</th>
												<td>abc123</td>
												<td>abc123</td>
												<td>tester123</td>
												<td>tester123</td>
											</tr>
											<tr>
												<th>Security Question</th>
												<td>Pet's Name</td>
												<td>Pet's Name</td>
												<td>Pet's Name</td>
												<td>Pet's Name</td>
											</tr>
											<tr>
												<th>Security Answer</th>
												<td>fido</td>
												<td>fido</td>
												<td>fido</td>
												<td>fido</td>
											</tr>
										</tbody>
									</table>
								</div>

								<p>Select the <strong>Remember me</strong> and <strong>Remember this device</strong> options when testing so that you do not have to rekey the entire test account information every time you login to MasterPass.</p>

								<p>Once you are redirected to the sandbox environment, select MasterPass wallet to sign-in to Sandbox Consumer Wallet Account.</p>

								<h1>3-D Secure Test Cases</h1>

								<h2>MasterCard SecureCode</h2> 
								<p>Use the “3DS Test - MasterCard SecureCode” from the Sandbox Consumer Account table above to test Maestro® and MasterCard SecureCode 3-D Secure functionality.</p>

								<p>The following table provides the expected outputs for each of the test cases for MasterCard SecureCode:</p>
								<div class="tableWrapper">
									<table class="SecureCodeTable">
										<thead class="header">
											<tr>
												<th>Test Cases</th>
												<th>Scenario</th>
												<th>Enrolled</th>
												<th>ACSUrl</th>
												<th>Payload</th>
												<th>Error No</th>
												<th>ECI Flag</th>
												<th>Error Description</th>
												<th>PARes Status</th>
												<th>Sig Ver</th>
												<th>Eci Flag</th>
												<th>Xid</th>
												<th>Cavv</th>
												<th>Error No</th>
												<th>Error Description 2</th>
											</tr>
										</th>
										</thead>
										<tbody class="results">
										<tr>
											<th>1</th>
											<td title="Scenario">Full Auth</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl" title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">Y</td>
											<td title="SigVer">Y</td>
											<td title="ECIFlag">2</td>
											<td title="Xid">&lt;Xid Value&gt;</td>
											<td title="Cavv">&lt;Cavv Value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ErrorDescription2">&lt;blank&gt;</td>
										</tr>
										<tr>
											<th>2</th>
											<td title="Scenario">Sig Ver Fail</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl" title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">Y</td>
											<td title="SigVer">N</td>
											<td title="ECIFlag">2</td>
											<td title="Xid">&lt;Xid Value&gt;</td>
											<td title="Cavv">&lt;Cavv Value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ErrorDescription2">&lt;blank&gt;</td>
										</tr>
										<tr>
											<th>3</th>
											<td title="Scenario">Failed Auth</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl" title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">N</td>
											<td title="SigVer">Y</td>
											<td title="ECIFlag">1</td>
											<td title="Xid">&lt;Xid Value&gt;</td>
											<td title="Cavv">&lt;blank&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ErrorDescription2">&lt;blank&gt;</td>
										</tr>
										<tr>
											<th>4</th>
											<td title="Scenario">ADS; Consumer Declines</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">A</td>
											<td title="SigVer">Y</td>
											<td title="ECIFlag">1</td>
											<td title="Xid">&lt;Xid Value&gt;</td>
											<td title="Cavv">&lt;blank&gt;</td>
											<td title="ErrorNo"> </td>
											<td title="ErrorDescription2">&lt;blank&gt;</td>
										</tr>
										<tr>
											<th>5</th>
											<td title="Scenario">Timeout</td>
											<td title="Enrolled">&lt;blank&gt;</td>
											<td title="ACSUrl">&lt;blank&gt;</td>
											<td title="Payload">&lt;blank&gt;</td>
											<td title="ErrorNo"5052</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">Error sending / receiving XML message</td>
											<td title="PAResStatus">cmpi_authenticate message does not apply</td>
											<td title="SigVer"> </td>
											<td title="ECIFlag"> </td>
											<td title="Xid"> </td>
											<td title="Cavv"> </td>
											<td title="ErrorNo"> </td>
											<td title="ErrorDescription2"> </td>
										</tr>
										<tr>
											<th>6</th>
											<td title="Scenario">Not Participating</td>
											<td title="Enrolled">N</td>
											<td title="ACSUrl">&lt;blank&gt;</td>
											<td title="Payload">&lt;blank&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag">1</td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">cmpi_authenticate message does not apply</td>
											<td title="SigVer"> </td>
											<td title="ECIFlag"> </td>
											<td title="Xid"> </td>
											<td title="Cavv"> </td>
											<td title="ErrorNo"> </td>
											<td title="ErrorDescription2"> </td>
										</tr>
										<tr>
											<th>7</th>
											<td title="Scenario">Error</td>
											<td title="Enrolled">U</td>
											<td title="ACSUrl">&lt;blank&gt;</td>
											<td title="Payload">&lt;blank&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag">1</td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">cmpi_authenticate message does not apply</td>
											<td title="SigVer"> </td>
											<td title="ECIFlag"> </td>
											<td title="Xid"> </td>
											<td title="Cavv"> </td>
											<td title="ErrorNo"> </td>
											<td title="ErrorDescription2"> </td>
										</tr>
										<tr>
											<th>8</th>
											<td title="Scenario">Error</td>
											<td title="Enrolled">&lt;blank&gt;</td>
											<td title="ACSUrl">&lt;blank&gt;</td>
											<td title="Payload">&lt;blank&gt;</td>
											<td title="ErrorNo">1001</td>
											<td title="ECIFlag">1</td>
											<td title="ErrorDescription">Error processing message request</td>
											<td title="PAResStatus">cmpi_authenticate message does not apply</td>
											<td title="SigVer"> </td>
											<td title="ECIFlag"> </td>
											<td title="Xid"> </td>
											<td title="Cavv"> </td>
											<td title="ErrorNo"> </td>
											<td title="ErrorDescription2"> </td>
										</tr>
										<tr>
											<th>9</th>
											<td title="Scenario">Look up error</td>
											<td title="Enrolled">U</td>
											<td title="ACSUrl">&lt;blank&gt;</td>
											<td title="Payload">&lt;blank&gt;</td>
											<td title="ErrorNo">1001</td>
											<td title="ECIFlag">1</td>
											<td title="ErrorDescription">Error processing message request</td>
											<td title="PAResStatus">cmpi_authenticate message does not apply</td>
											<td title="SigVer"> </td>
											<td title="ECIFlag"> </td>
											<td title="Xid"> </td>
											<td title="Cavv"> </td>
											<td title="ErrorNo"> </td>
											<td title="ErrorDescription2"> </td>
										</tr>
										<tr>
											<th>10</th>
											<td title="Scenario">Authenticate unavailable</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">&lt;blank&gt;</td>
											<td title="SigVer">&lt;blank&gt;</td>
											<td title="ECIFlag">1</td>
											<td title="Xid">&lt;blank&gt;</td>
											<td title="Cavv">&lt;blank&gt;</td>
											<td title="ErrorNo">1050</td>
											<td title="ErrorDescription2">Error processing PARes</td>
										</tr>
										<tr>
											<th>11</th>
											<td title="Scenario">Authenticate unavailable</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">U</td>
											<td title="SigVer">Y</td>
											<td title="ECIFlag">1</td>
											<td title="Xid">&lt;Xid Value&gt;</td>
											<td title="Cavv">&lt;blank&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ErrorDescription2">&lt;blank&gt;</td>
										</tr>
										<tr>
											<th>12</th>
											<td title="Scenario">Attempts</td>
											<td title="Enrolled">Y</td>
											<td title="ACSUrl">&lt;url&gt;</td>
											<td title="Payload">&lt;value&gt;</td>
											<td title="ErrorNo">0</td>
											<td title="ECIFlag"> </td>
											<td title="ErrorDescription">&lt;blank&gt;</td>
											<td title="PAResStatus">A</td>
											<td title="SigVer">Y</td>
											<td title="ECIFlag">1</td>
											<td title="Xid">&lt;Xid Value&gt;</td>
											<td title="Cavv">&lt;Cavv Value&gt;</td>
											<td title="ErrorNo"0</td>
											<td title="ErrorDescription2">&lt;blank&gt;</td>
										</tr>
										</tbody>
									</table>
								</div>
								<p><strong>NOTE: With our 16.Q4 Release, SecureCode downgrades any transaction to Non-SecureCode if the CAVV is not submitted in Authorization (DE48, SE43). This is true in MasterPass if the Security Level Indicators in DE48, SE42 equal 221, 222, or 223.</strong></p>

								<p>Once you have logged into the “3DS Test - MasterCard SecureCode” account, choose the test case card nickname that corresponds to the test case number from the table above.</p>

								<h1>Verified by Visa</h1>
								<p>Use the “3DS Test - Visa Verified by Visa” Sandbox Consumer Account from the table above to test Visa’s Verified by Visa 3-D Secure functionality.</p>

								<p>The following table provides the expected outputs for each of the test cases for Verified by Visa:</p>
								<div class="tableWrapper">
									<table class="VisaVerificationTable">
										<thead>
											<tr>
												<th>Test Cases</th>
												<th>Scenario</th>
												<th>Enrolled</th>
												<th>ACSUrl</th>
												<th>Payload</th>
												<th>Error No</th>
												<th>ECI Flag</th>
												<th>Error Description</th>
												<th>PARes Status</th>
												<th>Sig Ver</th>
												<th>Eci Flag</th>
												<th>Xid</th>
												<th>Cavv</th>
												<th>Error No</th>
												<th>Error Description 2</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<th>1</th>
												<td title="Scenario">Full Auth</td>
												<td title="Enrolled">Y</td>
												<td title="ACSUrl">&lt;url&gt;</td>
												<td title="Payload">&lt;value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">Y</td>
												<td title="SigVer">Y</td>
												<td title="ECIFlag">05</td>
												<td title="Xid">&lt;Xid Value&gt;</td>
												<td title="Cavv">&lt;Cavv Value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ErrorDescription2">&lt;blank&gt;</td>
											</tr>
											<tr>
												<th>2</th>
												<td title="Scenario">Sig Ver Fail</td>
												<td title="Enrolled">Y</td>
												<td title="ACSUrl">&lt;url&gt;</td>
												<td title="Payload">&lt;value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">Y</td>
												<td title="SigVer">N</td>
												<td title="ECIFlag">05</td>
												<td title="Xid">&lt;Xid Value&gt;</td>
												<td title="Cavv">&lt;Cavv Value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ErrorDescription2">&lt;blank&gt;</td>
											</tr>
											<tr>
												<th>3</th>
												<td title="Scenario">Failed Auth</td>
												<td title="Enrolled">Y</td>
												<td title="ACSUrl">&lt;url&gt;</td>
												<td title="Payload">&lt;value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">cmpi_authenticate message does not apply</td>
												<td title="SigVer"> </td>
												<td title="ECIFlag"> </td>
												<td title="Xid"> </td>
												<td title="Cavv"> </td>
												<td title="ErrorNo">0</td>
												<td title="ErrorDescription2">&lt;blank&gt;</td>
											</tr>
											<tr>
												<th>4</th>
												<td title="Scenario">Attempts</td>
												<td title="Enrolled">Y</td>
												<td title="ACSUrl">&lt;url&gt;</td>
												<td title="Payload">&lt;value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">A</td>
												<td title="SigVer">Y</td>
												<td title="ECIFlag">06</td>
												<td title="Xid">&lt;Xid Value&gt;</td>
												<td title="Cavv">&lt;Cavv Value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ErrorDescription2">&lt;blank&gt;</td>
											</tr>
											<tr>
												<th>5</th>
												<td title="Scenario">Timeout</td>
												<td title="Enrolled">&lt;blank&gt;</td>
												<td title="ACSUrl">&lt;blank&gt;</td>
												<td title="Payload">&lt;blank&gt;</td>
												<td title="ErrorNo"5052</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">Error sending / receiving XML message</td>
												<td title="PAResStatus">cmpi_authenticate message does not apply</td>
												<td title="SigVer"> </td>
												<td title="ECIFlag"> </td>
												<td title="Xid"> </td>
												<td title="Cavv"> </td>
												<td title="ErrorNo"> </td>
												<td title="ErrorDescription2"> </td>
											</tr>
											<tr>
												<th>6</th>
												<td title="Scenario">Not Participating</td>
												<td title="Enrolled">N</td>
												<td title="ACSUrl">&lt;blank&gt;</td>
												<td title="Payload">&lt;blank&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag">06</td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">cmpi_authenticate message does not apply</td>
												<td title="SigVer"> </td>
												<td title="ECIFlag"> </td>
												<td title="Xid"> </td>
												<td title="Cavv"> </td>
												<td title="ErrorNo"> </td>
												<td title="ErrorDescription2"> </td>
											</tr>
											<tr>
												<th>7</th>
												<td title="Scenario">Error</td>
												<td title="Enrolled">U</td>
												<td title="ACSUrl">&lt;blank&gt;</td>
												<td title="Payload">&lt;blank&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag">07</td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">cmpi_authenticate message does not apply</td>
												<td title="SigVer"> </td>
												<td title="ECIFlag"> </td>
												<td title="Xid"> </td>
												<td title="Cavv"> </td>
												<td title="ErrorNo"> </td>
												<td title="ErrorDescription2"> </td>
											</tr>
											<tr>
												<th>8</th>
												<td title="Scenario">Error</td>
												<td title="Enrolled">&lt;blank&gt;</td>
												<td title="ACSUrl">&lt;blank&gt;</td>
												<td title="Payload">&lt;blank&gt;</td>
												<td title="ErrorNo">1001</td>
												<td title="ECIFlag">07</td>
												<td title="ErrorDescription">Error processing message request</td>
												<td title="PAResStatus">cmpi_authenticate message does not apply</td>
												<td title="SigVer"> </td>
												<td title="ECIFlag"> </td>
												<td title="Xid"> </td>
												<td title="Cavv"> </td>
												<td title="ErrorNo"> </td>
												<td title="ErrorDescription2"> </td>
											</tr>
											<tr>
												<th>9</th>
												<td title="Scenario">Look up error</td>
												<td title="Enrolled">U</td>
												<td title="ACSUrl">&lt;blank&gt;</td>
												<td title="Payload">&lt;blank&gt;</td>
												<td title="ErrorNo">1001</td>
												<td title="ECIFlag">07</td>
												<td title="ErrorDescription">Error processing message request</td>
												<td title="PAResStatus">cmpi_authenticate message does not apply</td>
												<td title="SigVer"> </td>
												<td title="ECIFlag"> </td>
												<td title="Xid"> </td>
												<td title="Cavv"> </td>
												<td title="ErrorNo"> </td>
												<td title="ErrorDescription2"> </td>
											</tr>
											<tr>
												<th>10</th>
												<td title="Scenario">Authenticate unavailable</td>
												<td title="Enrolled">Y</td>
												<td title="ACSUrl">&lt;url&gt;</td>
												<td title="Payload">&lt;value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">&lt;blank&gt;</td>
												<td title="SigVer">&lt;blank&gt;</td>
												<td title="ECIFlag">07</td>
												<td title="Xid">&lt;blank&gt;</td>
												<td title="Cavv">&lt;blank&gt;</td>
												<td title="ErrorNo">1050</td>
												<td title="ErrorDescription2">Error processing PARes</td>
											</tr>
											<tr>
												<th>11</th>
												<td title="Scenario">Authenticate unavailable</td>
												<td title="Enrolled">Y</td>
												<td title="ACSUrl">&lt;url&gt;</td>
												<td title="Payload">&lt;value&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ECIFlag"> </td>
												<td title="ErrorDescription">&lt;blank&gt;</td>
												<td title="PAResStatus">U</td>
												<td title="SigVer">Y</td>
												<td title="ECIFlag">07</td>
												<td title="Xid">&lt;Xid Value&gt;</td>
												<td title="Cavv">&lt;blank&gt;</td>
												<td title="ErrorNo">0</td>
												<td title="ErrorDescription2">&lt;blank&gt;</td>
											</tr>
										</tbody>
									</table>
								</div>

								<p>Once you have logged into the “3DS Test - Visa Verified by Visa” account, choose the Test Case Card nickname that corresponds to the test case number from the table above.</p>

								<h1>Q/A Checklist</h1>
								<p>This topic provides information on the Q/A checklist.</p>

								<h2>Checklist for MasterPass Asset Placement</h2>
								<ul>
									<li>Verify your adherence to the MasterPass Merchant Branding Requirements document found on the MasterPass - Merchant Checkout Services - Documentation page.</li>
									<li>Verify that you are linking to MasterPass visual assets rather than hosting your own.</li>
								</ul>

								<h2>In-Wallet Experience</h2>
								<ul>
									<li>Verify that the consumer can only select card/addresses that are supported by the merchant.</li> 
									<li>Merchants requesting liability shift for MasterPass transactions should use Advanced Checkout within MasterPass.</li> 
								</ul>

								<h2>Post Wallet Experience</h2>
								<ul>	
									<li>After clicking the Finish Shopping button, verify the consumer is taken to a valid page.</li>
									<li>Verify that MasterPass acceptance mark is displayed for all MasterPass transactions.</li>
									<li>It is recommended to not allow consumers to edit the payment information returned by MasterPass.</li> 
									<li>Verify that your code gracefully handles consumers returning without selecting a card and address (as a result of user choice or login failure).</li>
									<li>Verify that your code handles the return of a consumer with an expired request token.</li>
								</ul> 

								<p><strong>NOTE: The Request Token is valid for 15 minutes therefore if the process is not completed within the timeout, the request token will expire and the checkout will need to be restarted.</strong></p>

								<ul>
									<li>Verify that your code is able to parse and ingest the returned data.</li>
									<li>Verify that any post wallet page has a clear call to action (for example, select preferred shipping method), versus simply having the consumer review the data they just selected in the wallet.</li> 
									<li>Verify that consumer is not required to enter CVC/CVV in order to complete the transaction.</li>
									<li>Verify that the card PAN has not been provided to any entity that does not have the appropriate security in place for storage and transmission of card data (per PCI guidelines).</li> 
									<li>Verify that if merchants are provided with the PAN, this value is not displayed on screen.</li>
									<li>Verify that your system can handle the PostalCode element of up to nine characters; this element is sent by MasterPass as part of the BillingAddress and the ShippingAddress elements in checkout XML.</li>
								</ul>

								<h2>Postback</h2> 
								<ul>
									<li>Verify that the transaction ID submitted as part of a postback was sourced from the associated MasterPass™ transaction.</li>
									<li>Verify that the transaction result (Postback) is reported immediately after card authorization.</li>
								</ul>
							</div>
							<!-- END TESTING/QA -->

							<!-- BEGIN BRANDING -->
							<div class="tab-pane" id="branding">
								<h1>Displaying the MasterPass Checkout Button and Acceptance Marks</h1>
		 
								<p>Before reading these guidelines, make sure MasterPass is <a target="_blank" href="https://developer.mastercard.com/portal/download/attachments/48234586/MasterPassCountryandLocaleImageList.pdf">supported for your country and language</a>. Refer to the following documents to ensure the best consumer experience.</p>

								<ul>
									<li>Downloading and locally hosting the MasterPass Checkout Button image and acceptance marks is against MasterPass integration guidelines. To minimize the impact of future branding updates, use the country-specific link in the <a target="_blank" href="https://developer.mastercard.com/portal/download/attachments/48234577/Masterpass+Digital+Assets+-+Buttons+and+Learn+More+Links.pdf">MasterPass Digital Assets PDF</a>.</li>
		 
									<li>All MasterPass integrations must follow MasterPass branding guidelines as stated in the <a target="_blank" href="https://developer.mastercard.com/portal/download/attachments/48234577/MasterPass+Branding+Guidelines+v2.0+_+09+19+2014.pdf">Merchant Branding Guidelines PDF</a>.</li>
								</ul>
		 
		 						<h2>Button Placement</h2>
		 						<img src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/MPButton.png">

								<p>To ensure the best consumer experience, the checkout button should be placed at the earliest possible entry point, prior to the collection of shipping and billing information.</p>

								<h2>Acceptance Mark</h2>
								<img src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/AcceptanceMark.png">

								<p>The acceptance mark must only be displayed in parity with other accepted payment forms, or by itself. The acceptance mark is NOT a checkout button and only serves to help merchants display accepted payment types.</p>
		 
								<h2>Dynamic Checkout Button</h2>
		 
								<p>The new MasterPass dynamic checkout button displays personalized content based on consumers past wallet usage. The dynamic button will be initially available to only a few wallet providers and merchants.</p>

								<img src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/DynamicButton.png">

								<h2>MasterPass “Learn More” Page</h2>
		 
								<p>MasterPass also requires merchants and service providers to provide a link to MasterPass’ Learn More page, which can be used by consumers to get additional information about MasterPass.</p>

								<ul>
									<li>We recommend that you place the link in close proximity to the MasterPass Checkout button.</li>
									<li>Reference the MasterPass Digital Assets PDF for country specific learn more links and MasterPass checkout button links.</li>
								</ul>

								<img src="http://www.unboundcommerce.com/wp-content/uploads/2016/06/LearnMore.png">

								<h2>Checkout Button Example</h2>
		 
								<p>The following is an example of how a merchant can include the checkout button and learn more link.</p>

								<div><pre><code>&lt;div class=&rdquo;MasterPassBtnExample&rdquo;&gt;
	&lt;a href=&rdquo;/exampleredirect&rdquo;&gt;
		&lt;img src=&rdquo;https://static.masterpass.com/dyn/img/btn/en/US/mp_chk_btn_147x034px.png&rdquo;/&gt;
	&lt;/a&gt;
	&lt;a href=&rdquo; https://www.mastercard.com/mc_us/wallet/learnmore/en/US/&rdquo;&gt;Learn More&lt;/a&gt;
&lt;/div&gt;</code></pre></div>
							</div>
							<!-- END BRANDING -->

							<!-- BEGIN KEY RENEWAL -->
							<div class="tab-pane" id="keyrenewal">
								<h2 id="toc_0">Developer Zone Key Renewal Process</h2>

								<p>Your keys will expire after one year. Prior to expiration, the email associated with the Developer Zone account will receive notification that the key needs to be renewed. To renew your key, please follow the instructions below.</p>

								<ol>
									<li>Log into the <strong>MasterPass Developer Zone</strong>. </li>
									<li>Select <em>My Projects</em> in the left-hand navigation.</li>
									<li>Select the project with the expiring key and click the <em>Manage Keys</em> button.</li>
									<li>Click the <em>Renew</em> link that corresponds to the expiring key. A modal will pop up.</li>
									<li>To renew your key, you may fill out the fields on the left to generate a Certificate Request File and download a P12 file. Alternately, you can instead supply a PEM encoded Certificate Request File using a tool of your choice, such as OpenSSL or Java Keytool. Choose your preferred method and complete the steps.
									<strong>NOTE:</strong> If you do not use the same CSR file that was used to originally create the key, the application will have to be modified to use the new P12 file. Otherwise, service calls to MasterPass will fail.</li>
								</ol>
							</div>
							<!-- END KEY RENEWAL -->
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /#page-content-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- jQuery -->
	<script src="js/jquery.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="js/bootstrap.min.js"></script>

	<!-- Menu Toggle Script -->
	<script>
	$("#menu-toggle").click(function(e) {
		e.preventDefault();
		$("#wrapper").toggleClass("toggled");
	});

	
	</script>

</body>

</html>
